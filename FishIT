-- [1] Notifikasi Awal (Custom Safe Load)
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    TeleportService = game:GetService("TeleportService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace"),
    SoundService = game:GetService("SoundService"),
    Stats = game:GetService("Stats"),
    TextChatService = game:GetService("TextChatService")
}

local Player = Services.Players.LocalPlayer
local Cam = Services.Workspace.CurrentCamera

-- Fungsi Get Character Aman
local function GetChar() return Player.Character or Player.CharacterAdded:Wait() end
local function GetRoot() local c = Player.Character; return c and c:FindFirstChild("HumanoidRootPart") end
local function GetHum() local c = Player.Character; return c and c:FindFirstChild("Humanoid") end

-- // KONFIGURASI VISUAL (MODERN DARK TRANSPARENT)
local UI_THEME = {
    Width = 400,
    Height = 270, 
    
    Color = Color3.fromRGB(12, 12, 14),        
    SidebarColor = Color3.fromRGB(8, 8, 8), 
    SidebarTransparency = 0.5, 
    Transparency = 0.15, 
    Accent = Color3.fromRGB(255, 255, 255), 
    TextMain = Color3.fromRGB(240, 240, 240), 
    TextDim = Color3.fromRGB(160, 160, 170),
    FontUI = Enum.Font.GothamBlack,
    FontBtn = Enum.Font.GothamBold,
    CornerRadius = UDim.new(0, 10) 
}

-- Bersihkan UI Lama
if Services.CoreGui:FindFirstChild("SeraphinHelper") then Services.CoreGui.SeraphinHelper:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = Services.CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ====================================================
-- [SYSTEM] CUSTOM NOTIFICATION
-- ====================================================
local NotifyContainer = Instance.new("Frame", ScreenGui)
NotifyContainer.Name = "NotificationContainer"
NotifyContainer.Size = UDim2.new(0, 220, 0.5, 0) 
NotifyContainer.AnchorPoint = Vector2.new(1, 1)
NotifyContainer.Position = UDim2.new(1, -20, 1, -20)
NotifyContainer.BackgroundTransparency = 1
NotifyContainer.ClipsDescendants = false

local NotifyLayout = Instance.new("UIListLayout", NotifyContainer)
NotifyLayout.FillDirection = Enum.FillDirection.Vertical
NotifyLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifyLayout.SortOrder = Enum.SortOrder.LayoutOrder
NotifyLayout.Padding = UDim.new(0, 5)

local function Notify(title, text, colorOverride, duration)
    local color = colorOverride or Color3.fromRGB(200, 200, 200) 
    local timeTime = duration or 3 
    
    local Frame = Instance.new("Frame")
    Frame.Name = "NotifyItem"
    Frame.Size = UDim2.new(1, 0, 0, 0) 
    Frame.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
    Frame.BackgroundTransparency = 0.1
    Frame.BorderSizePixel = 0 
    Frame.Parent = NotifyContainer
    
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local Bar = Instance.new("Frame", Frame)
    Bar.Size = UDim2.new(0, 3, 1, -10) 
    Bar.Position = UDim2.new(0, 0, 0, 5)
    Bar.BackgroundColor3 = color
    Bar.BorderSizePixel = 0
    Instance.new("UICorner", Bar).CornerRadius = UDim.new(0, 4)

    local LblTitle = Instance.new("TextLabel", Frame)
    LblTitle.Size = UDim2.new(1, -15, 0, 14) 
    LblTitle.Position = UDim2.new(0, 10, 0, 6)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(title)
    LblTitle.TextColor3 = color
    LblTitle.Font = UI_THEME.FontUI
    LblTitle.TextSize = 12
    LblTitle.TextXAlignment = Enum.TextXAlignment.Left 
    
    local LblMsg = Instance.new("TextLabel", Frame)
    LblMsg.Size = UDim2.new(1, -15, 0, 14)
    LblMsg.Position = UDim2.new(0, 10, 0, 20) 
    LblMsg.BackgroundTransparency = 1
    LblMsg.Text = text
    LblMsg.TextColor3 = UI_THEME.TextMain
    LblMsg.Font = Enum.Font.GothamMedium
    LblMsg.TextSize = 10
    LblMsg.TextXAlignment = Enum.TextXAlignment.Left

    local TweenIn = Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 40)})
    TweenIn:Play()
    
    task.delay(timeTime, function()
        if Frame then
            local TweenOut = Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                Size = UDim2.new(1, 20, 0, 0), 
                BackgroundTransparency = 1
            })
            TweenOut:Play()
            if LblTitle then Services.TweenService:Create(LblTitle, TweenInfo.new(0.2), {TextTransparency = 1}):Play() end
            if LblMsg then Services.TweenService:Create(LblMsg, TweenInfo.new(0.2), {TextTransparency = 1}):Play() end
            TweenOut.Completed:Wait()
            Frame:Destroy()
        end
    end)
end

Notify("SERAPHIN", "Script Loaded", nil, 4)

-- DRAG FUNCTION
local function EnableDrag(frame, dragInputObj)
    local dragToggle, dragStart, startPos
    local function updateInput(input)
        local delta = input.Position - dragStart
        local position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        frame.Position = position
    end
    dragInputObj.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragToggle = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragToggle = false
                end
            end)
        end
    end)
    dragInputObj.InputChanged:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local dragInput = input
            Services.UserInputService.InputChanged:Connect(function(inputCheck)
                if inputCheck == dragInput and dragToggle then
                    updateInput(inputCheck)
                end
            end)
        end
    end)
end

-- ====================================================
-- [NEW] MINI FLOATING MONITOR (FPS & CPU)
-- ====================================================
local MonitorHUD = Instance.new("Frame", ScreenGui)
MonitorHUD.Name = "LiveMonitor"
MonitorHUD.Size = UDim2.new(0, 130, 0, 24) 
MonitorHUD.Position = UDim2.new(0.5, -65, 0, 10) 
MonitorHUD.BackgroundColor3 = Color3.fromRGB(15, 15, 18) 
MonitorHUD.BackgroundTransparency = 0.2
MonitorHUD.BorderSizePixel = 0 
MonitorHUD.Active = true 

Instance.new("UICorner", MonitorHUD).CornerRadius = UDim.new(0, 6)

local MonLabel = Instance.new("TextLabel", MonitorHUD)
MonLabel.Size = UDim2.new(1, 0, 1, 0)
MonLabel.BackgroundTransparency = 1
MonLabel.Text = "FPS: -- | CPU: --.-- MS"
MonLabel.TextColor3 = Color3.fromRGB(255, 255, 255) 
MonLabel.Font = UI_THEME.FontUI 
MonLabel.TextSize = 11

EnableDrag(MonitorHUD, MonitorHUD) 

-- ====================================================
-- [1] MINI FLOATING HUD (FISH STATS) - CENTERED
-- ====================================================
local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Name = "FloatingStats"
FloatHUD.AnchorPoint = Vector2.new(0.5, 0) 
FloatHUD.Size = UDim2.new(0, 150, 0, 100) 
FloatHUD.Position = UDim2.new(0.5, 0, 0.35, 0) -- Tengah Layar
FloatHUD.BackgroundColor3 = Color3.fromRGB(15, 15, 18) 
FloatHUD.BackgroundTransparency = 0.3
FloatHUD.BorderSizePixel = 0 
FloatHUD.Visible = false 
FloatHUD.Active = true 

Instance.new("UICorner", FloatHUD).CornerRadius = UDim.new(0, 8)

local ListLayout = Instance.new("UIListLayout", FloatHUD)
ListLayout.FillDirection = Enum.FillDirection.Vertical
ListLayout.Padding = UDim.new(0, 0) 
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder 

local Padding = Instance.new("UIPadding", FloatHUD)
Padding.PaddingTop = UDim.new(0, 8) 
Padding.PaddingBottom = UDim.new(0, 8)
Padding.PaddingLeft = UDim.new(0, 8)
Padding.PaddingRight = UDim.new(0, 8)

local TitleLabel = Instance.new("TextLabel", FloatHUD)
TitleLabel.LayoutOrder = 1
TitleLabel.Size = UDim2.new(1, 0, 0, 18)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "PANEL SERAPHIN" 
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255) 
TitleLabel.Font = UI_THEME.FontUI 
TitleLabel.TextSize = 12 
TitleLabel.TextStrokeTransparency = 1

local Div = Instance.new("Frame", FloatHUD)
Div.LayoutOrder = 2
Div.Size = UDim2.new(1, 0, 0, 1)
Div.BackgroundColor3 = UI_THEME.TextDim
Div.BackgroundTransparency = 0.8
Div.BorderSizePixel = 0

local function CreateStatBlock(titleText, defaultVal, order)
    local Block = Instance.new("Frame", FloatHUD)
    Block.Name = titleText.."Block"
    Block.LayoutOrder = order
    Block.Size = UDim2.new(1, 0, 0, 28)
    Block.BackgroundTransparency = 1
    Block.BorderSizePixel = 0
    
    local LblTitle = Instance.new("TextLabel", Block)
    LblTitle.Name = "Title"
    LblTitle.Size = UDim2.new(1, 0, 0, 12)
    LblTitle.Position = UDim2.new(0, 0, 0, 2)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(titleText)
    LblTitle.TextColor3 = UI_THEME.TextDim
    LblTitle.Font = Enum.Font.GothamBold
    LblTitle.TextSize = 9 
    
    local LblValue = Instance.new("TextLabel", Block)
    LblValue.Name = "Value"
    LblValue.Size = UDim2.new(1, 0, 0, 14)
    LblValue.Position = UDim2.new(0, 0, 0, 12)
    LblValue.BackgroundTransparency = 1
    LblValue.Text = defaultVal
    LblValue.TextColor3 = UI_THEME.TextMain
    LblValue.Font = UI_THEME.FontUI 
    LblValue.TextSize = 12 
    return LblValue 
end

local LblFishVal = CreateStatBlock("FISH CAUGHT", "Loading...", 3) 
local LblInvVal  = CreateStatBlock("INVENTORY", "0 / 0", 4)

EnableDrag(FloatHUD, FloatHUD)

-- ====================================================
-- [2] MAIN UI
-- ====================================================
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height)
Main.Position = UDim2.new(0, 50, 0.5, -UI_THEME.Height/2) 
Main.BackgroundColor3 = UI_THEME.Color
Main.BackgroundTransparency = UI_THEME.Transparency
Main.Active = true
Main.ClipsDescendants = true 
Main.Visible = false 
Main.BorderSizePixel = 0 

local MainCorner = Instance.new("UICorner", Main)
MainCorner.CornerRadius = UI_THEME.CornerRadius 

-- Logo (Minimized)
local LogoContainer = Instance.new("Frame", Main)
LogoContainer.Name = "LogoContainer"
LogoContainer.Size = UDim2.new(0, 32, 0, 32)
LogoContainer.Position = UDim2.new(0.5, -16, 0.5, -16)
LogoContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
LogoContainer.BackgroundTransparency = 0
LogoContainer.BorderSizePixel = 0 
LogoContainer.Visible = false
LogoContainer.ZIndex = 11
Instance.new("UICorner", LogoContainer).CornerRadius = UDim.new(0, 8) 

local LogoR = Instance.new("TextButton", LogoContainer)
LogoR.Name = "LogoBtn"
LogoR.Size = UDim2.new(1, 0, 1, 0)
LogoR.BackgroundTransparency = 1
LogoR.Text = "H"
LogoR.TextColor3 = Color3.new(1,1,1)
LogoR.Font = UI_THEME.FontUI
LogoR.TextSize = 18
LogoR.ZIndex = 12

-- HEADER
local Header = Instance.new("Frame", Main)
Header.Name = "Header"
Header.Size = UDim2.new(1, 0, 0, 32) 
Header.BackgroundColor3 = UI_THEME.SidebarColor 
Header.BackgroundTransparency = UI_THEME.SidebarTransparency
Header.BorderSizePixel = 0 

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -40, 1, 0) 
Title.Position = UDim2.new(0, 12, 0, 0) 
Title.Text = "SERA <font color=\"rgb(255, 255, 255)\">HELPER</font>" 
Title.RichText = true
Title.TextColor3 = UI_THEME.TextMain
Title.Font = UI_THEME.FontUI 
Title.TextSize = 12
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left

local HideBtn = Instance.new("TextButton", Header)
HideBtn.Size = UDim2.new(0, 22, 0, 22) 
HideBtn.Position = UDim2.new(1, -28, 0.5, -11)
HideBtn.Text = "_" 
HideBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
HideBtn.BackgroundTransparency = 0.95
HideBtn.TextColor3 = UI_THEME.TextDim
HideBtn.Font = UI_THEME.FontUI
HideBtn.TextSize = 14
HideBtn.AutoButtonColor = true
Instance.new("UICorner", HideBtn).CornerRadius = UDim.new(0, 6)

EnableDrag(Main, Main) 
EnableDrag(Main, LogoR)


-- ====================================================
-- [3] SIDE NAVIGATION
-- ====================================================
local ContentContainer = Instance.new("Frame", Main)
ContentContainer.Name = "Container"
ContentContainer.Size = UDim2.new(1, 0, 1, -32)
ContentContainer.Position = UDim2.new(0, 0, 0, 32)
ContentContainer.BackgroundTransparency = 1
ContentContainer.BorderSizePixel = 0

local Sidebar = Instance.new("Frame", ContentContainer)
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 95, 1, 0) 
Sidebar.BackgroundColor3 = UI_THEME.SidebarColor 
Sidebar.BackgroundTransparency = UI_THEME.SidebarTransparency
Sidebar.BorderSizePixel = 0 

local SidebarLayout = Instance.new("UIListLayout", Sidebar)
SidebarLayout.FillDirection = Enum.FillDirection.Vertical
SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
SidebarLayout.Padding = UDim.new(0, 5)
SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local SidebarPad = Instance.new("UIPadding", Sidebar)
SidebarPad.PaddingTop = UDim.new(0, 8)

local function CreateSideTab(name, text, isActive)
    local btn = Instance.new("TextButton", Sidebar)
    btn.Name = name
    btn.Size = UDim2.new(0.85, 0, 0, 26) 
    
    if isActive then
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50) 
        btn.BackgroundTransparency = 0.3
        btn.TextColor3 = Color3.new(1,1,1) 
    else
        btn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        btn.BackgroundTransparency = 1
        btn.TextColor3 = UI_THEME.TextDim
    end

    btn.Text = text
    btn.Font = UI_THEME.FontBtn 
    btn.TextSize = 10 
    btn.AutoButtonColor = true
    btn.BorderSizePixel = 0
    
    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 6)
    
    return btn
end

local TabMainBtn   = CreateSideTab("TabMain", "MAIN", true)
local TabEventBtn  = CreateSideTab("TabEvent", "EVENT", false) 
local TabPlayerBtn = CreateSideTab("TabPlayer", "PLAYER", false) 
local TabMiscBtn   = CreateSideTab("TabMisc", "MISC", false)

-- ====================================================
-- [4] PAGES & BUTTONS
-- ====================================================
local PageArea = Instance.new("Frame", ContentContainer)
PageArea.Name = "PageArea"
PageArea.Size = UDim2.new(1, -105, 1, -10) 
PageArea.Position = UDim2.new(0, 100, 0, 5)
PageArea.BackgroundTransparency = 1
PageArea.BorderSizePixel = 0
PageArea.ClipsDescendants = true

local function CreatePage(name, visible, isList)
    local pg = Instance.new("ScrollingFrame", PageArea)
    pg.Name = name
    pg.Size = UDim2.new(1, 0, 1, 0)
    pg.BackgroundTransparency = 1
    pg.ScrollBarThickness = 2
    pg.ScrollBarImageColor3 = Color3.new(1,1,1)
    pg.ScrollBarImageTransparency = 0.5
    pg.CanvasSize = UDim2.new(0, 0, 0, 0)
    pg.AutomaticCanvasSize = Enum.AutomaticSize.Y
    pg.Visible = visible
    pg.BorderSizePixel = 0
    
    if isList then
        local ll = Instance.new("UIListLayout", pg)
        ll.Padding = UDim.new(0, 5)
        ll.SortOrder = Enum.SortOrder.LayoutOrder
    else
        local gl = Instance.new("UIGridLayout", pg)
        gl.CellSize = UDim2.new(0.48, 0, 0, 26) 
        gl.CellPadding = UDim2.new(0, 5, 0, 5)
        gl.SortOrder = Enum.SortOrder.LayoutOrder
    end
    return pg
end

-- PAGE INIT 
local PageMain   = CreatePage("PageMain", true, false)
local PageEvent  = CreatePage("PageEvent", false, false)
local PagePlayer = CreatePage("PagePlayer", false, true) -- LIST LAYOUT ENABLED
local PageMisc   = CreatePage("PageMisc", false, true)   -- [MODIFIED] LIST LAYOUT FOR DRAWER

local function SwitchTab(tabName)
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
    local tabs = {Main = TabMainBtn, Event = TabEventBtn, Player = TabPlayerBtn, Misc = TabMiscBtn}
    local pages = {Main = PageMain, Event = PageEvent, Player = PagePlayer, Misc = PageMisc}
    
    for name, btn in pairs(tabs) do
        local isActive = (name == tabName)
        pages[name].Visible = isActive
        
        if isActive then
             Services.TweenService:Create(btn, tweenInfo, {
                BackgroundTransparency = 0.3,
                TextColor3 = Color3.new(1,1,1),
                BackgroundColor3 = Color3.fromRGB(40, 40, 50) 
            }):Play()
        else
            Services.TweenService:Create(btn, tweenInfo, {
                BackgroundTransparency = 1,
                TextColor3 = UI_THEME.TextDim, 
                BackgroundColor3 = Color3.fromRGB(255,255,255)
            }):Play()
        end
    end
end

TabMainBtn.MouseButton1Click:Connect(function() SwitchTab("Main") end)
TabEventBtn.MouseButton1Click:Connect(function() SwitchTab("Event") end)
TabPlayerBtn.MouseButton1Click:Connect(function() SwitchTab("Player") end)
TabMiscBtn.MouseButton1Click:Connect(function() SwitchTab("Misc") end)

-- ====================================================
-- [5] LOGIC & FUNCTIONAL UI
-- ====================================================
local IsMinimized = false

HideBtn.MouseButton1Click:Connect(function() 
    if not IsMinimized then
        IsMinimized = true
        Header.Visible = false
        ContentContainer.Visible = false
        Main:TweenSize(UDim2.new(0, 36, 0, 36), "Out", "Back", 0.4, true)
        Services.TweenService:Create(MainCorner, TweenInfo.new(0.4), {CornerRadius = UDim.new(0, 10)}):Play()
        Services.TweenService:Create(Main, TweenInfo.new(0.4), {BackgroundTransparency = 0.1}):Play()
        task.delay(0.2, function() if IsMinimized then LogoContainer.Visible = true end end)
    end
end)

LogoR.MouseButton1Click:Connect(function()
    if IsMinimized then
        IsMinimized = false
        LogoContainer.Visible = false
        Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height), "Out", "Back", 0.4, true)
        Services.TweenService:Create(MainCorner, TweenInfo.new(0.4), {CornerRadius = UI_THEME.CornerRadius}):Play()
        Services.TweenService:Create(Main, TweenInfo.new(0.4), {BackgroundTransparency = UI_THEME.Transparency}):Play()
        task.delay(0.3, function() if not IsMinimized then Header.Visible = true; ContentContainer.Visible = true end end)
    end
end)

-- [STYLE BUTTON]
local function MakeBtn(parent, text)
    local b = Instance.new("TextButton", parent)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(30, 30, 40) 
    b.BackgroundTransparency = 0.3
    b.TextColor3 = UI_THEME.TextMain
    b.Font = UI_THEME.FontBtn 
    b.TextScaled = true 
    b.BorderSizePixel = 0
    
    -- ADJUST WIDTH FOR MISC PAGE (Since it's now ListLayout)
    if parent == PageMisc then
        b.Size = UDim2.new(0.95, 0, 0, 26)
    end

    local constraint = Instance.new("UITextSizeConstraint", b)
    constraint.MaxTextSize = 10 
    constraint.MinTextSize = 8
    
    b.AutoButtonColor = true
    b.ClipsDescendants = true
    b.TextStrokeTransparency = 1
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6) 
    
    return b
end

-- [STYLE SWITCH]
local function MakeSwitch(parent, text, defaultState, callback)
    local Frame = Instance.new("Frame")
    Frame.Name = "Switch_" .. text
    
    -- ADJUST SIZE FOR PLAYER/MISC TAB (Full Width)
    if parent == PagePlayer or parent == PageMisc then
        Frame.Size = UDim2.new(0.95, 0, 0, 26) -- Full width for List Layout
    else
        -- Grid Layout handled by parent UIGridLayout
    end

    Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    Frame.BackgroundTransparency = 0.3
    Frame.BorderSizePixel = 0
    Frame.Parent = parent
    
    local Corner = Instance.new("UICorner", Frame)
    Corner.CornerRadius = UDim.new(0, 6)

    local Label = Instance.new("TextLabel", Frame)
    Label.Size = UDim2.new(0.65, 0, 1, 0)
    Label.Position = UDim2.new(0, 8, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = text
    Label.TextColor3 = UI_THEME.TextMain
    Label.Font = UI_THEME.FontBtn 
    Label.TextSize = 9 
    Label.TextXAlignment = Enum.TextXAlignment.Left

    local ToggleBtn = Instance.new("TextButton", Frame)
    ToggleBtn.Size = UDim2.new(0, 28, 0, 14) 
    ToggleBtn.Position = UDim2.new(1, -34, 0.5, -7)
    ToggleBtn.BackgroundColor3 = defaultState and Color3.fromRGB(0, 200, 255) or Color3.fromRGB(50, 50, 60)
    ToggleBtn.AutoButtonColor = false
    ToggleBtn.Text = ""
    
    local ToggleCorner = Instance.new("UICorner", ToggleBtn)
    ToggleCorner.CornerRadius = UDim.new(1, 0) 

    local Circle = Instance.new("Frame", ToggleBtn)
    Circle.Size = UDim2.new(0, 10, 0, 10)
    Circle.Position = defaultState and UDim2.new(1, -12, 0.5, -5) or UDim2.new(0, 2, 0.5, -5)
    Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Instance.new("UICorner", Circle).CornerRadius = UDim.new(1, 0)

    local IsOn = defaultState
    local Debounce = false

    ToggleBtn.MouseButton1Click:Connect(function()
        if Debounce then return end
        Debounce = true
        IsOn = not IsOn
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        
        if IsOn then
            Services.TweenService:Create(ToggleBtn, tweenInfo, {BackgroundColor3 = Color3.fromRGB(0, 200, 255)}):Play()
            Services.TweenService:Create(Circle, tweenInfo, {Position = UDim2.new(1, -12, 0.5, -5)}):Play()
        else
            Services.TweenService:Create(ToggleBtn, tweenInfo, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
            Services.TweenService:Create(Circle, tweenInfo, {Position = UDim2.new(0, 2, 0.5, -5)}):Play()
        end
        
        if callback then callback(IsOn) end
        
        task.wait(0.2)
        Debounce = false
    end)
    
    return Frame
end

local function ToggleVisual(btn, on)
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    if on then
        Services.TweenService:Create(btn, tweenInfo, {
            TextColor3 = Color3.new(255,255,255), 
            BackgroundTransparency = 0.2,
            BackgroundColor3 = Color3.fromRGB(40, 40, 50) 
        }):Play()
    else
        Services.TweenService:Create(btn, tweenInfo, {
            TextColor3 = UI_THEME.TextMain,
            BackgroundTransparency = 0.3,
            BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        }):Play()
    end
end

-- States
local States = {
    Freeze=false, WoW=false, Boost=false, NoRender=false, 
    Noclip=false, Panel=true, AutoEquip=false,
    AutoEvent=false, 
    Speed=false, SpeedVal=50, NoDmg=false, 
    AutoFollow=false, FollowTarget=nil,
    AutoCoral=false,
    AutoFarmRelic=false, 
    AutoCrystal=false, 
    Busy=false,
    HasTank=false,
    RelicSel="Blacktide", 
    RelicSpot=1,
    HideRod=false,
    StreamerMode=false,
    AnimSkin="Off" -- [New] State Animation
}
local SavedCFrame = nil 
local EventStartCFrame = nil 
local CoralReturnCFrame = nil
local IsInEvent = false 
local IsLootingCoral = false
local Connections = {}
local BodyV = nil
local LastFishCaughtTime = tick()
local LastFishCount = 0

local EventList = {"Ghost Shark Hunt", "Worm Hunt", "Treasure Hunt", "Shark Hunt", "Megalodon Hunt"}

-- Force Re-Equip
local function ForceEquipRod()
    pcall(function()
        local args = { [1] = 1 }
        local pkgs = Services.ReplicatedStorage:FindFirstChild("Packages")
        if pkgs then
            local idx = pkgs:FindFirstChild("_Index")
            if idx then
                local remote = idx:FindFirstChild("sleitnick_net@0.2.0")
                if remote then
                    remote.net:FindFirstChild("RE/EquipToolFromHotbar"):FireServer(unpack(args))
                end
            end
        end
    end)
end

-- ====================================================
-- [UPDATED] HIDE ROD LOGIC (GHOST MODE)
-- ====================================================
getgenv().RemoveRodEnabled = false -- Global State

local function NukeVisuals(tool)
    task.wait() 
    
    for _, obj in pairs(tool:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Beam") or obj:IsA("Light") or obj:IsA("Fire") or obj:IsA("Sparkles") then
            obj:Destroy() 
        elseif obj:IsA("BasePart") or obj:IsA("MeshPart") or obj:IsA("UnionOperation") then
            obj.Transparency = 1             
            obj.CanCollide = false           
            obj.CastShadow = false           
        elseif obj:IsA("Texture") or obj:IsA("Decal") then
            obj.Transparency = 1
        end
    end
end

local function SetHideRod(bool)
    States.HideRod = bool
    getgenv().RemoveRodEnabled = bool
    
    if States.HideRod then
        local char = GetChar()
        if char then
            local t = char:FindFirstChild("!!!EQUIPPED_TOOL!!!") or char:FindFirstChildWhichIsA("Tool")
            if t then NukeVisuals(t) end
            
            if Connections["GhostRod"] then Connections["GhostRod"]:Disconnect() end
            Connections["GhostRod"] = char.ChildAdded:Connect(function(child)
                if getgenv().RemoveRodEnabled and (child:IsA("Tool") or child.Name == "!!!EQUIPPED_TOOL!!!") then
                     NukeVisuals(child)
                     child.DescendantAdded:Connect(function(descendant)
                        if getgenv().RemoveRodEnabled then
                            task.wait()
                            if descendant:IsA("BasePart") then descendant.Transparency = 1 end
                            if descendant:IsA("ParticleEmitter") then descendant:Destroy() end
                        end
                     end)
                end
            end)
        end
        Notify("MAIN", "Hide Rod: ON (Re-Equip)", nil) 
    else
        if Connections["GhostRod"] then Connections["GhostRod"]:Disconnect() end
        Notify("MAIN", "Hide Rod: OFF", nil)
    end
end

-- Logic Water Walk
local function SetWoW(bool)
    States.WoW = bool
    
    if States.WoW then 
        local hrp = GetRoot()
        if not hrp then return end 
        if not BodyV then 
            BodyV = Instance.new("BodyVelocity")
            BodyV.Name = "WoW_Velocity"
            BodyV.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            BodyV.Velocity = Vector3.zero
        end
        BodyV.Parent = hrp
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end 
        Connections["WoW"] = Services.RunService.RenderStepped:Connect(function() 
            local hrpNow = GetRoot()
            local humNow = GetHum()
            if hrpNow and humNow and BodyV and BodyV.Parent then
                local moveDir = humNow.MoveDirection
                if moveDir.Magnitude > 0 then
                    local speed = humNow.WalkSpeed
                    BodyV.Velocity = Vector3.new(moveDir.X * speed, 0, moveDir.Z * speed)
                else
                    BodyV.Velocity = Vector3.zero
                end
            end 
        end) 
    else 
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end 
        if BodyV then BodyV:Destroy(); BodyV = nil end 
    end 
end

local function SetAutoEquip(bool)
    States.AutoEquip = bool
    Notify("MAIN", "Auto Equip Rod: "..(States.AutoEquip and "ON" or "OFF"), nil)
end

-- ====================================================
-- [UPDATED] CPU BOOSTER V2 (ULTRA LIGHT MODE - NO NOTIF)
-- ====================================================
local function ToggleBoost(enable)
    States.Boost = enable
    if enable then
        -- 1. Lighting Nuke
        pcall(function()
            local l = Services.Lighting
            l.GlobalShadows = false
            l.FogEnd = 9e9
            l.Brightness = 2
            l.EnvironmentDiffuseScale = 0
            l.EnvironmentSpecularScale = 0
            -- Hapus efek berat
            for _, v in pairs(l:GetChildren()) do
                if v:IsA("PostEffect") or v:IsA("Atmosphere") or v:IsA("Sky") or v:IsA("DepthOfField") or v:IsA("SunRays") then
                    v.Enabled = false
                end
            end
        end)
        
        -- 2. Terrain Simplification
        if Services.Workspace.Terrain then
            Services.Workspace.Terrain.WaterReflectance = 0
            Services.Workspace.Terrain.WaterTransparency = 0 
            Services.Workspace.Terrain.WaterWaveSize = 0
            Services.Workspace.Terrain.WaterWaveSpeed = 0
        end

        -- 3. Object Optimizer Function
        local function OptimizeObject(v)
            pcall(function()
                if v:IsA("BasePart") then
                    v.Material = Enum.Material.SmoothPlastic
                    v.Reflectance = 0
                    v.CastShadow = false -- PENTING: Matikan bayangan
                    if v.Name == "Water" then v.Transparency = 1 end 
                elseif v:IsA("Decal") or v:IsA("Texture") then
                    v.Transparency = 1 
                elseif v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Sparkles") or v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Explosion") then
                    v.Enabled = false 
                end
            end)
        end
        
        -- 4. Apply to Existing Objects
        for _, v in pairs(Services.Workspace:GetDescendants()) do
            OptimizeObject(v)
        end
        
        -- 5. Auto-Optimize New Objects (Loop Detector)
        if Connections["BoosterDynamic"] then Connections["BoosterDynamic"]:Disconnect() end
        Connections["BoosterDynamic"] = Services.Workspace.DescendantAdded:Connect(function(v)
            OptimizeObject(v)
        end)
    else
        if Connections["BoosterDynamic"] then Connections["BoosterDynamic"]:Disconnect() end
    end
end

-- ====================================================
-- [NEW] STREAMER MODE LOGIC (NAME & CHAT SPOOF)
-- ====================================================
local RAW_NAME = "discord.gg/getseraphin VISUAL" 
local SPOOF_NAME = '<font face="GothamBold"><b>' .. RAW_NAME .. '</b></font>'
local NAME_COLOR = "#00ffff" 
local OVERHEAD_HTML = string.format('<font color="#FFFFFF">%s</font>', SPOOF_NAME)

local NameSpoof = {
    Active = false,
    CurrentConnection = nil,
    CharConn = nil
}

local function GetNameLabel(char)
    if not char then return nil end
    local hrp = char:WaitForChild("HumanoidRootPart", 5)
    if not hrp then return nil end
    local overhead = hrp:WaitForChild("Overhead", 5)
    if not overhead then return nil end
    
    local label = overhead:FindFirstChild("Header", true)
    if not label then
        for _, v in pairs(overhead:GetDescendants()) do
            if v:IsA("TextLabel") then
                label = v
                break
            end
        end
    end
    return label
end

local function ApplyNameSpoof()
    if not NameSpoof.Active then return end
    
    local char = Player.Character
    if not char then return end

    local label = GetNameLabel(char)
    if not label then return end

    label.RichText = true

    if NameSpoof.CurrentConnection then
        NameSpoof.CurrentConnection:Disconnect()
        NameSpoof.CurrentConnection = nil
    end

    label.Text = OVERHEAD_HTML

    NameSpoof.CurrentConnection = label:GetPropertyChangedSignal("Text"):Connect(function()
        if label.Text ~= OVERHEAD_HTML then
            label.Text = OVERHEAD_HTML
        end
    end)
end

local function EnableNameSpoof(bool)
    NameSpoof.Active = bool
    
    if bool then
        if Player.Character then
            ApplyNameSpoof()
        end
        if NameSpoof.CharConn then NameSpoof.CharConn:Disconnect() end
        NameSpoof.CharConn = Player.CharacterAdded:Connect(function(char)
            task.wait(1) 
            ApplyNameSpoof()
        end)
    else
        if NameSpoof.CharConn then NameSpoof.CharConn:Disconnect() end
        if NameSpoof.CurrentConnection then NameSpoof.CurrentConnection:Disconnect() end
    end
end

local function CustomizeMessage(message)
    if not States.StreamerMode then return nil end

    local properties = Instance.new("TextChatMessageProperties")
    local msgText = message.Text 
    
    if string.find(msgText, "caught") or string.find(msgText, "obtained") or string.find(msgText, "found") then
        local newText = string.gsub(msgText, "^%S+", function(originalName)
            return string.format("<font color='%s'>%s</font>", NAME_COLOR, SPOOF_NAME)
        end)
        
        if string.find(msgText, "%]") or string.find(msgText, ":") then
            newText = string.gsub(msgText, "(%S+)%s+caught", function(originalName)
                return string.format("<font color='%s'>%s</font> caught", NAME_COLOR, SPOOF_NAME)
            end)
            newText = string.gsub(newText, "(%S+)%s+obtained", function(originalName)
                return string.format("<font color='%s'>%s</font> obtained", NAME_COLOR, SPOOF_NAME)
            end)
        end

        properties.Text = newText
    end

    if message.TextSource then
        properties.PrefixText = string.format("<font color='%s'>[%s]:</font> ", NAME_COLOR, SPOOF_NAME)
    end

    return properties
end

-- Aktifkan Listener Chat
Services.TextChatService.OnIncomingMessage = CustomizeMessage

-- >> TOMBOL UI (LAYOUT RAPIH & SWITCH) <<

-- [TAB MAIN]
MakeSwitch(PageMain, "Auto Equip Rod", States.AutoEquip, function(val)
    SetAutoEquip(val)
end)

MakeSwitch(PageMain, "Hide Rod ", States.HideRod, function(val)
    SetHideRod(val)
end)

MakeSwitch(PageMain, "Walk In Water", States.WoW, function(val)
    SetWoW(val)
end)

MakeSwitch(PageMain, "Freeze Character", States.Freeze, function(val)
    States.Freeze = val
    local hrp = GetRoot()
    if hrp then hrp.Anchored = val end
    Notify("MAIN", "Freeze: "..(val and "ON" or "OFF"), nil)
end)

MakeSwitch(PageMain, "No Clip", States.Noclip, function(val)
    States.Noclip = val
    Notify("MAIN", "Noclip: "..(val and "ON" or "OFF"), nil)
    if States.Noclip then 
        Connections["Noclip"] = Services.RunService.Stepped:Connect(function() 
            local char = GetChar()
            if char then 
                for _,v in pairs(char:GetDescendants()) do 
                    if v:IsA("BasePart") then v.CanCollide = false end 
                end 
            end 
        end) 
    else 
        if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end 
    end 
end)

MakeSwitch(PageMain, "CPU Booster (Extreme)", States.Boost, function(val)
    ToggleBoost(val)
end)

MakeSwitch(PageMain, "3D No Render", States.NoRender, function(val)
    States.NoRender = val
    Services.RunService:Set3dRenderingEnabled(not val)
    Notify("RENDER", "No Render: "..(val and "ON" or "OFF"), nil)
end)

-- [TAB EVENT]
MakeSwitch(PageEvent, "Auto Hunt Event", States.AutoEvent, function(val)
    States.AutoEvent = val
    Notify("EVENT", "Auto Hunt: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    
    if not val then 
        local hrp = GetRoot()
        if IsInEvent and EventStartCFrame and hrp then 
            hrp.CFrame = EventStartCFrame 
            EventStartCFrame = nil
            Notify("AUTO HUNT", "Returning...", nil)
        end
        IsInEvent = false
        SetWoW(false) 
    end
end)

-- [NEW] AUTO CAVE CRYSTAL SWITCH
MakeSwitch(PageEvent, "Auto Cave Crystal", States.AutoCrystal, function(val)
    States.AutoCrystal = val
    Notify("EVENT", "Auto Crystal: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    
    if val then
        SetWoW(true) -- Hidupkan WoW
        States.WoW = true 
    else
        SetWoW(false) 
        States.WoW = false
    end
end)

MakeSwitch(PageEvent, "Auto Take Coral", States.AutoCoral, function(val)
    States.AutoCoral = val
    Notify("EVENT", "Auto Coral: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    
    if val then
        -- OXYGEN TANK AUTO EQUIP
        if not States.HasTank then
            pcall(function() TankRemote:InvokeServer(105) end)
            States.HasTank = true
            Notify("GEAR", "Oxygen Tank Equipped", Color3.fromRGB(0, 255, 255))
        end
    end
    
    if not val then
         local hrp = GetRoot()
         if IsLootingCoral and CoralReturnCFrame and hrp then
             hrp.CFrame = CoralReturnCFrame
             Notify("CORAL", "Returning...", nil)
         end
         IsLootingCoral = false
         SetWoW(false)
    end
end)

-- [NEW LOGIC] RELIC DEFINITIONS & SPOT CYCLING
local RelicsFolder = Services.Workspace:WaitForChild("LeviathanEvent"):WaitForChild("Relics")
local ClaimRemote = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/ClaimRelic"]
local TankRemote = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/EquipOxygenTank"]

local function ProcessRelicWithSpots(relicContainer)
    if not States.AutoFarmRelic then return end
    
    local validNames = {["Sunken Eye Relic"]=true, ["Burntflame Relic"]=true, ["Blacktide Relic"]=true}
    if not validNames[relicContainer.Name] then return end

    local hrp = GetRoot()
    if not hrp then return end

    if not States.HasTank then
        pcall(function() TankRemote:InvokeServer(105) end)
        States.HasTank = true
        Notify("GEAR", "Oxygen Tank Equipped", Color3.fromRGB(0, 255, 255))
    end
    
    SetWoW(true) 

    local spots = relicContainer:GetChildren()
    for i, spotPart in ipairs(spots) do
        if not States.AutoFarmRelic then break end 
        if States.Busy then break end 

        local target = spotPart:FindFirstChild("Part") or (spotPart:IsA("BasePart") and spotPart)
        if target then
            States.Busy = true
            hrp.CFrame = target.CFrame + Vector3.new(0, 3, 0)
            task.wait(0.6)
            ClaimRemote:FireServer(relicContainer.Name)
            Notify("RELIC", "Checked Spot " .. i .. " (" .. relicContainer.Name .. ")", Color3.fromRGB(0, 255, 100), 1)
            task.wait(1.5) 
            States.Busy = false
        end
    end
end

RelicsFolder.ChildAdded:Connect(function(child)
    if States.AutoFarmRelic then
        task.wait(1) 
        ProcessRelicWithSpots(child)
    end
end)

MakeSwitch(PageEvent, "Auto Take Relics", States.AutoFarmRelic, function(val)
    States.AutoFarmRelic = val
    Notify("EVENT", "Auto All Relic: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    
    if val then
        task.spawn(function()
            for _, v in pairs(RelicsFolder:GetChildren()) do
                if not States.AutoFarmRelic then break end
                ProcessRelicWithSpots(v)
            end
        end)
    else
        SetWoW(false)
        States.Busy = false
        States.HasTank = false 
    end
end)

local BtnQuestNPC = MakeBtn(PageEvent, "Teleport NPC Quest")

local RelicTypes = {"Blacktide", "Burntflame", "Sunken Eye"}
local RelicIndex = 1

local BtnRelicSel = MakeBtn(PageEvent, "Relic: Blacktide")
local BtnSpotSel  = MakeBtn(PageEvent, "Spot: 1")
local BtnTpRelic  = MakeBtn(PageEvent, "MANUAL TP RELIC")

BtnRelicSel.MouseButton1Click:Connect(function()
    RelicIndex = RelicIndex + 1
    if RelicIndex > #RelicTypes then RelicIndex = 1 end
    States.RelicSel = RelicTypes[RelicIndex]
    BtnRelicSel.Text = "Relic: " .. States.RelicSel
    States.RelicSpot = 1
    BtnSpotSel.Text = "Spot: 1"
end)

BtnSpotSel.MouseButton1Click:Connect(function()
    local maxSpot = 3 
    if States.RelicSel == "Sunken Eye" or States.RelicSel == "Blacktide" then maxSpot = 4 end
    States.RelicSpot = States.RelicSpot + 1
    if States.RelicSpot > maxSpot then States.RelicSpot = 1 end
    BtnSpotSel.Text = "Spot: " .. States.RelicSpot
end)

BtnTpRelic.MouseButton1Click:Connect(function()
    local rName = States.RelicSel .. " Relic"
    local spot = States.RelicSpot
    local hrp = GetRoot()
    
    if not hrp then return end

    local eventFolder = Services.Workspace:FindFirstChild("LeviathanEvent")
    if not eventFolder then Notify("RELIC", "Event Map Not Found!", Color3.fromRGB(255,0,0)); return end
    
    local relics = eventFolder:FindFirstChild("Relics")
    if not relics then Notify("RELIC", "Relics Folder Missing!", Color3.fromRGB(255,0,0)); return end

    local targetRelic = relics:FindFirstChild(rName)
    if not targetRelic then Notify("RELIC", rName.." Not Found!", Color3.fromRGB(255,0,0)); return end

    local targetPart = nil
    
    if States.RelicSel == "Blacktide" and spot == 4 then
        local children = targetRelic:GetChildren()
        if children[4] then
            targetPart = children[4]
            if targetPart:FindFirstChild("Part") then targetPart = targetPart.Part end
        end
    elseif spot == 1 then
        targetPart = targetRelic:FindFirstChild("Part")
    else
        local children = targetRelic:GetChildren()
        if children[spot] then targetPart = children[spot] end
    end

    if targetPart then
        hrp.CFrame = targetPart.CFrame + Vector3.new(0, 5, 0)
        Notify("RELIC", "Teleported to Spot " .. spot, nil)
    else
        Notify("RELIC", "Spot Part Not Found", Color3.fromRGB(255,0,0))
    end
end)

BtnQuestNPC.MouseButton1Click:Connect(function()
    local npc = Services.Workspace:FindFirstChild("NPC") and Services.Workspace.NPC:FindFirstChild("Archaeologist")
    local hrp = GetRoot()
    if npc and hrp then
        local pivot = npc:GetPivot()
        hrp.CFrame = pivot + Vector3.new(0, 0, 4) 
        Notify("QUEST", "Teleported to Archaeologist", nil)
    else
        Notify("QUEST", "Archaeologist Not Found!", Color3.fromRGB(255, 50, 50))
    end
end)


-- [TAB PLAYER] - UPDATED TO LIST LAYOUT FOR DROPDOWN
local SpeedContainer = Instance.new("Frame", PagePlayer)
SpeedContainer.Name = "SpeedContainer"
SpeedContainer.Size = UDim2.new(0.95, 0, 0, 26) -- Full Width
SpeedContainer.BackgroundTransparency = 1

local BtnSpeedToggle = Instance.new("TextButton", SpeedContainer)
BtnSpeedToggle.Name = "Toggle"
BtnSpeedToggle.Size = UDim2.new(0.65, -4, 1, 0)
BtnSpeedToggle.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
BtnSpeedToggle.BackgroundTransparency = 0.3
BtnSpeedToggle.Text = "Speed: OFF"
BtnSpeedToggle.TextColor3 = UI_THEME.TextMain
BtnSpeedToggle.Font = UI_THEME.FontBtn 
BtnSpeedToggle.TextScaled = true 
BtnSpeedToggle.BorderSizePixel = 0
Instance.new("UITextSizeConstraint", BtnSpeedToggle).MaxTextSize = 10
BtnSpeedToggle.TextStrokeTransparency = 1
Instance.new("UICorner", BtnSpeedToggle).CornerRadius = UDim.new(0, 6)

local BoxSpeedInput = Instance.new("TextBox", SpeedContainer)
BoxSpeedInput.Name = "Input"
BoxSpeedInput.Size = UDim2.new(0.35, 0, 1, 0)
BoxSpeedInput.Position = UDim2.new(0.65, 0, 0, 0)
BoxSpeedInput.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
BoxSpeedInput.BackgroundTransparency = 0.3
BoxSpeedInput.Text = "80" 
BoxSpeedInput.PlaceholderText = "Val"
BoxSpeedInput.TextColor3 = UI_THEME.Accent
BoxSpeedInput.Font = UI_THEME.FontUI 
BoxSpeedInput.TextSize = 10
BoxSpeedInput.BorderSizePixel = 0
Instance.new("UICorner", BoxSpeedInput).CornerRadius = UDim.new(0, 6)

local FollowContainer = Instance.new("Frame", PagePlayer)
FollowContainer.Name = "FollowContainer"
FollowContainer.Size = UDim2.new(0.95, 0, 0, 26) -- Full Width
FollowContainer.BackgroundTransparency = 1

local BtnFollowToggle = Instance.new("TextButton", FollowContainer)
BtnFollowToggle.Name = "Toggle"
BtnFollowToggle.Size = UDim2.new(0.5, -3, 1, 0)
BtnFollowToggle.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
BtnFollowToggle.BackgroundTransparency = 0.3
BtnFollowToggle.Text = "Follow Player: OFF"
BtnFollowToggle.TextColor3 = UI_THEME.TextMain
BtnFollowToggle.Font = UI_THEME.FontBtn 
BtnFollowToggle.TextScaled = true 
BtnFollowToggle.BorderSizePixel = 0
Instance.new("UITextSizeConstraint", BtnFollowToggle).MaxTextSize = 10
BtnFollowToggle.TextStrokeTransparency = 1
Instance.new("UICorner", BtnFollowToggle).CornerRadius = UDim.new(0, 6)

local BoxFollowInput = Instance.new("TextBox", FollowContainer)
BoxFollowInput.Name = "Input"
BoxFollowInput.Size = UDim2.new(0.5, 0, 1, 0)
BoxFollowInput.Position = UDim2.new(0.5, 0, 0, 0)
BoxFollowInput.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
BoxFollowInput.BackgroundTransparency = 0.3
BoxFollowInput.Text = "" 
BoxFollowInput.PlaceholderText = "Input Name"
BoxFollowInput.TextColor3 = UI_THEME.Accent
BoxFollowInput.Font = UI_THEME.FontUI 
BoxFollowInput.TextSize = 10
BoxFollowInput.BorderSizePixel = 0
Instance.new("UICorner", BoxFollowInput).CornerRadius = UDim.new(0, 6)

MakeSwitch(PagePlayer, "No Damage", States.NoDmg, function(val)
    States.NoDmg = val
    Notify("PLAYER", "No Damage: "..(val and "ON" or "OFF"), nil)
end)

MakeSwitch(PagePlayer, "Streamer Mode", States.StreamerMode, function(val)
    States.StreamerMode = val
    EnableNameSpoof(val)
    Notify("STREAMER", "Mode: "..(val and "ON" or "OFF"), nil)
end)

-- ====================================================
-- [UPDATED] DROPDOWN MENU ANIMATION (DRAWER STYLE)
-- ====================================================

-- 1. Container Utama (Header + List)
local AnimContainer = Instance.new("Frame", PagePlayer)
AnimContainer.Name = "AnimDropdown"
AnimContainer.Size = UDim2.new(0.95, 0, 0, 26) -- Ukuran awal (Tertutup)
AnimContainer.BackgroundTransparency = 1
AnimContainer.ClipsDescendants = true -- Kunci: Sembunyikan isi saat tertutup

-- 2. Header (Tombol Pemicu)
local AnimHeader = Instance.new("TextButton", AnimContainer)
AnimHeader.Size = UDim2.new(1, 0, 0, 26)
AnimHeader.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
AnimHeader.BackgroundTransparency = 0.3
AnimHeader.Text = "Animation: OFF"
AnimHeader.TextColor3 = UI_THEME.TextMain
AnimHeader.Font = UI_THEME.FontBtn
AnimHeader.TextSize = 10
AnimHeader.AutoButtonColor = true
Instance.new("UICorner", AnimHeader).CornerRadius = UDim.new(0, 6)

-- 3. List (Laci di dalam)
local AnimListFrame = Instance.new("ScrollingFrame", AnimContainer)
AnimListFrame.Size = UDim2.new(1, 0, 0, 120) -- Tinggi maksimal saat terbuka
AnimListFrame.Position = UDim2.new(0, 0, 0, 30) -- Di bawah header
AnimListFrame.BackgroundTransparency = 0.5
AnimListFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
AnimListFrame.ScrollBarThickness = 2
AnimListFrame.BorderSizePixel = 0
Instance.new("UICorner", AnimListFrame).CornerRadius = UDim.new(0, 6)

local AnimGrid = Instance.new("UIListLayout", AnimListFrame)
AnimGrid.Padding = UDim.new(0, 2)
AnimGrid.HorizontalAlignment = Enum.HorizontalAlignment.Center
AnimGrid.SortOrder = Enum.SortOrder.LayoutOrder

local AnimationList = {
    ["Corruption Edge"] = "Corruption Edge - FishCaught",
    ["Princess Parasol"] = "Princess Parasol - FishCaught",
    ["Soul Scythe"] = "Soul Scythe - FishCaught",
    ["Eclipse Katana"] = "Eclipse Katana - FishCaught",
    ["Ban Hammer"] = "1x1x1x1 Ban Hammer - FishCaught",
    -- ["Big Hammer"] = "Big Hammer - FishCaught", -- [DELETED]
    ["Trident"] = "Holy Trident - FishCaught" -- [UPDATED] PATH
}

-- Buat Tombol dalam List
local function CreateAnimItem(name, value, order)
    local btn = Instance.new("TextButton", AnimListFrame)
    btn.LayoutOrder = order
    btn.Size = UDim2.new(0.95, 0, 0, 24)
    btn.Text = name
    btn.Font = UI_THEME.FontUI
    btn.TextSize = 9
    btn.TextColor3 = UI_THEME.TextMain
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    btn.BackgroundTransparency = 0.4
    btn.AutoButtonColor = true
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)
    
    btn.MouseButton1Click:Connect(function()
        -- Logika Pilih
        States.AnimSkin = value
        AnimHeader.Text = "Animation: " .. name
        Notify("ANIMATION", "Selected: " .. name, nil)
        
        -- Tutup Laci otomatis
        Services.TweenService:Create(AnimContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(0.95, 0, 0, 26)}):Play()
    end)
end

CreateAnimItem("OFF (Disable)", "Off", 0)
local i = 1
for name, path in pairs(AnimationList) do
    CreateAnimItem(name, path, i)
    i = i + 1
end
AnimListFrame.CanvasSize = UDim2.new(0, 0, 0, (i + 1) * 26)

-- 4. Logika Buka Tutup Laci
local IsOpen = false
AnimHeader.MouseButton1Click:Connect(function()
    IsOpen = not IsOpen
    if IsOpen then
        -- Buka Laci (Expand Container)
        Services.TweenService:Create(AnimContainer, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0.95, 0, 0, 150)}):Play()
        Services.TweenService:Create(AnimHeader, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 60)}):Play()
    else
        -- Tutup Laci (Shrink Container)
        Services.TweenService:Create(AnimContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Size = UDim2.new(0.95, 0, 0, 26)}):Play()
        Services.TweenService:Create(AnimHeader, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(30, 30, 40)}):Play()
    end
end)

-- ====================================================
-- [ANIMATION LOGIC]
-- ====================================================
local FishEvent = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net:FindFirstChild("RE/FishCaught")

local function PlaySelectedAnim()
    if States.AnimSkin == "Off" then return end
    
    local char = Player.Character
    if not char then return end

    local humanoid = char:FindFirstChild("Humanoid")
    local animator = humanoid and humanoid:FindFirstChild("Animator")
    
    if animator then
        -- Stop anim lama
        for _, track in pairs(animator:GetPlayingAnimationTracks()) do
            track:Stop(0.1)
        end
        
        local targetAnimName = States.AnimSkin
        -- Cari Animation Object di ReplicatedStorage
        local AnimObj = Services.ReplicatedStorage.Modules.Animations:FindFirstChild(targetAnimName)
        
        if AnimObj then
            local track = animator:LoadAnimation(AnimObj)
            track.Priority = Enum.AnimationPriority.Action4 
            track:Play()
            track.Stopped:Connect(function() track:Destroy() end)
        end
    end
end

if FishEvent then
    FishEvent.OnClientEvent:Connect(PlaySelectedAnim)
end

-- [TAB MISC]

local BtnSave   = MakeBtn(PageMisc, "Save Position")
local BtnLoad   = MakeBtn(PageMisc, "Load Position")
local BtnRejoin = MakeBtn(PageMisc, "Rejoin Server")

MakeSwitch(PageMisc, "Panel Fishing", States.Panel, function(val)
    States.Panel = val
    FloatHUD.Visible = val
end)

-- ====================================================
-- [ADDON] BUY CHARM SYSTEM (DRAWER & QUANTITY)
-- ====================================================

-- Definisi Remote
local PurchaseCharmRF = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net:WaitForChild("RF/PurchaseCharm")

-- Container Utama
local CharmContainer = Instance.new("Frame", PageMisc)
CharmContainer.Name = "CharmSystem"
CharmContainer.Size = UDim2.new(0.95, 0, 0, 85) -- Ukuran default tertutup
CharmContainer.BackgroundTransparency = 1
CharmContainer.ClipsDescendants = true 

-- 1. HEADER & DROPDOWN (LACI)
local CharmDropdown = Instance.new("Frame", CharmContainer)
CharmDropdown.Name = "Dropdown"
CharmDropdown.Size = UDim2.new(1, 0, 0, 26)
CharmDropdown.BackgroundTransparency = 1
CharmDropdown.ZIndex = 5

local CharmBtn = Instance.new("TextButton", CharmDropdown)
CharmBtn.Size = UDim2.new(1, 0, 1, 0)
CharmBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
CharmBtn.BackgroundTransparency = 0.3
CharmBtn.Text = "Select Charm >"
CharmBtn.TextColor3 = UI_THEME.TextMain
CharmBtn.Font = UI_THEME.FontBtn
CharmBtn.TextSize = 10
CharmBtn.AutoButtonColor = true
Instance.new("UICorner", CharmBtn).CornerRadius = UDim.new(0, 6)

-- List Item (Isi Laci)
local CharmListFrame = Instance.new("ScrollingFrame", CharmDropdown)
CharmListFrame.Size = UDim2.new(1, 0, 0, 100)
CharmListFrame.Position = UDim2.new(0, 0, 0, 30)
CharmListFrame.BackgroundTransparency = 0.2
CharmListFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
CharmListFrame.ScrollBarThickness = 2
CharmListFrame.Visible = false
CharmListFrame.ZIndex = 6
Instance.new("UICorner", CharmListFrame).CornerRadius = UDim.new(0, 6)

local CharmListLayout = Instance.new("UIListLayout", CharmListFrame)
CharmListLayout.Padding = UDim.new(0, 2)
CharmListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- Data Charm
local SelectedCharm = nil
local CharmData = {
    "Bone Charm",
    "Magma Charm",
    "Algae Charm",
    "Clover Charm"
}

-- Fungsi Pilih Charm
local function UpdateCharmSelect(name)
    SelectedCharm = name
    CharmBtn.Text = "Selected: " .. name
    -- Tutup laci otomatis setelah memilih
    CharmListFrame.Visible = false
    Services.TweenService:Create(CharmContainer, TweenInfo.new(0.3), {Size = UDim2.new(0.95, 0, 0, 85)}):Play()
end

for _, cName in pairs(CharmData) do
    local btn = Instance.new("TextButton", CharmListFrame)
    btn.Size = UDim2.new(0.95, 0, 0, 24)
    btn.Text = cName
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    btn.BackgroundTransparency = 0.5
    btn.TextColor3 = Color3.fromRGB(200, 200, 200)
    btn.Font = UI_THEME.FontUI
    btn.TextSize = 9
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)
    
    btn.MouseButton1Click:Connect(function()
        UpdateCharmSelect(cName)
    end)
end
CharmListFrame.CanvasSize = UDim2.new(0, 0, 0, (#CharmData * 26))

-- Toggle Laci
local IsCharmOpen = false
CharmBtn.MouseButton1Click:Connect(function()
    IsCharmOpen = not IsCharmOpen
    if IsCharmOpen then
        CharmListFrame.Visible = true
        Services.TweenService:Create(CharmContainer, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0.95, 0, 0, 140)}):Play()
    else
        CharmListFrame.Visible = false
        Services.TweenService:Create(CharmContainer, TweenInfo.new(0.3), {Size = UDim2.new(0.95, 0, 0, 85)}):Play()
    end
end)

-- 2. QUANTITY INPUT & BUY BUTTON
local ActionFrame = Instance.new("Frame", CharmContainer)
ActionFrame.Name = "Action"
ActionFrame.Size = UDim2.new(1, 0, 0, 26)
ActionFrame.Position = UDim2.new(0, 0, 1, -26) -- Selalu di paling bawah container
ActionFrame.BackgroundTransparency = 1

local QtyInput = Instance.new("TextBox", ActionFrame)
QtyInput.Size = UDim2.new(0.3, 0, 1, 0)
QtyInput.Position = UDim2.new(0, 0, 0, 0)
QtyInput.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
QtyInput.BackgroundTransparency = 0.3
QtyInput.Text = "1"
QtyInput.PlaceholderText = "Qty"
QtyInput.TextColor3 = UI_THEME.Accent
QtyInput.Font = UI_THEME.FontUI
QtyInput.TextSize = 10
Instance.new("UICorner", QtyInput).CornerRadius = UDim.new(0, 6)

local BuyBtn = Instance.new("TextButton", ActionFrame)
BuyBtn.Size = UDim2.new(0.65, 0, 1, 0)
BuyBtn.Position = UDim2.new(0.35, 0, 0, 0)
BuyBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 100) -- Warna Hijau
BuyBtn.BackgroundTransparency = 0.2
BuyBtn.Text = "PURCHASE"
BuyBtn.TextColor3 = Color3.new(1,1,1)
BuyBtn.Font = UI_THEME.FontBtn
BuyBtn.TextSize = 10
Instance.new("UICorner", BuyBtn).CornerRadius = UDim.new(0, 6)

-- 3. LOGIKA PEMBELIAN
BuyBtn.MouseButton1Click:Connect(function()
    if not SelectedCharm then 
        Notify("SHOP", "Please Select a Charm!", Color3.fromRGB(255, 50, 50)) 
        return 
    end
    
    local amount = tonumber(QtyInput.Text) or 1
    if amount < 1 then amount = 1 end
    
    Notify("SHOP", "Buying " .. amount .. " " .. SelectedCharm .. "...", Color3.fromRGB(255, 200, 0))
    
    -- Menggunakan task.spawn agar UI tidak freeze saat looping
    task.spawn(function()
        for i = 1, amount do
            local success, err = pcall(function()
                PurchaseCharmRF:InvokeServer(SelectedCharm)
            end)
            
            if not success then
                Notify("ERROR", "Failed to buy!", Color3.fromRGB(255, 0, 0))
                break
            end
            task.wait(0.1) -- Delay kecil agar aman dari kick spam
        end
        Notify("SHOP", "Purchase Complete!", Color3.fromRGB(0, 255, 100))
    end)
end)


-- ====================================================
-- [UPDATED] SYSTEM MONITOR (REALTIME MS + COLOR)
-- ====================================================
local StatsService = game:GetService("Stats") 
local fpsT = 0

Services.RunService.RenderStepped:Connect(function(dt)
    fpsT = fpsT + (1/dt - fpsT) * 0.1 
    local currentFps = math.floor(fpsT)

    local cpuMs = StatsService.PerformanceStats.CPU:GetValue()
    
    if MonLabel then
        MonLabel.Text = string.format("FPS: %d | CPU: %.2f ms", currentFps, cpuMs)
        MonLabel.TextColor3 = Color3.fromRGB(255, 255, 255) 
    end
end)

-- ====================================================
-- [BUTTON LOGIC - PLAYER TAB]
-- ====================================================

BtnSpeedToggle.MouseButton1Click:Connect(function()
    States.Speed = not States.Speed
    local val = tonumber(BoxSpeedInput.Text) or 50
    States.SpeedVal = val
    
    local hum = GetHum()
    if States.Speed then
        BtnSpeedToggle.Text = "Speed: ON"
        ToggleVisual(BtnSpeedToggle, true)
        Notify("PLAYER", "Speed Aktif: " .. val, Color3.fromRGB(0, 255, 100))
        if hum and not hum.Sit then hum.WalkSpeed = 16 end
    else
        BtnSpeedToggle.Text = "Speed: OFF"
        ToggleVisual(BtnSpeedToggle, false)
        if hum then hum.WalkSpeed = 16 end
    end
end)

BoxSpeedInput.FocusLost:Connect(function()
    local val = tonumber(BoxSpeedInput.Text)
    if val then States.SpeedVal = val else BoxSpeedInput.Text = tostring(States.SpeedVal) end
end)

local function FindPlayer(namePart)
    for _, p in pairs(Services.Players:GetPlayers()) do
        if p ~= Player then
            if string.sub(string.lower(p.Name), 1, string.len(namePart)) == string.lower(namePart) or
               string.sub(string.lower(p.DisplayName), 1, string.len(namePart)) == string.lower(namePart) then
                return p
            end
        end
    end
    return nil
end

BtnFollowToggle.MouseButton1Click:Connect(function()
    States.AutoFollow = not States.AutoFollow
    if States.AutoFollow then
        local targetName = BoxFollowInput.Text
        local target = FindPlayer(targetName)
        if target then
            States.FollowTarget = target
            BoxFollowInput.Text = target.Name 
            BtnFollowToggle.Text = "Following"
            ToggleVisual(BtnFollowToggle, true)
            Notify("FOLLOW", "Target: " .. target.Name, Color3.fromRGB(0, 255, 100))
        else
            States.AutoFollow = false
            Notify("FOLLOW", "Player Not Found!", Color3.fromRGB(255, 50, 50))
        end
    else
        BtnFollowToggle.Text = "Follow Player: OFF"
        ToggleVisual(BtnFollowToggle, false)
        States.FollowTarget = nil
    end
end)

BoxFollowInput.FocusLost:Connect(function()
    if BoxFollowInput.Text ~= "" then
        local target = FindPlayer(BoxFollowInput.Text)
        if target then BoxFollowInput.Text = target.Name end
    end
end)

-- ====================================================
-- [PLAYER LOOPS - SMART LOOPING APPLIED]
-- ====================================================

task.spawn(function()
    while true do
        if States.AutoFollow and States.FollowTarget then
            pcall(function()
                local tChar = States.FollowTarget.Character
                local tHRP = tChar and tChar:FindFirstChild("HumanoidRootPart")
                local myHRP = GetRoot()
                if tHRP and myHRP then
                    myHRP.CFrame = tHRP.CFrame
                end
            end)
            task.wait() -- Fast loop
        else
            task.wait(1) -- Slow loop idle
        end
    end
end)

task.spawn(function()
    while true do
        if States.Speed then
            pcall(function()
                local hum = GetHum()
                if hum then
                    if hum.Sit then
                        local seat = hum.SeatPart
                        if seat then
                            if seat.AssemblyLinearVelocity.Magnitude > 0 then
                                 seat.AssemblyLinearVelocity = seat.CFrame.LookVector * States.SpeedVal
                            end
                        end
                    else
                        hum.WalkSpeed = States.SpeedVal
                    end
                end
            end)
            task.wait()
        else
            task.wait(1)
        end
    end
end)

task.spawn(function()
    while true do
        if States.NoDmg then
            local hum = GetHum()
            if hum and hum.Health < hum.MaxHealth then
                hum.Health = hum.MaxHealth
            end
            task.wait(0.5)
        else
            task.wait(2)
        end
    end
end)

-- ====================================================
-- [BUTTON LOGIC - MAIN/MISC/EVENT]
-- ====================================================

BtnRejoin.MouseButton1Click:Connect(function() Services.TeleportService:Teleport(game.PlaceId, Player) end)
BtnSave.MouseButton1Click:Connect(function() 
    local hrp = GetRoot()
    if hrp then SavedCFrame = hrp.CFrame; BtnSave.Text="SAVED"; Notify("POSITION", "Location Saved!", nil); task.delay(1, function() BtnSave.Text="Save Position" end) end 
end)
BtnLoad.MouseButton1Click:Connect(function() 
    local hrp = GetRoot()
    if SavedCFrame and hrp then hrp.CFrame = SavedCFrame; Notify("POSITION", "Location Loaded!", nil) end 
end)

-- Background Loops (Smart)
task.spawn(function() 
    while true do 
        if States.AutoEquip then 
            ForceEquipRod() 
            task.wait(2)
        else
            task.wait(4)
        end
    end 
end)

-- [NEW] AUTO CAVE CRYSTAL LOOP (SMART: DETECT -> PICKAXE -> TP -> RETURN -> ROD)
task.spawn(function()
    local Islands = Services.Workspace:FindFirstChild("Islands")
    local CryFolder = Islands and Islands:FindFirstChild("Crystal Depths") and Islands["Crystal Depths"]:FindFirstChild("Crystals")
    local OFFSET = CFrame.new(0, 0, 0)
    
    -- Remote Equip
    local EquipRemote = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/EquipToolFromHotbar"]
    
    -- Variables
    local ReturnCFrame = nil

    local function isActiveCrystal(crystal)
        for _, v in ipairs(crystal:GetDescendants()) do
            if v:IsA("PointLight") or v:IsA("Highlight") or v:IsA("MeshPart") or v:IsA("SpecialMesh") or v:IsA("ProximityPrompt") then
                return true
            end
        end
        return false
    end
    
    while true do
        if States.AutoCrystal and CryFolder then
            local hrp = GetRoot()
            if hrp then
                -- Cek apakah ada Crystal yang hidup
                local foundActive = false
                local activeCrystals = {}
                
                for _, crystal in ipairs(CryFolder:GetChildren()) do
                    if isActiveCrystal(crystal) then
                        table.insert(activeCrystals, crystal)
                        foundActive = true
                    end
                end

                if foundActive then
                    -- [STEP 1] Simpan Posisi Awal (Jika belum disimpan)
                    if not ReturnCFrame then
                        ReturnCFrame = hrp.CFrame
                        Notify("CRYSTAL", "Position Saved, Starting...", nil)
                    end

                    -- [STEP 2] Equip Pickaxe (Slot 2)
                    pcall(function() EquipRemote:FireServer(2) end)
                    task.wait(0.5) -- Delay equip

                    -- [STEP 3] Proses Mining (Pergi ke setiap crystal)
                    for _, crystal in ipairs(activeCrystals) do
                        if not States.AutoCrystal then break end
                        
                        -- Ambil Posisi Crystal
                        local cf = nil
                        if crystal:IsA("Model") and crystal.PrimaryPart then
                            cf = crystal.PrimaryPart.CFrame
                        elseif crystal:IsA("BasePart") then
                            cf = crystal.CFrame
                        else
                             local part = crystal:FindFirstChildWhichIsA("BasePart", true)
                             if part then cf = part.CFrame end
                        end

                        if cf then
                            -- Teleport ke Crystal
                            hrp.CFrame = cf * OFFSET
                            task.wait(0.2)

                            -- Ambil (Interact)
                            for _, v in ipairs(crystal:GetDescendants()) do
                                if v:IsA("ProximityPrompt") and v.Enabled then
                                    fireproximityprompt(v, v.HoldDuration)
                                    task.wait(0.1)
                                end
                            end
                        end
                    end
                    
                    -- [STEP 4] Balik ke Posisi Awal
                    if States.AutoCrystal and ReturnCFrame then
                        hrp.CFrame = ReturnCFrame
                    end
                    task.wait(0.5)

                    -- [STEP 5] Equip Rod (Slot 1)
                    pcall(function() EquipRemote:FireServer(1) end)
                    
                else
                    -- [STEP 6] Menunggu Spawn (Idle Mode)
                    -- Jika ReturnCFrame ada, pastikan char tetap di posisi itu saat idle
                    if ReturnCFrame and (hrp.Position - ReturnCFrame.Position).Magnitude > 5 then
                         hrp.CFrame = ReturnCFrame
                    end
                end
            end
            task.wait(1) -- Cek ulang setiap 1 detik
        else
            -- Reset jika fitur dimatikan
            ReturnCFrame = nil
            task.wait(2)
        end
    end
end)

-- [AUTO TAKE CORAL - SMART LOOP]
task.spawn(function()
    while true do
        if States.AutoCoral then
            pcall(function()
                local spawnFolder = Services.Workspace:FindFirstChild("!!! SEARCH ITEM SPAWNS")
                if spawnFolder and spawnFolder:FindFirstChild("Coral") then
                    local validCorals = {}
                    local function GetCorals(folder)
                        for _, v in pairs(folder:GetChildren()) do
                            if v:IsA("Model") or v:IsA("BasePart") then
                                if v:FindFirstChildWhichIsA("ProximityPrompt", true) then
                                    table.insert(validCorals, v)
                                end
                            end
                            if v:IsA("Folder") or v:IsA("Model") then GetCorals(v) end
                        end
                    end
                    GetCorals(spawnFolder.Coral)
                    
                    if #validCorals > 0 then
                        local hrp = GetRoot()
                        if not IsLootingCoral and not States.AutoFarmRelic then
                            if hrp then
                                CoralReturnCFrame = hrp.CFrame
                                IsLootingCoral = true
                                Notify("CORAL", "Found "..#validCorals.." Corals!", Color3.fromRGB(0, 255, 100))
                                SetWoW(true)
                            end
                        end
                        if IsLootingCoral then
                             local v = validCorals[1]
                             if v and v.Parent then
                                 local prompt = v:FindFirstChildWhichIsA("ProximityPrompt", true)
                                 local hrp = GetRoot()
                                 if prompt and hrp then
                                     hrp.CFrame = v:GetPivot() + Vector3.new(0, 3, 0)
                                     task.wait(0.2)
                                     fireproximityprompt(prompt)
                                 end
                             end
                        end
                    else
                         if IsLootingCoral then
                            IsLootingCoral = false
                            local hrp = GetRoot()
                            if CoralReturnCFrame and hrp then hrp.CFrame = CoralReturnCFrame end
                            SetWoW(false)
                         end
                    end
                end
            end)
            task.wait(1.5)
        else
            if IsLootingCoral then IsLootingCoral = false; SetWoW(false) end
            task.wait(3) -- Idle slow loop
        end
    end
end)

-- [AUTO EVENT LOOP - SMART LOOP]
local function FindInFolders(targetName)
    local folders = {Services.Workspace:FindFirstChild("ActiveEvents"), Services.Workspace:FindFirstChild("Props")}
    for _, folder in pairs(folders) do
        if folder then
            for _, v in pairs(folder:GetChildren()) do
                if v:IsA("Model") or v:IsA("BasePart") then
                    if v.Name == targetName or v.Name:find(targetName) then
                        return v
                    end
                end
            end
        end
    end
    return nil
end

local function ScanEvent()
    for _, name in pairs(EventList) do
        local t = FindInFolders(name)
        if t then return t end
    end
    return nil
end

task.spawn(function()
    while true do
        if States.AutoEvent then
            pcall(function()
                local hrp = GetRoot()
                if not hrp then return end
                
                local FoundEvent = ScanEvent()

                if FoundEvent then
                    if not IsInEvent then
                        EventStartCFrame = hrp.CFrame 
                        IsInEvent = true
                        Notify("AUTO HUNT", "Teleport To ( " .. FoundEvent.Name .. " )", Color3.fromRGB(0, 255, 255))
                        SetWoW(true)
                    end
                    local targetPos = FoundEvent:GetPivot().Position
                    local destPos = Vector3.new(targetPos.X, 4, targetPos.Z) 
                    
                    if (hrp.Position - destPos).Magnitude > 5 then
                        hrp.CFrame = CFrame.new(destPos)
                    end
                else
                    if IsInEvent then
                        IsInEvent = false
                        Notify("AUTO HUNT", "Event Finished ", Color3.fromRGB(0, 255, 100))
                        if EventStartCFrame and hrp then 
                            hrp.CFrame = EventStartCFrame 
                            EventStartCFrame = nil 
                        end
                        SetWoW(false) 
                    end
                end
            end)
            task.wait(1)
        else
            task.wait(3)
        end
    end
end)

-- [STATUS DETECTOR]
task.spawn(function() 
    while true do 
        if States.Panel then 
            pcall(function() 
                local ls = Player:FindFirstChild("leaderstats")
                local c = ls and ls:FindFirstChild("Caught") and ls.Caught.Value or 0
                
                LblFishVal.Text = tostring(c):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
                
                local bagText = "0/?"
                local backpackGui = Player:FindFirstChild("PlayerGui") and Player.PlayerGui:FindFirstChild("Backpack")
                if backpackGui then
                    local foundLabel = false
                    for _, v in pairs(backpackGui:GetDescendants()) do
                        if v:IsA("TextLabel") and string.find(v.Text, "/") then 
                            bagText = v.Text 
                            foundLabel = true
                            break 
                        end
                    end
                    if not foundLabel and Player:FindFirstChild("Backpack") then
                        bagText = tostring(#Player.Backpack:GetChildren())
                    end
                else 
                    if Player:FindFirstChild("Backpack") then
                         bagText = tostring(#Player.Backpack:GetChildren())
                    end
                end
                LblInvVal.Text = bagText
            end) 
            task.wait(1)
        else
            task.wait(3)
        end 
    end 
end)

-- [AUTO EXECUTE] MAX FPS UNLOCKER
task.spawn(function()
    if setfpscap then 
        setfpscap(9999) 
    end
end)

task.delay(1, function()
    Main.Visible = true
    FloatHUD.Visible = States.Panel 
end)