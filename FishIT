--[[
    FISCHING SCRIPT - NATIVE UI VERSION (NO LOADSTRING)
    Fix: HTTP 402 Error (Karena script ini tidak download UI dari link luar)
    UI: Simple Built-in Roblox GUI
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local CoreGui = game:GetService("CoreGui")

-- 1. CONFIG & VARIABLES
getgenv().fishingStart = false
getgenv().autoGreat = false
getgenv().mode = "Instant" -- "Instant" or "Blatan"

local Config = {
    Coordinates = { -1.115, 0, 1763.636 },
    Delays = {
        Charge = 1.15,
        Catch = 0.56,
        Reset = 0.20
    }
}

-- 2. REMOTE PATHS
local NetPath = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
local Remotes = {
    Charge      = NetPath:WaitForChild("RF/ChargeFishingRod"),
    Catch       = NetPath:WaitForChild("RF/CatchFishCompleted"),
    Cancel      = NetPath:WaitForChild("RF/CancelFishingInputs"),
    Request     = NetPath:WaitForChild("RF/RequestFishingMinigameStarted"),
    AutoState   = NetPath:WaitForChild("RF/UpdateAutoFishingState"),
}

-- 3. ANTI STUN / BYPASS
local BlockedRemotes = {
    [Remotes.Charge] = true,
    [Remotes.Request] = true,
    [Remotes.Catch] = true,
    [Remotes.Cancel] = true
}

local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    if getgenv().fishingStart and BlockedRemotes[self] and not checkcaller() then
        if method == "InvokeServer" then return task.wait(9e9) 
        elseif method == "FireServer" then return nil end
    end
    return oldNamecall(self, ...)
end)

-- 4. LOGIC FUNGSI
local function SetAutoGreat(bool)
    pcall(function() Remotes.AutoState:InvokeServer({bool}) end)
end

local function LoopInstant()
    if getgenv().autoGreat then SetAutoGreat(true) end
    while getgenv().fishingStart do
        pcall(function() Remotes.Charge:InvokeServer() end)
        task.wait(0.05)
        if not getgenv().fishingStart then break end

        pcall(function() Remotes.Request:InvokeServer(unpack(Config.Coordinates)) end)
        task.wait(Config.Delays.Catch) 
        if not getgenv().fishingStart then break end

        pcall(function() Remotes.Catch:InvokeServer() end)
        task.wait(0.05)
        pcall(function() Remotes.Cancel:InvokeServer() end)
        task.wait(Config.Delays.Charge)
    end
end

local function LoopBlatant()
    if getgenv().autoGreat then SetAutoGreat(true) end
    pcall(function() Remotes.Cancel:InvokeServer() end)
    task.wait(0.1)
    while getgenv().fishingStart do
        task.spawn(function() pcall(function() Remotes.Charge:InvokeServer() end) end)
        task.spawn(function() pcall(function() Remotes.Request:InvokeServer(unpack(Config.Coordinates)) end) end)
        task.wait(Config.Delays.Charge)
        pcall(function() Remotes.Catch:InvokeServer() end)
        task.wait(Config.Delays.Reset)
        pcall(function() Remotes.Cancel:InvokeServer() end)
    end
end

-- 5. BUILD UI (MANUAL CONSTRUCTION)
-- Hapus UI lama jika ada
if CoreGui:FindFirstChild("FischUI") then CoreGui.FischUI:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FischUI"
ScreenGui.Parent = CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true -- Bisa digeser

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Text = "Fisching Native UI"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.Parent = MainFrame

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Text = "Status: STOPPED"
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Position = UDim2.new(0, 0, 0, 40)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 14
StatusLabel.Parent = MainFrame

-- Toggle Button
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Text = "START FISHING"
ToggleBtn.Size = UDim2.new(0.8, 0, 0, 40)
ToggleBtn.Position = UDim2.new(0.1, 0, 0, 70)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
ToggleBtn.TextColor3 = Color3.white
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 16
ToggleBtn.Parent = MainFrame
Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0, 8)

-- Mode Button
local ModeBtn = Instance.new("TextButton")
ModeBtn.Text = "Mode: Instant"
ModeBtn.Size = UDim2.new(0.8, 0, 0, 30)
ModeBtn.Position = UDim2.new(0.1, 0, 0, 120)
ModeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ModeBtn.TextColor3 = Color3.white
ModeBtn.Font = Enum.Font.Gotham
ModeBtn.TextSize = 14
ModeBtn.Parent = MainFrame
Instance.new("UICorner", ModeBtn).CornerRadius = UDim.new(0, 6)

-- Inputs (Charge, Catch, Reset)
local function createInput(name, yPos, defaultKey)
    local Label = Instance.new("TextLabel")
    Label.Text = name
    Label.Size = UDim2.new(0.4, 0, 0, 25)
    Label.Position = UDim2.new(0.1, 0, 0, yPos)
    Label.BackgroundTransparency = 1
    Label.TextColor3 = Color3.white
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = MainFrame
    
    local Box = Instance.new("TextBox")
    Box.Text = tostring(Config.Delays[defaultKey])
    Box.Size = UDim2.new(0.3, 0, 0, 25)
    Box.Position = UDim2.new(0.6, 0, 0, yPos)
    Box.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    Box.TextColor3 = Color3.white
    Box.Parent = MainFrame
    Instance.new("UICorner", Box).CornerRadius = UDim.new(0, 4)
    
    Box.FocusLost:Connect(function()
        local num = tonumber(Box.Text)
        if num then Config.Delays[defaultKey] = num end
    end)
end

createInput("Charge Delay:", 170, "Charge")
createInput("Catch Delay:", 205, "Catch")
createInput("Reset Delay:", 240, "Reset")

-- Unstuck Button
local UnstuckBtn = Instance.new("TextButton")
UnstuckBtn.Text = "Unstuck Character"
UnstuckBtn.Size = UDim2.new(0.8, 0, 0, 30)
UnstuckBtn.Position = UDim2.new(0.1, 0, 0, 290)
UnstuckBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
UnstuckBtn.TextColor3 = Color3.white
UnstuckBtn.Parent = MainFrame
Instance.new("UICorner", UnstuckBtn).CornerRadius = UDim.new(0, 6)

-- 6. UI LOGIC CONNECTIONS

ToggleBtn.MouseButton1Click:Connect(function()
    getgenv().fishingStart = not getgenv().fishingStart
    
    if getgenv().fishingStart then
        ToggleBtn.Text = "STOP FISHING"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
        StatusLabel.Text = "Status: RUNNING (" .. getgenv().mode .. ")"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        -- Start Logic
        pcall(function() Remotes.Cancel:InvokeServer() end)
        if getgenv().mode == "Blatan" then
            task.spawn(LoopBlatant)
        else
            task.spawn(LoopInstant)
        end
    else
        ToggleBtn.Text = "START FISHING"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        StatusLabel.Text = "Status: STOPPED"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        
        -- Stop Logic
        pcall(function() Remotes.Catch:InvokeServer() end)
        task.wait(0.1)
        pcall(function() Remotes.Cancel:InvokeServer() end)
    end
end)

ModeBtn.MouseButton1Click:Connect(function()
    if getgenv().mode == "Instant" then
        getgenv().mode = "Blatan"
    else
        getgenv().mode = "Instant"
    end
    ModeBtn.Text = "Mode: " .. getgenv().mode
end)

UnstuckBtn.MouseButton1Click:Connect(function()
    pcall(function() Remotes.Cancel:InvokeServer() end)
    pcall(function() Remotes.Catch:InvokeServer() end)
    StatusLabel.Text = "Status: Unstuck Sent"
end)

-- Anti AFK
task.spawn(function()
    Players.LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
end)
