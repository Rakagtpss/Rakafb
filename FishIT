--[[
    FIXED FISHING SCRIPT (ANTI-SYNTAX ERROR)
    - Fixes "Expected identifier" error
    - Corrected Path Names based on your request
    - Auto-Detects Net Folder
]]

local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local Window = OrionLib:MakeWindow({Name = "Fishing Fixed", HidePremium = false, SaveConfig = true, ConfigFolder = "FishConfig"})

-- =====================================================
-- üõ†Ô∏è 1. SAFE PATHFINDER (ANTI ERROR)
-- =====================================================
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Fungsi untuk mencari folder net secara otomatis (Biar gak error kalau versi berubah)
local function GetNetPath()
    local packages = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
    
    -- Cara 1: Cari folder yang namanya mirip "sleitnick_net"
    for _, folder in pairs(packages:GetChildren()) do
        if folder.Name:match("sleitnick_net") then
            local net = folder:FindFirstChild("net")
            if net then return net end
        end
    end
    
    -- Cara 2: Cari folder "net" langsung (Fallback)
    return packages:FindFirstChild("net", true)
end

local NetPath = GetNetPath()

if not NetPath then
    OrionLib:MakeNotification({
        Name = "Critical Error",
        Content = "Folder 'net' tidak ditemukan! Cek apakah game sudah update.",
        Time = 5
    })
    return -- Stop script jika path salah
end

-- =====================================================
-- üì° 2. REMOTE DEFINITIONS (SESUAI REQUEST)
-- =====================================================
-- Kita gunakan WaitForChild dengan string agar tidak error Syntax '/'

local function GetRemote(name)
    local remote = NetPath:FindFirstChild(name)
    if not remote then
        warn("Remote tidak ditemukan: " .. name) 
        return nil
    end
    return remote
end

local ChargeRod     = GetRemote("RF/ChargeFishingRod")
local RequestGame   = GetRemote("RF/RequestFishingMinigameStarted")
local CatchComplete = GetRemote("RF/CatchFishCompleted") -- Nama sesuai request kamu
local CancelInput   = GetRemote("RF/CancelFishingInputs")
local MarkAuto      = GetRemote("RF/MarkAutoFishingUsed")
local UpdateAuto    = GetRemote("RF/UpdateAutoFishingState")
local UpdateRadar   = GetRemote("RF/UpdateFishingRadar")

-- Cek apakah remote penting ada
if not ChargeRod or not CatchComplete then
    OrionLib:MakeNotification({Name = "Error", Content = "Beberapa Remote Fishing hilang/ganti nama.", Time = 5})
end

-- Settings Variable
getgenv().fishingStart = false
local useAutoDetect = true
local reactionTime = 0.1 -- Waktu jeda
local defaultArgs = { -1.115296483039856, 0, 1763651451.636425 }

-- =====================================================
-- üß† 3. LOGIC UTAMA
-- =====================================================

local function WaitForBite()
    if not useAutoDetect then
        task.wait(5.5) -- Manual delay jika auto detect mati
        return true
    end

    local startTime = tick()
    local timeout = 20
    
    -- Loop menunggu UI muncul
    repeat
        -- Cek berbagai kemungkinan nama UI saat bite
        local shake = PlayerGui:FindFirstChild("shakeui") 
        local reel = PlayerGui:FindFirstChild("reel")
        local minigame = PlayerGui:FindFirstChild("minigame")
        
        if (shake and shake.Enabled) or (reel and reel.Enabled) or (minigame and minigame.Enabled) then
            task.wait(reactionTime)
            return true
        end
        task.wait(0.1)
    until (tick() - startTime) > timeout
    
    return false
end

local function StartFishing()
    -- Reset Input dulu biar bersih
    if CancelInput then pcall(function() CancelInput:InvokeServer() end) end
    task.wait(0.5)

    while getgenv().fishingStart do
        -- 1. Charge Rod
        if ChargeRod then pcall(function() ChargeRod:InvokeServer() end) end
        task.wait(0.15)
        if not getgenv().fishingStart then break end

        -- 2. Lempar Umpan
        if RequestGame then RequestGame:InvokeServer(unpack(defaultArgs)) end
        
        -- 3. Mark Auto (Opsional, biar aman)
        if MarkAuto then pcall(function() MarkAuto:InvokeServer() end) end

        -- 4. Tunggu Ikan
        local detected = WaitForBite()
        
        if not getgenv().fishingStart then break end

        -- 5. Tarik Ikan (Catch)
        if detected then
            -- Note: CatchComplete biasanya butuh argumen sukses, tapi untuk RF seringkali kosong/true
            if CatchComplete then pcall(function() CatchComplete:InvokeServer(true) end) end
        end
        
        -- 6. Reset Loop
        task.wait(0.2)
        if CancelInput then pcall(function() CancelInput:InvokeServer() end) end
        task.wait(0.5)
    end
end

-- =====================================================
-- üñ•Ô∏è 4. UI SETUP
-- =====================================================

local Tab = Window:MakeTab({
	Name = "Fishing",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

Tab:AddToggle({
	Name = "Aktifkan Fishing",
	Default = false,
	Callback = function(Value)
		getgenv().fishingStart = Value
        if Value then
            StartFishing()
        else
            if CancelInput then pcall(function() CancelInput:InvokeServer() end) end
        end
	end    
})

Tab:AddToggle({
	Name = "Auto Detect (UI)",
	Default = true,
	Callback = function(Value)
		useAutoDetect = Value
	end    
})

Tab:AddLabel("Status: Script Fixed & Path Updated")

OrionLib:Init()
