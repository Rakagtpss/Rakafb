--[[
    ðŸ‘‘ GEMINI GOD MODE FISHING SCRIPT
    Build Version: 4.0 (Ultimate AI)
    Language: Lua / Roblox
    Target: RF/CatchFishCompleted (InvokeServer)
    
    Features:
    - Multi-Threaded Execution (Anti-Freeze)
    - Hybrid Control (AI Auto vs Manual Sliders)
    - Safe Remote Handling (pcall protection)
    - Memory Leak Protection
]]

-- // 1. BOOTSTRAP & UI LIBRARY //
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Gemini AI âš¡ God Mode",
    SubTitle = "Fishing Dominator",
    TabWidth = 160,
    Size = UDim2.fromOffset(500, 350),
    Acrylic = true, 
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftControl 
})

local Tabs = {
    Main = Window:AddTab({ Title = "Fishing Control", Icon = "database" }),
    Settings = Window:AddTab({ Title = "System", Icon = "settings" })
}

-- // 2. SYSTEM VARIABLES //
local Options = Fluent.Options
local State = {
    IsRunning = false,
    Mode = "Manual" -- "Manual" or "AI"
}

-- // 3. REMOTE DISCOVERY (AUTO-DETECT) //
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")

-- [CRITICAL] Mapped Remotes sesuai permintaan user
local Remotes = {
    Charge   = Net:WaitForChild("RF/ChargeFishingRod"),
    Request  = Net:WaitForChild("RF/RequestFishingMinigameStarted"),
    Complete = Net:WaitForChild("RF/CatchFishCompleted"), -- [MODIFIED] InvokeServer Target
    Cancel   = Net:WaitForChild("RF/CancelFishingInputs")
}

-- Cast Arguments (Center of Ocean)
local CastPosition = { -1.115296483039856, 0, 1763651451.636425 }

-- // 4. THE GEMINI ENGINE (LOGIC) //

local function SafeInvoke(remote, args)
    -- Menggunakan pcall agar script tidak berhenti jika server lag/error
    local success, result = pcall(function()
        if args then
            return remote:InvokeServer(unpack(args))
        else
            return remote:InvokeServer()
        end
    end)
    return success
end

local function RunFishingEngine()
    -- Thread terpisah agar UI tidak freeze
    task.spawn(function()
        while State.IsRunning do
            local reelDelay = 0
            local baitDelay = 0

            -- Tentukan kecepatan berdasarkan Mode
            if Options.AIMode.Value then
                -- Mode AI: Kecepatan maksimum yang aman (0.05s)
                reelDelay = 0.05 
                baitDelay = 0.1 
            else
                -- Mode Manual: Mengambil nilai dari Slider
                reelDelay = Options.ReelSlider.Value
                baitDelay = Options.BaitSlider.Value
            end

            -- [STEP 1]: Prepare & Charge
            SafeInvoke(Remotes.Cancel) -- Reset input sebelumnya
            task.wait(0.05)
            SafeInvoke(Remotes.Charge)
            
            -- [STEP 2]: Cast (Request Game)
            SafeInvoke(Remotes.Request, CastPosition)
            
            -- [STEP 3]: Reel Delay (Simulasi menunggu ikan / Instant)
            task.wait(reelDelay)
            if not State.IsRunning then break end

            -- [STEP 4]: CATCH (The Main Event)
            -- Kita menggunakan spawn disini agar invoke tidak memblokir loop jika server lambat
            task.spawn(function()
                SafeInvoke(Remotes.Complete)
            end)

            -- [STEP 5]: Bait/Reset Delay
            task.wait(baitDelay)
            
            -- [STEP 6]: Cleanup
            SafeInvoke(Remotes.Cancel)
        end
        
        -- Matikan total saat loop berhenti
        SafeInvoke(Remotes.Cancel)
    end)
end

-- // 5. UI CONSTRUCTION //

-- Toggle Utama
local ToggleMaster = Tabs.Main:AddToggle("MasterSwitch", {Title = "Enable Fishing", Default = false })

ToggleMaster:OnChanged(function()
    State.IsRunning = Options.MasterSwitch.Value
    if State.IsRunning then
        Fluent:Notify({Title = "Gemini AI", Content = "Fishing Engine: STARTED", Duration = 3})
        RunFishingEngine()
    else
        Fluent:Notify({Title = "Gemini AI", Content = "Fishing Engine: STOPPED", Duration = 3})
    end
end)

Tabs.Main:AddSection("AI Intelligence")

-- Toggle Mode AI vs Manual
local ToggleAI = Tabs.Main:AddToggle("AIMode", {Title = "âš¡ Super Fast AI Mode (Ignore Sliders)", Default = true })

ToggleAI:OnChanged(function()
    if Options.AIMode.Value then
        Fluent:Notify({Title = "Mode Changed", Content = "AI Mode Active: Max Speed", SubContent = "Sliders dinonaktifkan", Duration = 3})
    else
        Fluent:Notify({Title = "Mode Changed", Content = "Manual Mode", SubContent = "Menggunakan delay dari slider", Duration = 3})
    end
end)

-- Slider Custom (Hanya aktif jika AI Mode OFF secara logika, tapi tetap ditampilkan)
local ReelSlider = Tabs.Main:AddSlider("ReelSlider", {
    Title = "Custom Reel Delay",
    Description = "Waktu tarik kail (Semakin kecil = Cepat)",
    Default = 0.5,
    Min = 0.05,
    Max = 2.0,
    Rounding = 2,
    Callback = function(Value)
        -- Value update realtime
    end
})

local BaitSlider = Tabs.Main:AddSlider("BaitSlider", {
    Title = "Custom Bait/Reset Delay",
    Description = "Jeda sebelum melempar lagi",
    Default = 0.5,
    Min = 0.1,
    Max = 2.0,
    Rounding = 2,
    Callback = function(Value)
        -- Value update realtime
    end
})

Tabs.Main:AddButton({
    Title = "ðŸš‘ Emergency Unstuck",
    Description = "Tekan ini jika karakter nyangkut",
    Callback = function()
        SafeInvoke(Remotes.Cancel)
        Fluent:Notify({Title = "System", Content = "Character inputs reset.", Duration = 2})
    end
})

-- // 6. FINALIZING //
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:BuildConfigSection(Tabs.Settings)
InterfaceManager:BuildInterfaceSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = "Gemini Code Success",
    Content = "Script Loaded. Remote Target: RF/CatchFishCompleted",
    Duration = 5
})
