local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

-- --- 1. SETUP REMOTE FUNCTIONS ---
-- Mengakses folder remote dengan aman
local Packages = ReplicatedStorage:WaitForChild("Packages")
local Index = Packages:WaitForChild("_Index")
local Sleitnick = Index:WaitForChild("sleitnick_net@0.2.0")
local NetFolder = Sleitnick:WaitForChild("net")

-- Mendefinisikan Remote Functions (Sesuai request)
local Remotes = {
    ChargeRod = NetFolder:WaitForChild("RF/ChargeFishingRod"),
    CatchCompleted = NetFolder:WaitForChild("RF/CatchFishCompleted"),
    CancelInputs = NetFolder:WaitForChild("RF/CancelFishingInputs"),
    MarkUsed = NetFolder:WaitForChild("RF/MarkAutoFishingUsed"),
    RequestMinigame = NetFolder:WaitForChild("RF/RequestFishingMinigameStarted"),
    UpdateState = NetFolder:WaitForChild("RF/UpdateAutoFishingState"),
    UpdateRadar = NetFolder:WaitForChild("RF/UpdateFishingRadar"),
}

-- --- 2. CONFIG VARIABLE ---
local Config = {
    IsActive = false,
    MinShakeDelay = 0.5, -- Default Min
    MaxShakeDelay = 1.2, -- Default Max
}

-- --- 3. UI GENERATION (Tampilan) ---
if getgenv and getgenv().FishUI then getgenv().FishUI:Destroy() end
if CoreGui:FindFirstChild("FishingConfigUI") then CoreGui.FishingConfigUI:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FishingConfigUI"
if pcall(function() ScreenGui.Parent = CoreGui end) then else ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

-- Frame Utama
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 260, 0, 200)
MainFrame.Position = UDim2.new(0.5, -130, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
local UICorner = Instance.new("UICorner"); UICorner.CornerRadius = UDim.new(0, 8); UICorner.Parent = MainFrame

-- Judul
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "ðŸŽ£ Custom Shake Auto"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = MainFrame

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Position = UDim2.new(0, 0, 0, 25)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Idle..."
StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.Parent = MainFrame

-- Input Min Delay
local MinInput = Instance.new("TextBox")
MinInput.Size = UDim2.new(0, 100, 0, 30)
MinInput.Position = UDim2.new(0, 20, 0, 60)
MinInput.PlaceholderText = "Min Delay"
MinInput.Text = tostring(Config.MinShakeDelay)
MinInput.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
MinInput.TextColor3 = Color3.fromRGB(255, 255, 255)
MinInput.Font = Enum.Font.Gotham
MinInput.Parent = MainFrame
local MinCorner = Instance.new("UICorner"); MinCorner.CornerRadius = UDim.new(0, 4); MinCorner.Parent = MinInput

MinInput.FocusLost:Connect(function()
    Config.MinShakeDelay = tonumber(MinInput.Text) or Config.MinShakeDelay
end)

-- Input Max Delay
local MaxInput = Instance.new("TextBox")
MaxInput.Size = UDim2.new(0, 100, 0, 30)
MaxInput.Position = UDim2.new(0, 140, 0, 60)
MaxInput.PlaceholderText = "Max Delay"
MaxInput.Text = tostring(Config.MaxShakeDelay)
MaxInput.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
MaxInput.TextColor3 = Color3.fromRGB(255, 255, 255)
MaxInput.Font = Enum.Font.Gotham
MaxInput.Parent = MainFrame
local MaxCorner = Instance.new("UICorner"); MaxCorner.CornerRadius = UDim.new(0, 4); MaxCorner.Parent = MaxInput

MaxInput.FocusLost:Connect(function()
    Config.MaxShakeDelay = tonumber(MaxInput.Text) or Config.MaxShakeDelay
end)

-- Tombol Toggle
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(0, 220, 0, 40)
ToggleBtn.Position = UDim2.new(0, 20, 0, 110)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah
ToggleBtn.Text = "START"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 18
ToggleBtn.Parent = MainFrame
local BtnCorner = Instance.new("UICorner"); BtnCorner.CornerRadius = UDim.new(0, 6); BtnCorner.Parent = ToggleBtn

-- Drag Logic
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true; dragStart = input.Position; startPos = MainFrame.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
    end
end)
MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then update(input) end end)

-- --- 4. MAIN SCRIPT (LOGIKA AUTO FISHING) ---

local function FishingRoutine()
    task.spawn(function()
        while Config.IsActive do
            -- 1. LEMPAR KAIL (Charge Rod)
            StatusLabel.Text = "Casting Rod..."
            -- [!] HARUS DIISI: Biasanya butuh Power (angka) dan Posisi (Vector3)
            -- Contoh: Remotes.ChargeRod:InvokeServer(100, Vector3.new(0,0,0)) 
            local castSuccess = pcall(function()
                Remotes.ChargeRod:InvokeServer() -- <-- ISI ARGUMEN DISINI
            end)
            
            if not castSuccess then
                warn("Gagal melempar kail. Cek Argumen Remote.")
            end
            
            task.wait(2) -- Waktu animasi lempar
            
            -- 2. TUNGGU SHAKE DELAY (Custom Delay)
            local delay = Config.MinShakeDelay + (math.random() * (Config.MaxShakeDelay - Config.MinShakeDelay))
            StatusLabel.Text = "Waiting Delay: " .. string.format("%.2f", delay) .. "s"
            task.wait(delay)
            
            -- 3. REQUEST MINIGAME
            StatusLabel.Text = "Starting Minigame..."
            -- [!] Minta server mulai minigame
            Remotes.RequestMinigame:InvokeServer() -- <-- ISI ARGUMEN JIKA PERLU
            
            task.wait(0.5) -- Jeda sebentar
            
            -- 4. SELESAI (Catch Fish)
            StatusLabel.Text = "Catching Fish..."
            -- [!] Ini bagian paling penting. Server butuh bukti bahwa minigame selesai.
            -- Cek RemoteSpy untuk melihat apa yang dikirim di sini.
            Remotes.CatchCompleted:InvokeServer() -- <-- ISI ARGUMEN DISINI
            
            task.wait(1.5) -- Cooldown sebelum mengulang
        end
        
        -- Reset Text jika berhenti
        StatusLabel.Text = "Stopped."
    end)
end

-- --- 5. EVENT HANDLER ---

ToggleBtn.MouseButton1Click:Connect(function()
    Config.IsActive = not Config.IsActive
    
    if Config.IsActive then
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 60) -- Hijau
        ToggleBtn.Text = "STOP"
        print("âœ… Auto Fish Started")
        FishingRoutine()
    else
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah
        ToggleBtn.Text = "START"
        print("â¹ Auto Fish Stopped")
    end
end)

if getgenv then getgenv().FishUI = ScreenGui end
