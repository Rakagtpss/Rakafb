local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Auto Fishing " .. Fluent.Version,
    SubTitle = "by Gemini",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true, 
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl 
})

-- ===========================
-- VARIABLES
-- ===========================
getgenv().fishingStart = false
getgenv().spamCatch = false
getgenv().delayReel = 0.1
getgenv().delayBait = 0.1

local rs = game:GetService("ReplicatedStorage")
local net = rs:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0").net

-- Arguments
local args = { -1.115296483039856, 0, 1763651451.636425 }

-- Remote Definitions
local ChargeRod    = net["RF/ChargeFishingRod"]
local RequestGame  = net["RF/RequestFishingMinigameStarted"]
local CompleteGame = net["RF/CatchFishCompleted"] -- Target Update
local CancelInput  = net["RF/CancelFishingInputs"]

-- ===========================
-- LOGIC
-- ===========================

local function executeCatch()
    if getgenv().spamCatch then
        -- SPAM MODE (5x Trigger)
        for i = 1, 5 do
            task.spawn(function()
                pcall(function() CompleteGame:InvokeServer() end)
            end)
        end
    else
        -- NORMAL MODE (1x Trigger)
        pcall(function() CompleteGame:InvokeServer() end)
    end
end

local function startFishingLoop()
    task.spawn(function()
        while getgenv().fishingStart do
            -- 1. Charge
            pcall(function() ChargeRod:InvokeServer() end)
            task.wait(0.05)
            if not getgenv().fishingStart then break end

            -- 2. Request Game
            pcall(function() RequestGame:InvokeServer(unpack(args)) end)

            -- 3. Delay Reel
            task.wait(getgenv().delayReel)
            if not getgenv().fishingStart then break end

            -- 4. Catch (Spam or Normal)
            executeCatch()

            -- 5. Delay Bait
            task.wait(getgenv().delayBait)
            
            -- 6. Cancel Input (Safety)
            pcall(function() CancelInput:InvokeServer() end)
            
            task.wait(0.01)
        end
    end)
end

-- ===========================
-- UI ELEMENTS
-- ===========================

local Tabs = {
    Main = Window:AddTab({ Title = "Fishing", Icon = "fish" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

Tabs.Main:AddToggle("AutoFish", {
    Title = "Active Auto Fishing",
    Default = false
}):OnChanged(function()
    getgenv().fishingStart = Options.AutoFish.Value
    if getgenv().fishingStart then
        startFishingLoop()
        Fluent:Notify({
            Title = "Fishing Started",
            Content = "Auto fishing sedang berjalan.",
            Duration = 3
        })
    else
        pcall(function() CancelInput:InvokeServer() end)
        Fluent:Notify({
            Title = "Fishing Stopped",
            Content = "Auto fishing dimatikan.",
            Duration = 3
        })
    end
end)

Tabs.Main:AddToggle("SpamMode", {
    Title = "Spam Catch Mode (Brutal)",
    Description = "Mengirim sinyal tangkap berkali-kali (Risiko Ping Naik)",
    Default = false
}):OnChanged(function()
    getgenv().spamCatch = Options.SpamMode.Value
end)

Tabs.Main:AddSlider("SliderReel", {
    Title = "Delay Reel (Tunggu Ikan)",
    Description = "Waktu tunggu sebelum menarik kail",
    Default = 0.1,
    Min = 0,
    Max = 2,
    Rounding = 2,
    Callback = function(Value)
        getgenv().delayReel = Value
    end
})

Tabs.Main:AddSlider("SliderBait", {
    Title = "Delay Bait (Jeda Lempar)",
    Description = "Waktu jeda sebelum melempar kembali",
    Default = 0.1,
    Min = 0,
    Max = 2,
    Rounding = 2,
    Callback = function(Value)
        getgenv().delayBait = Value
    end
})

Tabs.Main:AddButton({
    Title = "Unstuck Character",
    Description = "Klik jika karakter nge-bug",
    Callback = function()
        pcall(function() CancelInput:InvokeServer() end)
        if game.Players.LocalPlayer.Character then
            game.Players.LocalPlayer.Character.Humanoid.Health = 0
        end
    end
})

Window:SelectTab(1)
