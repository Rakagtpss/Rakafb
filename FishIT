--[[
    FISCHING SCRIPT - FLUENT UI VERSION
    Reason: Previous UI (WindUI) returned HTTP 402 (Payment Required).
    New UI: Fluent (Stable & Free)
]]

-- 1. LOAD LIBRARY (FLUENT)
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- 2. SERVICES & REMOTES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualUser = game:GetService("VirtualUser")

-- Path Remote Terbaru (Sesuai Request)
local NetPath = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")

local Remotes = {
    Charge      = NetPath:WaitForChild("RF/ChargeFishingRod"),
    Catch       = NetPath:WaitForChild("RF/CatchFishCompleted"),
    Cancel      = NetPath:WaitForChild("RF/CancelFishingInputs"),
    Request     = NetPath:WaitForChild("RF/RequestFishingMinigameStarted"),
    AutoState   = NetPath:WaitForChild("RF/UpdateAutoFishingState"),
    Radar       = NetPath:WaitForChild("RF/UpdateFishingRadar")
}

-- 3. VARIABLES
getgenv().fishingStart = false
getgenv().autoGreat = false

local Config = {
    Mode = "Instant", 
    Coordinates = { -1.115, 0, 1763.636 },
    Delays = {
        Charge = 1.15,
        Catch = 0.56,
        Reset = 0.20
    }
}

-- 4. ANTI-STUN LOGIC
local BlockedRemotes = {
    [Remotes.Charge] = true,
    [Remotes.Request] = true,
    [Remotes.Catch] = true,
    [Remotes.Cancel] = true
}

local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    if getgenv().fishingStart and BlockedRemotes[self] and not checkcaller() then
        if method == "InvokeServer" then return task.wait(9e9) 
        elseif method == "FireServer" then return nil end
    end
    return oldNamecall(self, ...)
end)

-- 5. FISHING FUNCTIONS
local function SetAutoGreat(bool)
    pcall(function() Remotes.AutoState:InvokeServer({bool}) end)
end

local function LoopInstant()
    if getgenv().autoGreat then SetAutoGreat(true) end
    while getgenv().fishingStart do
        pcall(function() Remotes.Charge:InvokeServer() end)
        task.wait(0.05)
        if not getgenv().fishingStart then break end

        pcall(function() Remotes.Request:InvokeServer(unpack(Config.Coordinates)) end)
        task.wait(Config.Delays.Catch) 
        if not getgenv().fishingStart then break end

        pcall(function() Remotes.Catch:InvokeServer() end)
        task.wait(0.05)
        pcall(function() Remotes.Cancel:InvokeServer() end)
        task.wait(Config.Delays.Charge)
    end
end

local function LoopBlatant()
    if getgenv().autoGreat then SetAutoGreat(true) end
    pcall(function() Remotes.Cancel:InvokeServer() end)
    task.wait(0.1)

    while getgenv().fishingStart do
        task.spawn(function() pcall(function() Remotes.Charge:InvokeServer() end) end)
        task.spawn(function() pcall(function() Remotes.Request:InvokeServer(unpack(Config.Coordinates)) end) end)
        task.wait(Config.Delays.Charge)
        pcall(function() Remotes.Catch:InvokeServer() end)
        task.wait(Config.Delays.Reset)
        pcall(function() Remotes.Cancel:InvokeServer() end)
    end
end

-- 6. UI CONSTRUCTION (FLUENT)
local Window = Fluent:CreateWindow({
    Title = "Fisching Script",
    SubTitle = "by Gemini",
    TabWidth = 160,
    Size = UDim2.fromOffset(500, 350),
    Acrylic = true, 
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

-- MAIN TAB
Tabs.Main:AddParagraph({
    Title = "Fishing Control",
    Content = "Select mode and enable fishing."
})

Tabs.Main:AddDropdown("ModeSelector", {
    Title = "Fishing Mode",
    Values = {"Instant", "Blatan"},
    Multi = false,
    Default = "Instant",
    Callback = function(val)
        Config.Mode = val
    end
})

local ToggleFishing = Tabs.Main:AddToggle("EnableFishing", {Title = "Start Fishing", Default = false })
ToggleFishing:OnChanged(function()
    local state = Options.EnableFishing.Value
    getgenv().fishingStart = state
    
    if state then
        pcall(function() Remotes.Cancel:InvokeServer() end)
        if Config.Mode == "Blatan" then
            task.spawn(LoopBlatant)
        else
            task.spawn(LoopInstant)
        end
        Fluent:Notify({Title = "Started", Content = "Mode: " .. Config.Mode, Duration = 3})
    else
        if getgenv().autoGreat then SetAutoGreat(false) end
        pcall(function() Remotes.Catch:InvokeServer() end)
        task.wait(0.1)
        pcall(function() Remotes.Cancel:InvokeServer() end)
        Fluent:Notify({Title = "Stopped", Content = "Fishing stopped.", Duration = 3})
    end
end)

Tabs.Main:AddToggle("AutoGreat", {Title = "Auto Perfect Catch", Default = false, Callback = function(state)
    getgenv().autoGreat = state
    if state and getgenv().fishingStart then SetAutoGreat(true) end
end})

Tabs.Main:AddButton({
    Title = "Unstuck Character",
    Description = "Fix if you can't move",
    Callback = function()
        pcall(function() Remotes.Cancel:InvokeServer() end)
        pcall(function() Remotes.Catch:InvokeServer() end)
        Fluent:Notify({Title = "Unstuck", Content = "Character reset sent.", Duration = 2})
    end
})

-- SETTINGS TAB (CUSTOM DELAYS)
Tabs.Settings:AddParagraph({
    Title = "Custom Delays",
    Content = "Adjust timing (in seconds). Only change if you know what you are doing."
})

local InputCharge = Tabs.Settings:AddInput("DelayCharge", {
    Title = "Delay: Charge Rod",
    Default = tostring(Config.Delays.Charge),
    Placeholder = "1.15",
    Numeric = true,
    Finished = true,
    Callback = function(Value)
        local num = tonumber(Value)
        if num then Config.Delays.Charge = num end
    end
})

local InputCatch = Tabs.Settings:AddInput("DelayCatch", {
    Title = "Delay: Catch Fish (Instant Mode)",
    Default = tostring(Config.Delays.Catch),
    Placeholder = "0.56",
    Numeric = true,
    Finished = true,
    Callback = function(Value)
        local num = tonumber(Value)
        if num then Config.Delays.Catch = num end
    end
})

local InputReset = Tabs.Settings:AddInput("DelayReset", {
    Title = "Delay: Reset (Blatan Mode)",
    Default = tostring(Config.Delays.Reset),
    Placeholder = "0.20",
    Numeric = true,
    Finished = true,
    Callback = function(Value)
        local num = tonumber(Value)
        if num then Config.Delays.Reset = num end
    end
})

-- 7. ANTI AFK
task.spawn(function()
    Players.LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
end)

Window:SelectTab(1)
Fluent:Notify({Title = "Script Loaded", Content = "Fluent UI Version Ready!", Duration = 5})
