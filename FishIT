local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Mini Fishing Config",
    SubTitle = "Input Manual",
    TabWidth = 160,
    Size = UDim2.fromOffset(450, 350), -- Ukuran pas untuk Input Box
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.RightControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- =====================================================
-- GLOBAL VARS & CONFIG
-- =====================================================
getgenv().fishingStart = false
getgenv().customDelayCharge = 1.15 -- Default Reel Delay
getgenv().customDelayReset = 0.2   -- Default Bait/Reset Delay
getgenv().autoGreat = false

-- Koordinat Fishing (Disesuaikan)
local args = { -1.115296483039856, 0, 1763651451.636425 }

-- Services & Paths
local rs = game:GetService("ReplicatedStorage")
local net = rs.Packages["_Index"]["sleitnick_net@0.2.0"].net 

-- Remotes Definitions
local ChargeRod    = net:WaitForChild("RF/ChargeFishingRod")
local RequestGame  = net:WaitForChild("RF/RequestFishingMinigameStarted")
local CompleteGame = net:WaitForChild("RE/FishingCompleted")
local CancelInput  = net:WaitForChild("RF/CancelFishingInputs")
local CatchFish    = net:WaitForChild("RF/CatchFishCompleted") -- Path request kamu

-- =====================================================
-- LOGIKA BYPASS & FISHING
-- =====================================================

local FishingBlocker = { Enabled = false }
local BLOCKED_REMOTES = {
    [ChargeRod]    = true,
    [RequestGame]  = true,
    [CompleteGame] = true,
    [CancelInput]  = true,
    [CatchFish]    = true,
}

-- Hook Metamethod (Anti-Lag / Thread Freeze Bypass)
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    if FishingBlocker.Enabled and BLOCKED_REMOTES[self] and not checkcaller() then
        if method == "InvokeServer" then
            return task.wait(9e9) 
        elseif method == "FireServer" then
            return nil
        end
    end
    return oldNamecall(self, ...)
end)

local MAX_PARALLEL = 4
local active = 0

local function lightSpawn(fn)
    if active >= MAX_PARALLEL then return end
    active = active + 1
    task.spawn(function()
        pcall(fn)
        active = active - 1
    end)
end

local function startFishingLoop()
    -- Update Auto Great State
    if getgenv().autoGreat then
        local agState = { true }
        pcall(function() 
            game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/UpdateAutoFishingState"]:InvokeServer(unpack(agState))
        end)
    end

    pcall(function() CancelInput:InvokeServer() end)
    task.wait(0.055)

    while getgenv().fishingStart do
        lightSpawn(function() ChargeRod:InvokeServer() end)
        lightSpawn(function() RequestGame:InvokeServer(unpack(args)) end)
        
        -- MENGGUNAKAN DELAY DARI INPUT BOX
        task.wait(getgenv().customDelayCharge) 
        
        pcall(function() CompleteGame:FireServer() end)
        pcall(function() CatchFish:InvokeServer() end)
        
        -- MENGGUNAKAN DELAY DARI INPUT BOX
        task.wait(getgenv().customDelayReset) 
        
        pcall(function() CancelInput:InvokeServer() end)
    end
end

-- =====================================================
-- UI COMPONENTS (INPUT BOX VERSION)
-- =====================================================

Tabs.Main:AddParagraph({
    Title = "Fishing Control",
    Content = "Masukkan angka delay secara manual (Contoh: 0.15)"
})

-- Toggle Fishing
local Toggle = Tabs.Main:AddToggle("MyToggle", {Title = "Enable Fishing", Default = false })

Toggle:OnChanged(function()
    getgenv().fishingStart = Toggle.Value
    FishingBlocker.Enabled = Toggle.Value
    
    if Toggle.Value then
        Fluent:Notify({Title = "Fishing", Content = "Started!", Duration = 2})
        task.spawn(startFishingLoop)
    else
        Fluent:Notify({Title = "Fishing", Content = "Stopped", Duration = 2})
        if getgenv().autoGreat then
            pcall(function() 
                game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/UpdateAutoFishingState"]:InvokeServer(false)
            end)
        end
        pcall(function() CompleteGame:FireServer() end)
        pcall(function() CancelInput:InvokeServer() end)
    end
end)

-- INPUT BOX: Delay Reel (Charge)
local InputReel = Tabs.Main:AddInput("InputReel", {
    Title = "Delay Reel (Charge)",
    Description = "Default: 1.15",
    Default = "1.15",
    Placeholder = "Masukkan angka...",
    Numeric = true, -- Hanya angka
    Finished = false, -- Update saat ngetik atau enter
    Callback = function(Value)
        local num = tonumber(Value)
        if num then
            getgenv().customDelayCharge = num
        end
    end
})

-- INPUT BOX: Delay Bait (Reset)
local InputBait = Tabs.Main:AddInput("InputBait", {
    Title = "Delay Bait (Reset)",
    Description = "Default: 0.2",
    Default = "0.2",
    Placeholder = "Masukkan angka...",
    Numeric = true, -- Hanya angka
    Finished = false,
    Callback = function(Value)
        local num = tonumber(Value)
        if num then
            getgenv().customDelayReset = num
        end
    end
})

-- Auto Great Toggle
Tabs.Main:AddToggle("AutoGreatToggle", {
    Title = "Auto Great",
    Default = false,
    Callback = function(state)
        getgenv().autoGreat = state
    end
})

-- Unstuck Button
Tabs.Main:AddButton({
    Title = "Unstuck / Fix Rod",
    Description = "Klik jika pancingan macet",
    Callback = function()
        pcall(function() CompleteGame:FireServer() end)
        pcall(function() CancelInput:InvokeServer() end)
        Fluent:Notify({Title = "System", Content = "Character Reset", Duration = 2})
    end
})

Window:SelectTab(1)
