-- [1] Notifikasi Awal (Custom Safe Load)
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    TeleportService = game:GetService("TeleportService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace"),
    SoundService = game:GetService("SoundService"),
    Stats = game:GetService("Stats"),
    TextChatService = game:GetService("TextChatService")
}

local Player = Services.Players.LocalPlayer
local Net = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net

local function GetChar() return Player.Character or Player.CharacterAdded:Wait() end
local function GetRoot() local c = Player.Character; return c and c:FindFirstChild("HumanoidRootPart") end
local function GetHum() local c = Player.Character; return c and c:FindFirstChild("Humanoid") end

-- // KONFIGURASI VISUAL (COMPACT & MODERN)
local UI_THEME = {
    Width = 380,
    Height = 250, 
    Color = Color3.fromRGB(12, 12, 14),        
    SidebarColor = Color3.fromRGB(8, 8, 8), 
    SidebarTransparency = 0.5, 
    Transparency = 0.15, 
    Accent = Color3.fromRGB(255, 255, 255), 
    TextMain = Color3.fromRGB(240, 240, 240), 
    TextDim = Color3.fromRGB(160, 160, 170),
    FontUI = Enum.Font.GothamBlack,
    FontBtn = Enum.Font.GothamBold,
    CornerRadius = UDim.new(0, 8),
    ElemHeight = 24 
}

if Services.CoreGui:FindFirstChild("SeraphinHelper") then Services.CoreGui.SeraphinHelper:Destroy() end

local ScreenGui = Instance.new("ScreenGui", Services.CoreGui)
ScreenGui.Name = "SeraphinHelper"
ScreenGui.ResetOnSpawn = false

-- ====================================================
-- [SYSTEM] CUSTOM NOTIFICATION
-- ====================================================
local NotifyContainer = Instance.new("Frame", ScreenGui)
NotifyContainer.Size = UDim2.new(0, 220, 0.5, 0) 
NotifyContainer.AnchorPoint = Vector2.new(1, 1)
NotifyContainer.Position = UDim2.new(1, -20, 1, -20)
NotifyContainer.BackgroundTransparency = 1

local NotifyLayout = Instance.new("UIListLayout", NotifyContainer)
NotifyLayout.FillDirection = Enum.FillDirection.Vertical
NotifyLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifyLayout.Padding = UDim.new(0, 4)

local function Notify(title, text, colorOverride, duration)
    local color = colorOverride or Color3.fromRGB(200, 200, 200) 
    local Frame = Instance.new("Frame", NotifyContainer)
    Frame.Size = UDim2.new(1, 0, 0, 0) 
    Frame.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
    Frame.BackgroundTransparency = 0.1
    Frame.BorderSizePixel = 0 
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local Bar = Instance.new("Frame", Frame)
    Bar.Size = UDim2.new(0, 3, 1, -10); Bar.Position = UDim2.new(0, 0, 0, 5)
    Bar.BackgroundColor3 = color; Bar.BorderSizePixel = 0
    Instance.new("UICorner", Bar).CornerRadius = UDim.new(0, 4)

    local LblTitle = Instance.new("TextLabel", Frame)
    LblTitle.Size = UDim2.new(1, -15, 0, 14); LblTitle.Position = UDim2.new(0, 10, 0, 4)
    LblTitle.BackgroundTransparency = 1; LblTitle.Text = string.upper(title)
    LblTitle.TextColor3 = color; LblTitle.Font = UI_THEME.FontUI; LblTitle.TextSize = 11; LblTitle.TextXAlignment = Enum.TextXAlignment.Left 
    
    local LblMsg = Instance.new("TextLabel", Frame)
    LblMsg.Size = UDim2.new(1, -15, 0, 14); LblMsg.Position = UDim2.new(0, 10, 0, 18) 
    LblMsg.BackgroundTransparency = 1; LblMsg.Text = text
    LblMsg.TextColor3 = UI_THEME.TextMain; LblMsg.Font = Enum.Font.GothamMedium; LblMsg.TextSize = 9; LblMsg.TextXAlignment = Enum.TextXAlignment.Left

    Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 36)}):Play()
    task.delay(duration or 3, function()
        if Frame then
            local TweenOut = Services.TweenService:Create(Frame, TweenInfo.new(0.3), {Size = UDim2.new(1, 20, 0, 0), BackgroundTransparency = 1})
            TweenOut:Play(); TweenOut.Completed:Wait(); Frame:Destroy()
        end
    end)
end
Notify("SERAPHIN", "Script Loaded (Compact Mode)", nil, 4)

local function EnableDrag(frame, dragInputObj)
    local dragToggle, dragStart, startPos
    dragInputObj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true; dragStart = input.Position; startPos = frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
        end
    end)
    dragInputObj.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            local dragInput = input
            Services.UserInputService.InputChanged:Connect(function(inputCheck)
                if inputCheck == dragInput and dragToggle then
                    local delta = inputCheck.Position - dragStart
                    frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
                end
            end)
        end
    end)
end

-- ====================================================
-- [CORE UI SETUP]
-- ====================================================
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height)
Main.Position = UDim2.new(0, 50, 0.5, -UI_THEME.Height/2) 
Main.BackgroundColor3 = UI_THEME.Color; Main.BackgroundTransparency = UI_THEME.Transparency
Main.ClipsDescendants = true; Main.Active = true; Main.Visible = false 
local MainCorner = Instance.new("UICorner", Main); MainCorner.CornerRadius = UI_THEME.CornerRadius 

local LogoBtn = Instance.new("TextButton", Main)
LogoBtn.Size = UDim2.new(0, 32, 0, 32); LogoBtn.Position = UDim2.new(0.5, -16, 0.5, -16)
LogoBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20); LogoBtn.Text = "H"
LogoBtn.TextColor3 = Color3.new(1,1,1); LogoBtn.Font = UI_THEME.FontUI; LogoBtn.TextSize = 16
LogoBtn.Visible = false; Instance.new("UICorner", LogoBtn).CornerRadius = UDim.new(0, 8) 

local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 28); Header.BackgroundColor3 = UI_THEME.SidebarColor; Header.BackgroundTransparency = UI_THEME.SidebarTransparency; Header.BorderSizePixel = 0 

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -40, 1, 0); Title.Position = UDim2.new(0, 10, 0, 0) 
Title.Text = "SERA <font color=\"rgb(255, 255, 255)\">HELPER</font>" 
Title.RichText = true; Title.TextColor3 = UI_THEME.TextMain; Title.Font = UI_THEME.FontUI; Title.TextSize = 11; Title.BackgroundTransparency = 1; Title.TextXAlignment = Enum.TextXAlignment.Left

local HideBtn = Instance.new("TextButton", Header)
HideBtn.Size = UDim2.new(0, 20, 0, 20); HideBtn.Position = UDim2.new(1, -26, 0.5, -10)
HideBtn.Text = "_"; HideBtn.BackgroundColor3 = Color3.new(1,1,1); HideBtn.BackgroundTransparency = 0.95
HideBtn.TextColor3 = UI_THEME.TextDim; HideBtn.Font = UI_THEME.FontUI; HideBtn.TextSize = 12
Instance.new("UICorner", HideBtn).CornerRadius = UDim.new(0, 4)

local ContentContainer = Instance.new("Frame", Main)
ContentContainer.Size = UDim2.new(1, 0, 1, -28); ContentContainer.Position = UDim2.new(0, 0, 0, 28); ContentContainer.BackgroundTransparency = 1

local Sidebar = Instance.new("Frame", ContentContainer)
Sidebar.Size = UDim2.new(0, 85, 1, 0); Sidebar.BackgroundColor3 = UI_THEME.SidebarColor; Sidebar.BackgroundTransparency = UI_THEME.SidebarTransparency; Sidebar.BorderSizePixel = 0 
local SidebarLayout = Instance.new("UIListLayout", Sidebar)
SidebarLayout.Padding = UDim.new(0, 4); SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
Instance.new("UIPadding", Sidebar).PaddingTop = UDim.new(0, 6)

local PageArea = Instance.new("Frame", ContentContainer)
PageArea.Size = UDim2.new(1, -95, 1, -8); PageArea.Position = UDim2.new(0, 90, 0, 4); PageArea.BackgroundTransparency = 1; PageArea.ClipsDescendants = true

EnableDrag(Main, Main); EnableDrag(Main, LogoBtn)

-- ====================================================
-- [COMPACT UI BUILDER HELPERS]
-- ====================================================
local function CreatePage(name, visible, isGrid)
    local pg = Instance.new("ScrollingFrame", PageArea)
    pg.Size = UDim2.new(1, 0, 1, 0); pg.BackgroundTransparency = 1
    pg.ScrollBarThickness = 2; pg.CanvasSize = UDim2.new(0, 0, 0, 0); pg.AutomaticCanvasSize = Enum.AutomaticSize.Y
    pg.Visible = visible; pg.BorderSizePixel = 0
    if isGrid then
        local gl = Instance.new("UIGridLayout", pg)
        gl.CellSize = UDim2.new(0.48, 0, 0, UI_THEME.ElemHeight); gl.CellPadding = UDim2.new(0, 4, 0, 4); gl.SortOrder = Enum.SortOrder.LayoutOrder
    else
        local ll = Instance.new("UIListLayout", pg); ll.Padding = UDim.new(0, 3); ll.SortOrder = Enum.SortOrder.LayoutOrder
    end
    return pg
end

local function MakeBtn(parent, text, isGrid)
    local b = Instance.new("TextButton", parent)
    b.Text = text; b.BackgroundColor3 = Color3.fromRGB(30, 30, 40); b.BackgroundTransparency = 0.3
    b.TextColor3 = UI_THEME.TextMain; b.Font = UI_THEME.FontBtn; b.TextSize = 9; b.AutoButtonColor = true
    if not isGrid then b.Size = UDim2.new(0.97, 0, 0, UI_THEME.ElemHeight) end
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4) 
    return b
end

local function MakeSwitch(parent, text, isGrid, defaultState, callback)
    local Frame = Instance.new("Frame", parent)
    Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40); Frame.BackgroundTransparency = 0.3
    if not isGrid then Frame.Size = UDim2.new(0.97, 0, 0, UI_THEME.ElemHeight) end
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 4)

    local Label = Instance.new("TextLabel", Frame)
    Label.Size = UDim2.new(0.65, 0, 1, 0); Label.Position = UDim2.new(0, 8, 0, 0)
    Label.BackgroundTransparency = 1; Label.Text = text; Label.TextColor3 = UI_THEME.TextMain; Label.Font = UI_THEME.FontBtn; Label.TextSize = 9; Label.TextXAlignment = Enum.TextXAlignment.Left

    local ToggleBtn = Instance.new("TextButton", Frame)
    ToggleBtn.Size = UDim2.new(0, 24, 0, 12); ToggleBtn.Position = UDim2.new(1, -30, 0.5, -6)
    ToggleBtn.BackgroundColor3 = defaultState and Color3.fromRGB(0, 200, 255) or Color3.fromRGB(50, 50, 60); ToggleBtn.Text = ""
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0) 
    local Circle = Instance.new("Frame", ToggleBtn)
    Circle.Size = UDim2.new(0, 10, 0, 10); Circle.Position = defaultState and UDim2.new(1, -11, 0.5, -5) or UDim2.new(0, 1, 0.5, -5)
    Circle.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", Circle).CornerRadius = UDim.new(1, 0)

    local IsOn = defaultState; local Debounce = false
    ToggleBtn.MouseButton1Click:Connect(function()
        if Debounce then return end; Debounce = true; IsOn = not IsOn
        local tweenInfo = TweenInfo.new(0.2)
        Services.TweenService:Create(ToggleBtn, tweenInfo, {BackgroundColor3 = IsOn and Color3.fromRGB(0, 200, 255) or Color3.fromRGB(50, 50, 60)}):Play()
        Services.TweenService:Create(Circle, tweenInfo, {Position = IsOn and UDim2.new(1, -11, 0.5, -5) or UDim2.new(0, 1, 0.5, -5)}):Play()
        if callback then callback(IsOn) end
        task.wait(0.2); Debounce = false
    end)
    return Frame
end

local function MakeDropdown(parent, defaultText, options, onSelect)
    local Container = Instance.new("Frame", parent)
    Container.Size = UDim2.new(0.97, 0, 0, UI_THEME.ElemHeight); Container.BackgroundTransparency = 1; Container.ClipsDescendants = true
    
    local Btn = Instance.new("TextButton", Container)
    Btn.Size = UDim2.new(1, 0, 0, UI_THEME.ElemHeight); Btn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    Btn.BackgroundTransparency = 0.3; Btn.Text = defaultText; Btn.TextColor3 = UI_THEME.TextMain; Btn.Font = UI_THEME.FontBtn; Btn.TextSize = 9
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 4)
    
    local ListFrame = Instance.new("ScrollingFrame", Container)
    ListFrame.Size = UDim2.new(1, 0, 0, 90); ListFrame.Position = UDim2.new(0, 0, 0, UI_THEME.ElemHeight + 2)
    ListFrame.BackgroundTransparency = 0.2; ListFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25); ListFrame.ScrollBarThickness = 2
    Instance.new("UICorner", ListFrame).CornerRadius = UDim.new(0, 4)
    local Layout = Instance.new("UIListLayout", ListFrame); Layout.Padding = UDim.new(0, 2); Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    local IsOpen = false
    Btn.MouseButton1Click:Connect(function()
        IsOpen = not IsOpen
        Services.TweenService:Create(Container, TweenInfo.new(0.25), {Size = UDim2.new(0.97, 0, 0, IsOpen and (UI_THEME.ElemHeight + 94) or UI_THEME.ElemHeight)}):Play()
    end)
    
    local count = 0
    for key, val in pairs(options) do
        count = count + 1
        local item = Instance.new("TextButton", ListFrame)
        item.Size = UDim2.new(0.95, 0, 0, 20); item.Text = type(key) == "string" and key or val
        item.BackgroundColor3 = Color3.fromRGB(40, 40, 50); item.BackgroundTransparency = 0.5
        item.TextColor3 = Color3.fromRGB(200, 200, 200); item.Font = UI_THEME.FontUI; item.TextSize = 8
        Instance.new("UICorner", item).CornerRadius = UDim.new(0, 4)
        
        item.MouseButton1Click:Connect(function()
            Btn.Text = "Selected: " .. item.Text; IsOpen = false
            Services.TweenService:Create(Container, TweenInfo.new(0.2), {Size = UDim2.new(0.97, 0, 0, UI_THEME.ElemHeight)}):Play()
            if onSelect then onSelect(type(key) == "string" and key or val, val) end
        end)
    end
    ListFrame.CanvasSize = UDim2.new(0, 0, 0, count * 22)
end

local function MakeActionRow(parent, placeholder, btnConfig)
    local Frame = Instance.new("Frame", parent)
    Frame.Size = UDim2.new(0.97, 0, 0, UI_THEME.ElemHeight); Frame.BackgroundTransparency = 1
    
    local Input = Instance.new("TextBox", Frame)
    Input.Size = UDim2.new(0.25, 0, 1, 0); Input.BackgroundColor3 = Color3.fromRGB(30, 30, 40); Input.BackgroundTransparency = 0.3
    Input.Text = "1"; Input.PlaceholderText = placeholder; Input.TextColor3 = UI_THEME.Accent; Input.Font = UI_THEME.FontUI; Input.TextSize = 9
    Instance.new("UICorner", Input).CornerRadius = UDim.new(0, 4)
    
    local xOffset = 0.27
    local btnWidth = (0.73 - (#btnConfig * 0.02)) / #btnConfig
    for _, cfg in ipairs(btnConfig) do
        local Btn = Instance.new("TextButton", Frame)
        Btn.Size = UDim2.new(btnWidth, 0, 1, 0); Btn.Position = UDim2.new(xOffset, 0, 0, 0)
        Btn.Text = cfg.text; Btn.BackgroundColor3 = cfg.color; Btn.BackgroundTransparency = 0.2
        Btn.TextColor3 = Color3.new(1,1,1); Btn.Font = UI_THEME.FontBtn; Btn.TextSize = 8
        Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 4)
        Btn.MouseButton1Click:Connect(function() if cfg.callback then cfg.callback(Input.Text, Btn) end end)
        xOffset = xOffset + btnWidth + 0.02
    end
end

local function MakeToggleInputRow(parent, text, placeholder, defaultVal)
    local Frame = Instance.new("Frame", parent)
    Frame.Size = UDim2.new(0.97, 0, 0, UI_THEME.ElemHeight); Frame.BackgroundTransparency = 1
    
    local ToggleBtn = Instance.new("TextButton", Frame)
    ToggleBtn.Size = UDim2.new(0.65, -4, 1, 0); ToggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40); ToggleBtn.BackgroundTransparency = 0.3
    ToggleBtn.Text = text .. ": OFF"; ToggleBtn.TextColor3 = UI_THEME.TextMain; ToggleBtn.Font = UI_THEME.FontBtn; ToggleBtn.TextSize = 9
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0, 4)
    
    local Input = Instance.new("TextBox", Frame)
    Input.Size = UDim2.new(0.35, 0, 1, 0); Input.Position = UDim2.new(0.65, 0, 0, 0)
    Input.BackgroundColor3 = Color3.fromRGB(30, 30, 40); Input.BackgroundTransparency = 0.3
    Input.Text = defaultVal; Input.PlaceholderText = placeholder; Input.TextColor3 = UI_THEME.Accent; Input.Font = UI_THEME.FontUI; Input.TextSize = 9
    Instance.new("UICorner", Input).CornerRadius = UDim.new(0, 4)
    
    return ToggleBtn, Input
end

local function ToggleVisual(btn, on)
    Services.TweenService:Create(btn, TweenInfo.new(0.2), {
        TextColor3 = on and Color3.new(1,1,1) or UI_THEME.TextMain, 
        BackgroundColor3 = on and Color3.fromRGB(40, 40, 50) or Color3.fromRGB(30, 30, 40)
    }):Play()
end

-- [TAB NAVIGATION]
local PageMain   = CreatePage("PageMain", true, true)  
local PageEvent  = CreatePage("PageEvent", false, false) 
local PagePlayer = CreatePage("PagePlayer", false, false) 
local PageMisc   = CreatePage("PageMisc", false, false) 

local function CreateSideTab(name, text, isActive)
    local btn = Instance.new("TextButton", Sidebar)
    btn.Size = UDim2.new(0.9, 0, 0, 22); btn.Text = text; btn.Font = UI_THEME.FontBtn; btn.TextSize = 9
    btn.BackgroundColor3 = isActive and Color3.fromRGB(40, 40, 50) or Color3.new(1,1,1)
    btn.BackgroundTransparency = isActive and 0.3 or 1
    btn.TextColor3 = isActive and Color3.new(1,1,1) or UI_THEME.TextDim
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)
    return btn
end

local Tabs = {
    Main = {Btn = CreateSideTab("TabMain", "MAIN", true), Page = PageMain},
    Event = {Btn = CreateSideTab("TabEvent", "EVENT", false), Page = PageEvent},
    Player = {Btn = CreateSideTab("TabPlayer", "PLAYER", false), Page = PagePlayer},
    Misc = {Btn = CreateSideTab("TabMisc", "MISC", false), Page = PageMisc}
}

for name, tab in pairs(Tabs) do
    tab.Btn.MouseButton1Click:Connect(function()
        for _, t in pairs(Tabs) do
            local isActive = (t == tab)
            t.Page.Visible = isActive
            Services.TweenService:Create(t.Btn, TweenInfo.new(0.2), {
                BackgroundTransparency = isActive and 0.3 or 1,
                TextColor3 = isActive and Color3.new(1,1,1) or UI_THEME.TextDim, 
                BackgroundColor3 = isActive and Color3.fromRGB(40, 40, 50) or Color3.new(1,1,1)
            }):Play()
        end
    end)
end

local IsMinimized = false
HideBtn.MouseButton1Click:Connect(function() 
    if not IsMinimized then IsMinimized = true; Header.Visible = false; ContentContainer.Visible = false
        Main:TweenSize(UDim2.new(0, 32, 0, 32), "Out", "Back", 0.4, true)
        task.delay(0.2, function() if IsMinimized then LogoBtn.Visible = true end end)
    end
end)
LogoBtn.MouseButton1Click:Connect(function()
    if IsMinimized then IsMinimized = false; LogoBtn.Visible = false
        Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height), "Out", "Back", 0.4, true)
        task.delay(0.3, function() if not IsMinimized then Header.Visible = true; ContentContainer.Visible = true end end)
    end
end)

-- ====================================================
-- [STATES & LOGIC]
-- ====================================================
local States = {
    Freeze=false, WoW=false, Boost=false, NoRender=false, Noclip=false, Panel=true, AutoEquip=false, AutoEvent=false, 
    Speed=false, SpeedVal=50, NoDmg=false, AutoFollow=false, FollowTarget=nil, AutoCoral=false, AutoFarmRelic=false, 
    AutoCrystal=false, AutoLava=false, Crafting=false, Busy=false, HasTank=false, RelicSel="Blacktide", RelicSpot=1,
    HideRod=false, StreamerMode=false, AnimSkin="Off", SelectedCraft=nil, SelectedCharm=nil
}
local Connections, BodyV, SavedCFrame, EventStartCFrame, CoralReturnCFrame, IsInEvent, IsLootingCoral = {}, nil, nil, nil, nil, false, false

local function SafeTeleport(targetCFrame)
    local hrp = GetRoot(); if not hrp then return end
    local dist = (hrp.Position - targetCFrame.Position).Magnitude
    if dist < 15 then hrp.CFrame = targetCFrame; return end
    local tween = Services.TweenService:Create(hrp, TweenInfo.new(dist / 120, Enum.EasingStyle.Linear), {CFrame = targetCFrame})
    tween:Play(); tween.Completed:Wait()
end

local function SetWoW(bool)
    States.WoW = bool
    if States.WoW then 
        local hrp = GetRoot()
        if not BodyV then BodyV = Instance.new("BodyVelocity"); BodyV.MaxForce = Vector3.new(math.huge, math.huge, math.huge); BodyV.Velocity = Vector3.zero end
        BodyV.Parent = hrp
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end 
        Connections["WoW"] = Services.RunService.RenderStepped:Connect(function() 
            local hrpNow, humNow = GetRoot(), GetHum()
            if hrpNow and humNow and BodyV and BodyV.Parent then
                local md = humNow.MoveDirection
                BodyV.Velocity = md.Magnitude > 0 and Vector3.new(md.X * humNow.WalkSpeed, 0, md.Z * humNow.WalkSpeed) or Vector3.zero
            end 
        end) 
    else 
        if Connections["WoW"] then Connections["WoW"]:Disconnect() end 
        if BodyV then BodyV:Destroy(); BodyV = nil end 
    end 
end

-- ====================================================
-- [UI POPULATION: COMPACT MODE]
-- ====================================================

-- >> TAB MAIN
MakeSwitch(PageMain, "Auto Equip Rod", true, States.AutoEquip, function(v) States.AutoEquip = v end)
MakeSwitch(PageMain, "Hide Rod", true, States.HideRod, function(v) States.HideRod = v; getgenv().RemoveRodEnabled = v end)
MakeSwitch(PageMain, "Walk In Water", true, States.WoW, function(v) SetWoW(v) end)
MakeSwitch(PageMain, "No Clip", true, States.Noclip, function(v)
    States.Noclip = v
    if v then Connections["Noclip"] = Services.RunService.Stepped:Connect(function() local c = GetChar(); if c then for _,p in pairs(c:GetDescendants()) do if p:IsA("BasePart") then p.CanCollide = false end end end end) else if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end end 
end)
MakeSwitch(PageMain, "CPU Booster", true, States.Boost, function(v) States.Boost = v; if setfpscap then setfpscap(999) end end)
MakeSwitch(PageMain, "3D No Render", true, States.NoRender, function(v) States.NoRender = v; Services.RunService:Set3dRenderingEnabled(not v) end)

-- >> TAB EVENT
MakeSwitch(PageEvent, "Auto Hunt Event", false, States.AutoEvent, function(v) States.AutoEvent = v; if not v and EventStartCFrame then SafeTeleport(EventStartCFrame); EventStartCFrame=nil; SetWoW(false) end end)
MakeSwitch(PageEvent, "Auto Cave Crystal", false, States.AutoCrystal, function(v) States.AutoCrystal = v; SetWoW(v) end)
MakeSwitch(PageEvent, "Auto Lava Crystal", false, States.AutoLava, function(v) States.AutoLava = v; SetWoW(v) end)
MakeSwitch(PageEvent, "Auto Take Coral", false, States.AutoCoral, function(v) States.AutoCoral = v; if not v and CoralReturnCFrame then SafeTeleport(CoralReturnCFrame); SetWoW(false) end end)
MakeSwitch(PageEvent, "Auto Take Relics", false, States.AutoFarmRelic, function(v) States.AutoFarmRelic = v; if not v then SetWoW(false) end end)

MakeDropdown(PageEvent, "Select Crafting Charm >", {"Oculus Charm", "Anchor Charm", "Hook Charm", "Winged Charm"}, function(name, val) States.SelectedCraft = val end)
MakeActionRow(PageEvent, "Qty", {
    {text = "START CRAFT", color = Color3.fromRGB(0, 150, 0), callback = function(qty)
        if not States.SelectedCraft then Notify("CRAFT", "Select charm!", Color3.fromRGB(255,0,0)) return end
        States.Crafting = true
        task.spawn(function()
            for i = 1, (tonumber(qty) or 1) do
                if not States.Crafting then break end
                pcall(function() Net["RF/StartCrafting"]:InvokeServer(States.SelectedCraft) end)
                task.wait(0.2)
                pcall(function() Net["RF/ConfirmCrafting"]:InvokeServer() end)
                task.wait(0.4)
            end
            States.Crafting = false; Notify("CRAFT", "Done!", Color3.fromRGB(0,255,100))
        end)
    end},
    {text = "STOP", color = Color3.fromRGB(170, 0, 0), callback = function() States.Crafting = false; pcall(function() Net["RF/CancelCrafting"]:InvokeServer() end) end}
})

-- >> TAB PLAYER
local BtnSpd, BoxSpd = MakeToggleInputRow(PagePlayer, "Speed", "Val", "80")
BtnSpd.MouseButton1Click:Connect(function()
    States.Speed = not States.Speed; States.SpeedVal = tonumber(BoxSpd.Text) or 50
    BtnSpd.Text = "Speed: " .. (States.Speed and "ON" or "OFF"); ToggleVisual(BtnSpd, States.Speed)
end)

local BtnFol, BoxFol = MakeToggleInputRow(PagePlayer, "Follow", "Name", "")
BtnFol.MouseButton1Click:Connect(function()
    States.AutoFollow = not States.AutoFollow
    if States.AutoFollow then
        for _, p in pairs(Services.Players:GetPlayers()) do
            if p ~= Player and string.sub(string.lower(p.Name), 1, string.len(BoxFol.Text)) == string.lower(BoxFol.Text) then
                States.FollowTarget = p; BoxFol.Text = p.Name; break
            end
        end
        BtnFol.Text = States.FollowTarget and "Following" or "Not Found"
    else BtnFol.Text = "Follow: OFF"; States.FollowTarget = nil end
    ToggleVisual(BtnFol, States.AutoFollow and States.FollowTarget)
end)

MakeSwitch(PagePlayer, "No Damage", false, States.NoDmg, function(v) States.NoDmg = v end)
MakeDropdown(PagePlayer, "Animation: OFF", {
    ["OFF (Disable)"] = "Off", ["Corruption Edge"] = "Corruption Edge - FishCaught", 
    ["Princess Parasol"] = "Princess Parasol - FishCaught", ["Soul Scythe"] = "Soul Scythe - FishCaught", 
    ["Eclipse Katana"] = "Eclipse Katana - FishCaught", ["Ban Hammer"] = "1x1x1x1 Ban Hammer - FishCaught", ["Trident"] = "Holy Trident - FishCaught"
}, function(name, val) States.AnimSkin = val end)

-- >> TAB MISC
MakeBtn(PageMisc, "Save Position", false).MouseButton1Click:Connect(function() local h = GetRoot(); if h then SavedCFrame = h.CFrame; Notify("POS", "Saved!") end end)
MakeBtn(PageMisc, "Load Position", false).MouseButton1Click:Connect(function() if SavedCFrame then SafeTeleport(SavedCFrame); Notify("POS", "Loaded!") end end)
MakeSwitch(PageMisc, "Panel Fishing", false, States.Panel, function(v) States.Panel = v end)

MakeDropdown(PageMisc, "Select Charm to Buy >", {["Bone Charm"]=1, ["Algae Charm"]=2, ["Magma Charm"]=3, ["Clover Charm"]=4}, function(name, val) States.SelectedCharm = val end)
MakeActionRow(PageMisc, "Qty", {
    {text = "PURCHASE CHARM", color = Color3.fromRGB(0, 150, 100), callback = function(qty)
        if not States.SelectedCharm then return end
        task.spawn(function()
            for i = 1, (tonumber(qty) or 1) do pcall(function() Net["RF/PurchaseCharm"]:InvokeServer(States.SelectedCharm) end); task.wait(0.1) end
            Notify("SHOP", "Purchase Complete!", Color3.fromRGB(0, 255, 100))
        end)
    end}
})

-- ====================================================
-- [BACKGROUND SMART LOOPS]
-- ====================================================

-- Main Loops 
task.spawn(function()
    while task.wait(0.1) do
        if States.Speed then pcall(function() local h = GetHum(); if h then if h.Sit then h.SeatPart.AssemblyLinearVelocity = h.SeatPart.CFrame.LookVector * States.SpeedVal else h.WalkSpeed = States.SpeedVal end end end) end
        if States.AutoFollow and States.FollowTarget then pcall(function() GetRoot().CFrame = States.FollowTarget.Character.HumanoidRootPart.CFrame end) end
        if States.NoDmg then pcall(function() local h = GetHum(); if h and h.Health < h.MaxHealth then h.Health = h.MaxHealth end end) end
    end
end)
task.spawn(function() while task.wait(2) do if States.AutoEquip then pcall(function() Net["RE/EquipToolFromHotbar"]:FireServer(1) end) end end end)

-- Crystal & Lava Loop (UPDATED: Path Equip Explicit)
task.spawn(function()
    local ReturnCFrame = nil
    local function isActive(c) for _, v in ipairs(c:GetDescendants()) do if v:IsA("PointLight") or v:IsA("Highlight") or v:IsA("ProximityPrompt") then return true end end return false end
    while task.wait(1) do
        local targets = {}
        if States.AutoCrystal then pcall(function() for _, c in ipairs(Services.Workspace.Islands["Crystal Depths"].Crystals:GetChildren()) do if isActive(c) then table.insert(targets, c) end end end) end
        if States.AutoLava then pcall(function() for _, c in ipairs(Services.Workspace.Islands["Lava Basin"].Crystals:GetChildren()) do if isActive(c) then table.insert(targets, c) end end end) end
        
        if #targets > 0 then
            local hrp = GetRoot()
            if hrp then
                if not ReturnCFrame then ReturnCFrame = hrp.CFrame end
                
                -- FORCE EQUIP PICKAXE (Menggunakan path eksplisit yang diminta)
                pcall(function()
                    local args = { 2 }
                    game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/EquipToolFromHotbar"):FireServer(unpack(args))
                end)
                task.wait(0.5)
                
                for _, c in ipairs(targets) do
                    if not (States.AutoCrystal or States.AutoLava) then break end
                    local p = c:IsA("Model") and c.PrimaryPart or c:IsA("BasePart") and c or c:FindFirstChildWhichIsA("BasePart", true)
                    if p then
                        SafeTeleport(p.CFrame); task.wait(0.3)
                        for _, v in ipairs(c:GetDescendants()) do if v:IsA("ProximityPrompt") and v.Enabled then fireproximityprompt(v, v.HoldDuration); task.wait(0.2) end end
                    end
                end
                
                if ReturnCFrame then SafeTeleport(ReturnCFrame) end
                task.wait(0.5)
                
                -- MENGEMBALIKAN KE ROD SETELAH SELESAI
                pcall(function()
                    local args = { 1 }
                    game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/EquipToolFromHotbar"):FireServer(unpack(args))
                end)
            end
        else
            if ReturnCFrame then local hrp = GetRoot(); if hrp and (hrp.Position - ReturnCFrame.Position).Magnitude > 10 then SafeTeleport(ReturnCFrame) end end
        end
    end
end)

-- Animation Hook
local FishEvent = Net:FindFirstChild("RE/FishCaught")
if FishEvent then FishEvent.OnClientEvent:Connect(function()
    if States.AnimSkin == "Off" then return end
    pcall(function()
        local anim = GetHum().Animator
        for _, t in pairs(anim:GetPlayingAnimationTracks()) do t:Stop(0.1) end
        local obj = Services.ReplicatedStorage.Modules.Animations:FindFirstChild(States.AnimSkin)
        if obj then local tr = anim:LoadAnimation(obj); tr.Priority = Enum.AnimationPriority.Action4; tr:Play(); tr.Stopped:Connect(function() tr:Destroy() end) end
    end)
end) end

task.spawn(function() if setfpscap then setfpscap(9999) end end)
task.delay(1, function() Main.Visible = true end)