local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui") -- Gunakan PlayerGui jika di Roblox Studio
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

-- --- 1. KONFIGURASI GLOBAL (Jembatan UI ke Script) ---
local Config = {
    IsActive = false,
    MinShakeDelay = 0.5,
    MaxShakeDelay = 1.2,
}

-- --- 2. PEMBUATAN UI (GUI Construction) ---

-- Hapus UI lama jika ada (untuk refresh)
if getgenv and getgenv().FishUI then getgenv().FishUI:Destroy() end
if CoreGui:FindFirstChild("FishingConfigUI") then CoreGui.FishingConfigUI:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FishingConfigUI"
-- Jika menggunakan executor, biasanya ke CoreGui. Jika Studio, ke PlayerGui.
if pcall(function() ScreenGui.Parent = CoreGui end) then
    -- Berhasil ke CoreGui
else
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
end

-- Main Frame (Background)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 250, 0, 180)
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -90) -- Tengah layar
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Title Label
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "üé£ Auto Fish Config"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = MainFrame

-- -- INPUT: Min Delay --
local MinLabel = Instance.new("TextLabel")
MinLabel.Size = UDim2.new(0, 80, 0, 25)
MinLabel.Position = UDim2.new(0, 10, 0, 40)
MinLabel.BackgroundTransparency = 1
MinLabel.Text = "Min Delay:"
MinLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
MinLabel.TextXAlignment = Enum.TextXAlignment.Left
MinLabel.Font = Enum.Font.Gotham
MinLabel.Parent = MainFrame

local MinInput = Instance.new("TextBox")
MinInput.Size = UDim2.new(0, 140, 0, 25)
MinInput.Position = UDim2.new(0, 100, 0, 40)
MinInput.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinInput.TextColor3 = Color3.fromRGB(255, 255, 255)
MinInput.Text = tostring(Config.MinShakeDelay)
MinInput.Font = Enum.Font.Gotham
MinInput.Parent = MainFrame
local MinCorner = Instance.new("UICorner"); MinCorner.CornerRadius = UDim.new(0, 4); MinCorner.Parent = MinInput

-- Update Config saat user mengetik
MinInput.FocusLost:Connect(function()
    local num = tonumber(MinInput.Text)
    if num then
        Config.MinShakeDelay = num
        print("‚úÖ Min Delay set to:", num)
    else
        MinInput.Text = tostring(Config.MinShakeDelay) -- Reset jika bukan angka
    end
end)

-- -- INPUT: Max Delay --
local MaxLabel = Instance.new("TextLabel")
MaxLabel.Size = UDim2.new(0, 80, 0, 25)
MaxLabel.Position = UDim2.new(0, 10, 0, 75)
MaxLabel.BackgroundTransparency = 1
MaxLabel.Text = "Max Delay:"
MaxLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
MaxLabel.TextXAlignment = Enum.TextXAlignment.Left
MaxLabel.Font = Enum.Font.Gotham
MaxLabel.Parent = MainFrame

local MaxInput = Instance.new("TextBox")
MaxInput.Size = UDim2.new(0, 140, 0, 25)
MaxInput.Position = UDim2.new(0, 100, 0, 75)
MaxInput.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MaxInput.TextColor3 = Color3.fromRGB(255, 255, 255)
MaxInput.Text = tostring(Config.MaxShakeDelay)
MaxInput.Font = Enum.Font.Gotham
MaxInput.Parent = MainFrame
local MaxCorner = Instance.new("UICorner"); MaxCorner.CornerRadius = UDim.new(0, 4); MaxCorner.Parent = MaxInput

MaxInput.FocusLost:Connect(function()
    local num = tonumber(MaxInput.Text)
    if num then
        Config.MaxShakeDelay = num
        print("‚úÖ Max Delay set to:", num)
    else
        MaxInput.Text = tostring(Config.MaxShakeDelay)
    end
end)

-- -- TOGGLE BUTTON --
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(1, -20, 0, 40)
ToggleBtn.Position = UDim2.new(0, 10, 0, 120)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah (Off)
ToggleBtn.Text = "STATUS: OFF"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 16
ToggleBtn.Parent = MainFrame
local BtnCorner = Instance.new("UICorner"); BtnCorner.CornerRadius = UDim.new(0, 6); BtnCorner.Parent = ToggleBtn

-- --- 3. LOGIKA DRAGGABLE (Agar UI bisa digeser) ---
local dragging, dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then update(input) end
end)

-- --- 4. INTEGRASI LOGIKA UTAMA ---

-- Fungsi Loop Utama (Placeholder Logika)
local function AutoFishLoop()
    task.spawn(function()
        while Config.IsActive do
            -- Contoh penggunaan Custom Delay
            local delayTime = Config.MinShakeDelay + (math.random() * (Config.MaxShakeDelay - Config.MinShakeDelay))
            
            -- Update Status Text (Visual Feedback)
            ToggleBtn.Text = "Fishing... (" .. string.format("%.2f", delayTime) .. "s delay)"
            
            -- [DISINI LOGIKA REMOTE FUNCTION KAMU AKAN BERJALAN]
            -- Contoh: Remotes.CatchCompleted:InvokeServer()
            
            task.wait(delayTime) -- Tunggu sesuai input user
            task.wait(0.1) -- Jeda kecil
        end
        
        -- Saat loop berhenti
        ToggleBtn.Text = "STATUS: OFF"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    end)
end

-- Event Toggle Button
ToggleBtn.MouseButton1Click:Connect(function()
    Config.IsActive = not Config.IsActive
    
    if Config.IsActive then
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 60) -- Hijau
        ToggleBtn.Text = "STATUS: RUNNING"
        print("‚ñ∂ Auto Fishing Started")
        AutoFishLoop() -- Jalankan Loop
    else
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah
        ToggleBtn.Text = "STATUS: STOPPING..."
        print("‚èπ Auto Fishing Stopped")
    end
end)

-- Simpan ke global agar bisa dihapus saat re-execute
if getgenv then getgenv().FishUI = ScreenGui end
