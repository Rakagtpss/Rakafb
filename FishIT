-- [1] Notifikasi Awal & Services (Safe Load)
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    TeleportService = game:GetService("TeleportService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace"),
    SoundService = game:GetService("SoundService"),
    Stats = game:GetService("Stats"),
    TextChatService = game:GetService("TextChatService")
}

local Player = Services.Players.LocalPlayer
local Cam = Services.Workspace.CurrentCamera
local NetPath = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net

-- Fungsi Get Character Cepat & Aman
local function GetChar() return Player.Character or Player.CharacterAdded:Wait() end
local function GetRoot() local c = Player.Character; return c and c:FindFirstChild("HumanoidRootPart") end
local function GetHum() local c = Player.Character; return c and c:FindFirstChild("Humanoid") end

-- // KONFIGURASI VISUAL (MODERN DARK TRANSPARENT)
local UI_THEME = {
    Width = 400, Height = 270,
    Color = Color3.fromRGB(12, 12, 14),
    SidebarColor = Color3.fromRGB(8, 8, 8),
    SidebarTransparency = 0.5,
    Transparency = 0.15,
    Accent = Color3.fromRGB(255, 255, 255),
    TextMain = Color3.fromRGB(240, 240, 240),
    TextDim = Color3.fromRGB(160, 160, 170),
    FontUI = Enum.Font.GothamBlack,
    FontBtn = Enum.Font.GothamBold,
    CornerRadius = UDim.new(0, 10)
}

-- Bersihkan UI Lama
if Services.CoreGui:FindFirstChild("SeraphinHelper") then Services.CoreGui.SeraphinHelper:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinHelper"
ScreenGui.Parent = Services.CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ====================================================
-- [SYSTEM] CUSTOM NOTIFICATION
-- ====================================================
local NotifyContainer = Instance.new("Frame", ScreenGui)
NotifyContainer.Name = "NotificationContainer"
NotifyContainer.Size = UDim2.new(0, 220, 0.5, 0)
NotifyContainer.AnchorPoint = Vector2.new(1, 1)
NotifyContainer.Position = UDim2.new(1, -20, 1, -20)
NotifyContainer.BackgroundTransparency = 1
NotifyContainer.ClipsDescendants = false

local NotifyLayout = Instance.new("UIListLayout", NotifyContainer)
NotifyLayout.FillDirection = Enum.FillDirection.Vertical
NotifyLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifyLayout.SortOrder = Enum.SortOrder.LayoutOrder
NotifyLayout.Padding = UDim.new(0, 5)

local function Notify(title, text, colorOverride, duration)
    local color = colorOverride or Color3.fromRGB(200, 200, 200)
    local timeTime = duration or 3
    
    local Frame = Instance.new("Frame")
    Frame.Name = "NotifyItem"
    Frame.Size = UDim2.new(1, 0, 0, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
    Frame.BackgroundTransparency = 0.1
    Frame.BorderSizePixel = 0
    Frame.Parent = NotifyContainer
    
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local Bar = Instance.new("Frame", Frame)
    Bar.Size = UDim2.new(0, 3, 1, -10)
    Bar.Position = UDim2.new(0, 0, 0, 5)
    Bar.BackgroundColor3 = color
    Bar.BorderSizePixel = 0
    Instance.new("UICorner", Bar).CornerRadius = UDim.new(0, 4)

    local LblTitle = Instance.new("TextLabel", Frame)
    LblTitle.Size = UDim2.new(1, -15, 0, 14)
    LblTitle.Position = UDim2.new(0, 10, 0, 6)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(title)
    LblTitle.TextColor3 = color
    LblTitle.Font = UI_THEME.FontUI
    LblTitle.TextSize = 12
    LblTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    local LblMsg = Instance.new("TextLabel", Frame)
    LblMsg.Size = UDim2.new(1, -15, 0, 14)
    LblMsg.Position = UDim2.new(0, 10, 0, 20)
    LblMsg.BackgroundTransparency = 1
    LblMsg.Text = text
    LblMsg.TextColor3 = UI_THEME.TextMain
    LblMsg.Font = Enum.Font.GothamMedium
    LblMsg.TextSize = 10
    LblMsg.TextXAlignment = Enum.TextXAlignment.Left

    local TweenIn = Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 40)})
    TweenIn:Play()
    
    task.delay(timeTime, function()
        if not Frame then return end
        local TweenOut = Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Size = UDim2.new(1, 20, 0, 0),
            BackgroundTransparency = 1
        })
        TweenOut:Play()
        if LblTitle then Services.TweenService:Create(LblTitle, TweenInfo.new(0.2), {TextTransparency = 1}):Play() end
        if LblMsg then Services.TweenService:Create(LblMsg, TweenInfo.new(0.2), {TextTransparency = 1}):Play() end
        TweenOut.Completed:Wait()
        Frame:Destroy()
    end)
end

Notify("SERAPHIN", "V31 Refactored Pro Edition", nil, 4)

-- DRAG FUNCTION
local function EnableDrag(frame, dragInputObj)
    local dragToggle, dragStart, startPos
    
    dragInputObj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragToggle = false end
            end)
        end
    end)
    
    dragInputObj.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            Services.UserInputService.InputChanged:Connect(function(inputCheck)
                if inputCheck == input and dragToggle then
                    local delta = inputCheck.Position - dragStart
                    frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
                end
            end)
        end
    end)
end

-- ====================================================
-- [UI SETUP - FLOATING MONITOR]
-- ====================================================
local MonitorHUD = Instance.new("Frame", ScreenGui)
MonitorHUD.Name = "LiveMonitor"
MonitorHUD.Size = UDim2.new(0, 180, 0, 24)
MonitorHUD.Position = UDim2.new(0.5, -90, 0, 10)
MonitorHUD.BackgroundColor3 = Color3.fromRGB(15, 15, 18)
MonitorHUD.BackgroundTransparency = 0.2
MonitorHUD.BorderSizePixel = 0
MonitorHUD.Active = true
Instance.new("UICorner", MonitorHUD).CornerRadius = UDim.new(0, 6)

local MonLabel = Instance.new("TextLabel", MonitorHUD)
MonLabel.Size = UDim2.new(1, 0, 1, 0)
MonLabel.BackgroundTransparency = 1
MonLabel.Text = "FPS: -- | CPU: --.-- | TIME: --:--:--"
MonLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
MonLabel.Font = UI_THEME.FontUI
MonLabel.TextSize = 10
EnableDrag(MonitorHUD, MonitorHUD)

-- ====================================================
-- [UI SETUP - FLOATING STATS]
-- ====================================================
local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Name = "FloatingStats"
FloatHUD.AnchorPoint = Vector2.new(0.5, 0)
FloatHUD.Size = UDim2.new(0, 150, 0, 100)
FloatHUD.Position = UDim2.new(0.5, 0, 0.35, 0)
FloatHUD.BackgroundColor3 = Color3.fromRGB(15, 15, 18)
FloatHUD.BackgroundTransparency = 0.3
FloatHUD.BorderSizePixel = 0
FloatHUD.Visible = false
FloatHUD.Active = true
Instance.new("UICorner", FloatHUD).CornerRadius = UDim.new(0, 8)

local ListLayout = Instance.new("UIListLayout", FloatHUD)
ListLayout.FillDirection = Enum.FillDirection.Vertical
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder

local Padding = Instance.new("UIPadding", FloatHUD)
Padding.PaddingTop = UDim.new(0, 8); Padding.PaddingBottom = UDim.new(0, 8)
Padding.PaddingLeft = UDim.new(0, 8); Padding.PaddingRight = UDim.new(0, 8)

local TitleLabel = Instance.new("TextLabel", FloatHUD)
TitleLabel.LayoutOrder = 1
TitleLabel.Size = UDim2.new(1, 0, 0, 18)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "PANEL SERAPHIN"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = UI_THEME.FontUI
TitleLabel.TextSize = 12

local Div = Instance.new("Frame", FloatHUD)
Div.LayoutOrder = 2
Div.Size = UDim2.new(1, 0, 0, 1)
Div.BackgroundColor3 = UI_THEME.TextDim
Div.BackgroundTransparency = 0.8
Div.BorderSizePixel = 0

local function CreateStatBlock(titleText, defaultVal, order)
    local Block = Instance.new("Frame", FloatHUD)
    Block.LayoutOrder = order
    Block.Size = UDim2.new(1, 0, 0, 28)
    Block.BackgroundTransparency = 1
    
    local LblTitle = Instance.new("TextLabel", Block)
    LblTitle.Size = UDim2.new(1, 0, 0, 12)
    LblTitle.Position = UDim2.new(0, 0, 0, 2)
    LblTitle.BackgroundTransparency = 1
    LblTitle.Text = string.upper(titleText)
    LblTitle.TextColor3 = UI_THEME.TextDim
    LblTitle.Font = Enum.Font.GothamBold
    LblTitle.TextSize = 9
    
    local LblValue = Instance.new("TextLabel", Block)
    LblValue.Size = UDim2.new(1, 0, 0, 14)
    LblValue.Position = UDim2.new(0, 0, 0, 12)
    LblValue.BackgroundTransparency = 1
    LblValue.Text = defaultVal
    LblValue.TextColor3 = UI_THEME.TextMain
    LblValue.Font = UI_THEME.FontUI
    LblValue.TextSize = 12
    return LblValue
end

local LblFishVal = CreateStatBlock("FISH CAUGHT", "Loading...", 3)
local LblInvVal  = CreateStatBlock("INVENTORY", "0 / 0", 4)
EnableDrag(FloatHUD, FloatHUD)

-- ====================================================
-- [UI SETUP - MAIN PANEL]
-- ====================================================
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height)
Main.Position = UDim2.new(0, 50, 0.5, -UI_THEME.Height/2)
Main.BackgroundColor3 = UI_THEME.Color
Main.BackgroundTransparency = UI_THEME.Transparency
Main.Active = true
Main.ClipsDescendants = true
Main.Visible = false
local MainCorner = Instance.new("UICorner", Main)
MainCorner.CornerRadius = UI_THEME.CornerRadius

-- Logo (Minimized)
local LogoContainer = Instance.new("Frame", Main)
LogoContainer.Size = UDim2.new(0, 32, 0, 32)
LogoContainer.Position = UDim2.new(0.5, -16, 0.5, -16)
LogoContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
LogoContainer.Visible = false
LogoContainer.ZIndex = 11
Instance.new("UICorner", LogoContainer).CornerRadius = UDim.new(0, 8)
local LogoR = Instance.new("TextButton", LogoContainer)
LogoR.Size = UDim2.new(1, 0, 1, 0)
LogoR.BackgroundTransparency = 1
LogoR.Text = "H"
LogoR.TextColor3 = Color3.new(1,1,1)
LogoR.Font = UI_THEME.FontUI
LogoR.TextSize = 18
LogoR.ZIndex = 12

-- Header Panel
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 32)
Header.BackgroundColor3 = UI_THEME.SidebarColor
Header.BackgroundTransparency = UI_THEME.SidebarTransparency
local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -40, 1, 0)
Title.Position = UDim2.new(0, 12, 0, 0)
Title.Text = "SERA <font color=\"rgb(255, 255, 255)\">HELPER</font>"
Title.RichText = true
Title.TextColor3 = UI_THEME.TextMain
Title.Font = UI_THEME.FontUI
Title.TextSize = 12
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left

local HideBtn = Instance.new("TextButton", Header)
HideBtn.Size = UDim2.new(0, 22, 0, 22)
HideBtn.Position = UDim2.new(1, -28, 0.5, -11)
HideBtn.Text = "_"
HideBtn.BackgroundColor3 = Color3.new(1,1,1)
HideBtn.BackgroundTransparency = 0.95
HideBtn.TextColor3 = UI_THEME.TextDim
HideBtn.Font = UI_THEME.FontUI
HideBtn.TextSize = 14
Instance.new("UICorner", HideBtn).CornerRadius = UDim.new(0, 6)

EnableDrag(Main, Main)
EnableDrag(Main, LogoR)

-- ====================================================
-- [UI SETUP - SIDE NAVIGATION]
-- ====================================================
local ContentContainer = Instance.new("Frame", Main)
ContentContainer.Size = UDim2.new(1, 0, 1, -32)
ContentContainer.Position = UDim2.new(0, 0, 0, 32)
ContentContainer.BackgroundTransparency = 1

local Sidebar = Instance.new("Frame", ContentContainer)
Sidebar.Size = UDim2.new(0, 95, 1, 0)
Sidebar.BackgroundColor3 = UI_THEME.SidebarColor
Sidebar.BackgroundTransparency = UI_THEME.SidebarTransparency

local SidebarLayout = Instance.new("UIListLayout", Sidebar)
SidebarLayout.FillDirection = Enum.FillDirection.Vertical
SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
SidebarLayout.Padding = UDim.new(0, 5)
SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
local SidebarPad = Instance.new("UIPadding", Sidebar)
SidebarPad.PaddingTop = UDim.new(0, 8)

local function CreateSideTab(name, text, isActive)
    local btn = Instance.new("TextButton", Sidebar)
    btn.Size = UDim2.new(0.85, 0, 0, 26)
    
    if isActive then
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        btn.BackgroundTransparency = 0.3
        btn.TextColor3 = Color3.new(1,1,1)
    else
        btn.BackgroundColor3 = Color3.new(1,1,1)
        btn.BackgroundTransparency = 1
        btn.TextColor3 = UI_THEME.TextDim
    end
    
    btn.Text = text
    btn.Font = UI_THEME.FontBtn
    btn.TextSize = 10
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    return btn
end

local TabMainBtn   = CreateSideTab("TabMain", "MAIN", true)
local TabCharmBtn  = CreateSideTab("TabCharm", "SHOP", false)
local TabEventBtn  = CreateSideTab("TabEvent", "EVENT", false)
local TabPlayerBtn = CreateSideTab("TabPlayer", "PLAYER", false)
local TabMiscBtn   = CreateSideTab("TabMisc", "MISC", false)

-- ====================================================
-- [UI SETUP - PAGES]
-- ====================================================
local PageArea = Instance.new("Frame", ContentContainer)
PageArea.Size = UDim2.new(1, -105, 1, -10)
PageArea.Position = UDim2.new(0, 100, 0, 5)
PageArea.BackgroundTransparency = 1
PageArea.ClipsDescendants = true

local function CreatePage(name, visible, isList)
    local pg = Instance.new("ScrollingFrame", PageArea)
    pg.Size = UDim2.new(1, 0, 1, 0)
    pg.BackgroundTransparency = 1
    pg.ScrollBarThickness = 2
    pg.AutomaticCanvasSize = Enum.AutomaticSize.Y
    pg.Visible = visible
    pg.BorderSizePixel = 0
    
    if isList then
        local ll = Instance.new("UIListLayout", pg)
        ll.Padding = UDim.new(0, 5)
        ll.SortOrder = Enum.SortOrder.LayoutOrder
    else
        local gl = Instance.new("UIGridLayout", pg)
        gl.CellSize = UDim2.new(0.48, 0, 0, 26)
        gl.CellPadding = UDim2.new(0, 5, 0, 5)
        gl.SortOrder = Enum.SortOrder.LayoutOrder
    end
    return pg
end

local PageMain   = CreatePage("PageMain", true, false)
local PageCharm  = CreatePage("PageCharm", false, true)
local PageEvent  = CreatePage("PageEvent", false, true)
local PagePlayer = CreatePage("PagePlayer", false, true)
local PageMisc   = CreatePage("PageMisc", false, true)

local function SwitchTab(tabName)
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
    local tabs = {Main = TabMainBtn, Charm = TabCharmBtn, Event = TabEventBtn, Player = TabPlayerBtn, Misc = TabMiscBtn}
    local pages = {Main = PageMain, Charm = PageCharm, Event = PageEvent, Player = PagePlayer, Misc = PageMisc}
    
    for name, btn in pairs(tabs) do
        local isActive = (name == tabName)
        pages[name].Visible = isActive
        
        if isActive then
              Services.TweenService:Create(btn, tweenInfo, {BackgroundTransparency=0.3, TextColor3=Color3.new(1,1,1), BackgroundColor3=Color3.fromRGB(40,40,50)}):Play()
        else
            Services.TweenService:Create(btn, tweenInfo, {BackgroundTransparency=1, TextColor3=UI_THEME.TextDim, BackgroundColor3=Color3.new(1,1,1)}):Play()
        end
    end
end

TabMainBtn.MouseButton1Click:Connect(function() SwitchTab("Main") end)
TabCharmBtn.MouseButton1Click:Connect(function() SwitchTab("Charm") end)
TabEventBtn.MouseButton1Click:Connect(function() SwitchTab("Event") end)
TabPlayerBtn.MouseButton1Click:Connect(function() SwitchTab("Player") end)
TabMiscBtn.MouseButton1Click:Connect(function() SwitchTab("Misc") end)

-- [UI LOGIC - MINIMIZE/MAXIMIZE]
local IsMinimized = false
HideBtn.MouseButton1Click:Connect(function()
    if IsMinimized then return end
    IsMinimized = true
    Header.Visible = false; ContentContainer.Visible = false
    Main:TweenSize(UDim2.new(0, 36, 0, 36), "Out", "Back", 0.4, true)
    Services.TweenService:Create(MainCorner, TweenInfo.new(0.4), {CornerRadius = UDim.new(0, 10)}):Play()
    Services.TweenService:Create(Main, TweenInfo.new(0.4), {BackgroundTransparency = 0.1}):Play()
    task.delay(0.2, function() if IsMinimized then LogoContainer.Visible = true end end)
end)

LogoR.MouseButton1Click:Connect(function()
    if not IsMinimized then return end
    IsMinimized = false
    LogoContainer.Visible = false
    Main:TweenSize(UDim2.new(0, UI_THEME.Width, 0, UI_THEME.Height), "Out", "Back", 0.4, true)
    Services.TweenService:Create(MainCorner, TweenInfo.new(0.4), {CornerRadius = UI_THEME.CornerRadius}):Play()
    Services.TweenService:Create(Main, TweenInfo.new(0.4), {BackgroundTransparency = UI_THEME.Transparency}):Play()
    task.delay(0.3, function() if not IsMinimized then Header.Visible = true; ContentContainer.Visible = true end end)
end)

-- [STYLE BUTTON BUILDERS]
local function MakeBtn(parent, text)
    local b = Instance.new("TextButton", parent)
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    b.BackgroundTransparency = 0.3
    b.TextColor3 = UI_THEME.TextMain
    b.Font = UI_THEME.FontBtn
    b.TextScaled = true
    
    if parent == PageMisc or parent == PageEvent or parent == PageCharm then
        b.Size = UDim2.new(0.95, 0, 0, 26)
    end
    
    local constraint = Instance.new("UITextSizeConstraint", b)
    constraint.MaxTextSize = 10; constraint.MinTextSize = 8
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)
    return b
end

local function MakeSwitch(parent, text, defaultState, callback)
    local Frame = Instance.new("Frame", parent)
    if parent == PagePlayer or parent == PageMisc or parent == PageEvent or parent == PageCharm then
        Frame.Size = UDim2.new(0.95, 0, 0, 26)
    end
    Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    Frame.BackgroundTransparency = 0.3
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local Label = Instance.new("TextLabel", Frame)
    Label.Size = UDim2.new(0.65, 0, 1, 0)
    Label.Position = UDim2.new(0, 8, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = text; Label.TextColor3 = UI_THEME.TextMain
    Label.Font = UI_THEME.FontBtn; Label.TextSize = 9
    Label.TextXAlignment = Enum.TextXAlignment.Left
    
    local ToggleBtn = Instance.new("TextButton", Frame)
    ToggleBtn.Size = UDim2.new(0, 28, 0, 14)
    ToggleBtn.Position = UDim2.new(1, -34, 0.5, -7)
    ToggleBtn.BackgroundColor3 = defaultState and Color3.fromRGB(0, 200, 255) or Color3.fromRGB(50, 50, 60)
    ToggleBtn.Text = ""
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
    
    local Circle = Instance.new("Frame", ToggleBtn)
    Circle.Size = UDim2.new(0, 10, 0, 10)
    Circle.Position = defaultState and UDim2.new(1, -12, 0.5, -5) or UDim2.new(0, 2, 0.5, -5)
    Circle.BackgroundColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Circle).CornerRadius = UDim.new(1, 0)
    
    local IsOn = defaultState
    local Debounce = false
    
    ToggleBtn.MouseButton1Click:Connect(function()
        if Debounce then return end
        Debounce = true; IsOn = not IsOn
        
        local tw = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        if IsOn then
            Services.TweenService:Create(ToggleBtn, tw, {BackgroundColor3 = Color3.fromRGB(0, 200, 255)}):Play()
            Services.TweenService:Create(Circle, tw, {Position = UDim2.new(1, -12, 0.5, -5)}):Play()
        else
            Services.TweenService:Create(ToggleBtn, tw, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
            Services.TweenService:Create(Circle, tw, {Position = UDim2.new(0, 2, 0.5, -5)}):Play()
        end
        
        if callback then callback(IsOn) end
        task.wait(0.2)
        Debounce = false
    end)
    return Frame
end

local function ToggleVisual(btn, on)
    local tw = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    if on then
        Services.TweenService:Create(btn, tw, {TextColor3=Color3.new(1,1,1), BackgroundTransparency=0.2, BackgroundColor3=Color3.fromRGB(40,40,50)}):Play()
    else
        Services.TweenService:Create(btn, tw, {TextColor3=UI_THEME.TextMain, BackgroundTransparency=0.3, BackgroundColor3=Color3.fromRGB(30,30,40)}):Play()
    end
end

-- ====================================================
-- [CORE LOGIC & STATES]
-- ====================================================
local States = {
    Freeze=false, WoW=false, Boost=false, NoRender=false, Noclip=false, Panel=true, 
    AutoEquip=false, AutoEvent=false, Speed=false, SpeedVal=50, NoDmg=false,
    AutoFollow=false, FollowTarget=nil, AutoCoral=false, AutoFarmRelic=false, AutoMiningV20=false,
    Busy=false, IsMining=false, HasTank=false, RelicSel="Blacktide", RelicSpot=1,
    HideRod=false, StreamerMode=false, AnimSkin="Off", AutoFishActive=false
}

local SavedCFrame = nil
local EventStartCFrame = nil
local CoralReturnCFrame = nil
local IsInEvent = false
local IsLootingCoral = false
local Connections = {}
local BodyV = nil
local EventList = {"Ghost Shark Hunt", "Worm Hunt", "Treasure Hunt", "Shark Hunt", "Megalodon Hunt"}
local SavedMinePosition = nil

-- ====================================================
-- [REFACTORED] AUTO FISHING
-- ====================================================
local function StartAutoFishRoutine()
    if States.AutoFishActive then return end
    States.AutoFishActive = true
    Notify("FISHING", "Auto Fishing Started!", Color3.fromRGB(0, 255, 255))
    
    task.spawn(function()
        local Net = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
        while States.AutoFishActive do
            if States.IsMining then task.wait(1) continue end
            
            pcall(function()
                Net["RF/UpdateAutoFishingState"]:InvokeServer(true)
                Net["RF/ChargeFishingRod"]:InvokeServer()
                task.wait(1)
                Net["RF/RequestFishingMinigameStarted"]:InvokeServer(-0.9879989624023438, 0.5, 1771061230.063116)
                task.wait(2.5) 
                Net["RF/CatchFishCompleted"]:InvokeServer()
            end)
            task.wait(0.5)
        end
    end)
end

local function ForceEquipRod(slot)
    pcall(function()
        local netRemote = Services.ReplicatedStorage:FindFirstChild("Packages")
            and Services.ReplicatedStorage.Packages:FindFirstChild("_Index")
            and Services.ReplicatedStorage.Packages._Index:FindFirstChild("sleitnick_net@0.2.0")
        
        if netRemote and netRemote:FindFirstChild("net") then
            netRemote.net:FindFirstChild("RE/EquipToolFromHotbar"):FireServer(slot or 1)
        end
    end)
end

-- ====================================================
-- [REFACTORED] HIDE ROD LOGIC (GHOST MODE - O(1) LOOKUP)
-- ====================================================
getgenv().RemoveRodEnabled = false

-- Dictionary Lookup Set untuk performa super cepat
local GHOST_VISUALS = { ParticleEmitter=true, Trail=true, Beam=true, Light=true, Fire=true, Sparkles=true }
local GHOST_TRANSPARENT = { BasePart=true, MeshPart=true, UnionOperation=true, Texture=true, Decal=true }

local function NukeVisuals(tool)
    task.wait()
    for _, obj in ipairs(tool:GetDescendants()) do
        if GHOST_VISUALS[obj.ClassName] then
            obj:Destroy()
        elseif GHOST_TRANSPARENT[obj.ClassName] then
            obj.Transparency = 1
            if obj:IsA("BasePart") then
                obj.CanCollide = false
                obj.CastShadow = false
            end
        end
    end
end

local function SetHideRod(bool)
    States.HideRod = bool
    getgenv().RemoveRodEnabled = bool
    
    if Connections["GhostRod"] then Connections["GhostRod"]:Disconnect() end
    
    if not bool then 
        Notify("MAIN", "Ghost Rod: OFF", nil)
        return 
    end

    local char = GetChar()
    if char then
        local t = char:FindFirstChild("!!!EQUIPPED_TOOL!!!") or char:FindFirstChildWhichIsA("Tool")
        if t then NukeVisuals(t) end
        
        Connections["GhostRod"] = char.ChildAdded:Connect(function(child)
            if not getgenv().RemoveRodEnabled then return end
            if not (child:IsA("Tool") or child.Name == "!!!EQUIPPED_TOOL!!!") then return end
            
            NukeVisuals(child)
            child.DescendantAdded:Connect(function(desc)
                if not getgenv().RemoveRodEnabled then return end
                task.wait()
                if desc:IsA("BasePart") then desc.Transparency = 1 end
                if desc:IsA("ParticleEmitter") then desc:Destroy() end
            end)
        end)
    end
    Notify("MAIN", "Hide Rod: ON (Re-Equip)", nil)
end

-- Logic Water Walk
local function SetWoW(bool)
    States.WoW = bool
    if Connections["WoW"] then Connections["WoW"]:Disconnect() end
    if BodyV then BodyV:Destroy(); BodyV = nil end
    
    if not bool then return end

    local hrp = GetRoot()
    if not hrp then return end
    
    BodyV = Instance.new("BodyVelocity")
    BodyV.Name = "WoW_Velocity"
    BodyV.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    BodyV.Velocity = Vector3.zero
    BodyV.Parent = hrp
    
    Connections["WoW"] = Services.RunService.RenderStepped:Connect(function()
        local hrpNow = GetRoot()
        local humNow = GetHum()
        if not (hrpNow and humNow and BodyV and BodyV.Parent) then return end
        
        local moveDir = humNow.MoveDirection
        if moveDir.Magnitude > 0 then
            BodyV.Velocity = Vector3.new(moveDir.X * humNow.WalkSpeed, 0, moveDir.Z * humNow.WalkSpeed)
        else
            BodyV.Velocity = Vector3.zero
        end
    end)
end

-- ====================================================
-- [REFACTORED V5] SUPER CPU BOOSTER (POTATO MODE)
-- ====================================================
local DISABLE_CLASSES = { 
    ParticleEmitter=true, Trail=true, Beam=true, Sparkles=true, Fire=true, 
    Smoke=true, Explosion=true, PointLight=true, SpotLight=true, SurfaceLight=true, 
    Decal=true, Texture=true, Shirt=true, Pants=true, ShirtGraphic=true 
}

local function OptimizeObject(v)
    pcall(function()
        -- Guard Clause menggunakan O(1) Dictionary Lookup
        if DISABLE_CLASSES[v.ClassName] then
            if v:IsA("Light") or v:IsA("ParticleEmitter") then v.Enabled = false end
            v:Destroy()
            return
        end
        
        if v:IsA("BasePart") then
            v.Material = Enum.Material.SmoothPlastic
            v.Reflectance = 0
            v.CastShadow = false
            v.TopSurface = Enum.SurfaceType.Smooth
            v.BottomSurface = Enum.SurfaceType.Smooth
            
            if v:IsA("MeshPart") then v.TextureID = "" end
            if v.Transparency > 0.5 and v.Transparency < 1 then v.Transparency = 1 end
            if v.Name == "Water" then v.Transparency = 1 end
        end
    end)
end

local function ToggleBoost(enable)
    States.Boost = enable
    if Connections["BoosterDynamic"] then Connections["BoosterDynamic"]:Disconnect() end
    
    if not enable then
        Notify("BOOST", "Disabled (Rejoin to Fix Textures)", Color3.fromRGB(255, 100, 100))
        return
    end

    if setfpscap then setfpscap(9999) end
    
    pcall(function()
        local l = Services.Lighting
        l.GlobalShadows = false
        l.FogEnd = 9e9; l.Brightness = 2; l.ClockTime = 12
        l.EnvironmentDiffuseScale = 0; l.EnvironmentSpecularScale = 0
        l.Ambient = Color3.fromRGB(170, 170, 170); l.OutdoorAmbient = Color3.fromRGB(170, 170, 170)
        
        for _, v in ipairs(l:GetChildren()) do
            if v:IsA("PostEffect") or v:IsA("Atmosphere") or v:IsA("Sky") or v:IsA("DepthOfField") or v:IsA("SunRays") then
                v:Destroy()
            end
        end
    end)
    
    if Services.Workspace.Terrain then
        pcall(function() 
            local t = Services.Workspace.Terrain
            t.WaterReflectance = 0; t.WaterTransparency = 0 
            t.WaterWaveSize = 0; t.WaterWaveSpeed = 0
            t.Material = Enum.Material.SmoothPlastic 
            if sethiddenproperty then sethiddenproperty(t, "Decoration", false) end
        end)
    end
    
    for _, v in ipairs(Services.Workspace:GetDescendants()) do OptimizeObject(v) end
    
    Connections["BoosterDynamic"] = Services.Workspace.DescendantAdded:Connect(function(v)
        task.wait() OptimizeObject(v)
    end)
    Notify("BOOST", "SUPER POTATO MODE: ON", Color3.fromRGB(0, 255, 100))
end

-- ====================================================
-- [REFACTORED] STREAMER MODE LOGIC 
-- ====================================================
local SPOOF_NAME = '<font face="GothamBold"><b>discord.gg/getseraphin VISUAL</b></font>'
local NAME_COLOR = "#00ffff"
local OVERHEAD_HTML = string.format('<font color="#FFFFFF">%s</font>', SPOOF_NAME)
local NameSpoof = { Active = false, CurrentConn = nil, CharConn = nil }

local function ApplyNameSpoof()
    if not NameSpoof.Active then return end
    local char = Player.Character
    if not char then return end
    
    local hrp = char:WaitForChild("HumanoidRootPart", 5)
    local overhead = hrp and hrp:WaitForChild("Overhead", 5)
    if not overhead then return end
    
    local label = overhead:FindFirstChild("Header", true)
    if not label then
        for _, v in ipairs(overhead:GetDescendants()) do
            if v:IsA("TextLabel") then label = v; break end
        end
    end
    
    if not label then return end
    label.RichText = true
    if NameSpoof.CurrentConn then NameSpoof.CurrentConn:Disconnect() end
    
    label.Text = OVERHEAD_HTML
    NameSpoof.CurrentConn = label:GetPropertyChangedSignal("Text"):Connect(function()
        if label.Text ~= OVERHEAD_HTML then label.Text = OVERHEAD_HTML end
    end)
end

local function EnableNameSpoof(bool)
    NameSpoof.Active = bool
    if NameSpoof.CharConn then NameSpoof.CharConn:Disconnect() end
    if NameSpoof.CurrentConn then NameSpoof.CurrentConn:Disconnect() end
    
    if not bool then return end
    
    if Player.Character then ApplyNameSpoof() end
    NameSpoof.CharConn = Player.CharacterAdded:Connect(function()
        task.wait(1); ApplyNameSpoof()
    end)
end

Services.TextChatService.OnIncomingMessage = function(message)
    if not States.StreamerMode then return nil end
    local properties = Instance.new("TextChatMessageProperties")
    local msg = message.Text
    
    if string.find(msg, "caught") or string.find(msg, "obtained") or string.find(msg, "found") then
        local newText = string.gsub(msg, "^%S+", function() return string.format("<font color='%s'>%s</font>", NAME_COLOR, SPOOF_NAME) end)
        if string.find(msg, "%]") or string.find(msg, ":") then
            newText = string.gsub(msg, "(%S+)%s+caught", function() return string.format("<font color='%s'>%s</font> caught", NAME_COLOR, SPOOF_NAME) end)
            newText = string.gsub(newText, "(%S+)%s+obtained", function() return string.format("<font color='%s'>%s</font> obtained", NAME_COLOR, SPOOF_NAME) end)
        end
        properties.Text = newText
    end
    
    if message.TextSource then
        properties.PrefixText = string.format("<font color='%s'>[%s]:</font> ", NAME_COLOR, SPOOF_NAME)
    end
    return properties
end

-- ====================================================
-- >> TOMBOL UI (LAYOUT & TABS) <<
-- ====================================================
-- [TAB MAIN]
MakeSwitch(PageMain, "Auto Equip Rod", States.AutoEquip, function(val)
    States.AutoEquip = val
    Notify("MAIN", "Auto Equip Rod: "..(val and "ON" or "OFF"), nil)
end)
MakeSwitch(PageMain, "Hide Rod ", States.HideRod, SetHideRod)
MakeSwitch(PageMain, "Walk In Water", States.WoW, SetWoW)
MakeSwitch(PageMain, "Freeze Character", States.Freeze, function(val)
    States.Freeze = val
    local hrp = GetRoot()
    if hrp then hrp.Anchored = val end
    Notify("MAIN", "Freeze: "..(val and "ON" or "OFF"), nil)
end)
MakeSwitch(PageMain, "No Clip", States.Noclip, function(val)
    States.Noclip = val
    Notify("MAIN", "Noclip: "..(val and "ON" or "OFF"), nil)
    if Connections["Noclip"] then Connections["Noclip"]:Disconnect() end
    if not val then return end
    
    Connections["Noclip"] = Services.RunService.Stepped:Connect(function()
        local char = GetChar()
        if not char then return end
        for _,v in ipairs(char:GetDescendants()) do
            if v:IsA("BasePart") then v.CanCollide = false end
        end
    end)
end)
MakeSwitch(PageMain, "CPU Booster ", States.Boost, ToggleBoost)
MakeSwitch(PageMain, "3D No Render", States.NoRender, function(val)
    States.NoRender = val
    Services.RunService:Set3dRenderingEnabled(not val)
    Notify("RENDER", "No Render: "..(val and "ON" or "OFF"), nil)
end)

-- [TAB CHARM & SHOP] (Slight UI setup, logic compressed for brevity)
-- Auto Craft System
local CraftContainer = Instance.new("Frame", PageCharm)
CraftContainer.Size = UDim2.new(0.95, 0, 0, 85); CraftContainer.BackgroundTransparency = 1; CraftContainer.ClipsDescendants = true
local CraftDropdown = Instance.new("Frame", CraftContainer)
CraftDropdown.Size = UDim2.new(1, 0, 0, 26); CraftDropdown.BackgroundTransparency = 1; CraftDropdown.ZIndex = 5
local CraftBtn = Instance.new("TextButton", CraftDropdown)
CraftBtn.Size = UDim2.new(1, 0, 1, 0); CraftBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40); CraftBtn.BackgroundTransparency = 0.3
CraftBtn.Text = "Craft Charm >"; CraftBtn.TextColor3 = UI_THEME.TextMain; CraftBtn.Font = UI_THEME.FontBtn; CraftBtn.TextSize = 10
Instance.new("UICorner", CraftBtn).CornerRadius = UDim.new(0, 6)

local CraftListFrame = Instance.new("ScrollingFrame", CraftDropdown)
CraftListFrame.Size = UDim2.new(1, 0, 0, 100); CraftListFrame.Position = UDim2.new(0, 0, 0, 30); CraftListFrame.BackgroundTransparency = 0.2
CraftListFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25); CraftListFrame.Visible = false; CraftListFrame.ZIndex = 6
Instance.new("UICorner", CraftListFrame).CornerRadius = UDim.new(0, 6)
local CraftListLayout = Instance.new("UIListLayout", CraftListFrame)
CraftListLayout.Padding = UDim.new(0, 2); CraftListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local SelectedCraft = nil
local CraftData = {"Oculus Charm", "Anchor Charm", "Hook Charm", "Winged Charm"}
for _, cName in ipairs(CraftData) do
    local btn = Instance.new("TextButton", CraftListFrame)
    btn.Size = UDim2.new(0.95, 0, 0, 24); btn.Text = cName; btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    btn.BackgroundTransparency = 0.5; btn.TextColor3 = Color3.fromRGB(200, 200, 200); btn.Font = UI_THEME.FontUI; btn.TextSize = 9
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)
    btn.MouseButton1Click:Connect(function()
        SelectedCraft = cName; CraftBtn.Text = "Craft: " .. cName; CraftListFrame.Visible = false
        Services.TweenService:Create(CraftContainer, TweenInfo.new(0.3), {Size = UDim2.new(0.95, 0, 0, 85)}):Play()
    end)
end
CraftListFrame.CanvasSize = UDim2.new(0, 0, 0, (#CraftData * 26))

local IsCraftOpen = false
CraftBtn.MouseButton1Click:Connect(function()
    IsCraftOpen = not IsCraftOpen; CraftListFrame.Visible = IsCraftOpen
    local sizeY = IsCraftOpen and 140 or 85
    Services.TweenService:Create(CraftContainer, TweenInfo.new(0.3), {Size = UDim2.new(0.95, 0, 0, sizeY)}):Play()
end)

local ActionFrameC = Instance.new("Frame", CraftContainer)
ActionFrameC.Size = UDim2.new(1, 0, 0, 26); ActionFrameC.Position = UDim2.new(0, 0, 1, -26); ActionFrameC.BackgroundTransparency = 1
local QtyInputC = Instance.new("TextBox", ActionFrameC)
QtyInputC.Size = UDim2.new(0.3, 0, 1, 0); QtyInputC.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
QtyInputC.BackgroundTransparency = 0.3; QtyInputC.Text = "1"; QtyInputC.TextColor3 = UI_THEME.Accent; QtyInputC.Font = UI_THEME.FontUI; QtyInputC.TextSize = 10
Instance.new("UICorner", QtyInputC).CornerRadius = UDim.new(0, 6)
local StartCraftBtn = Instance.new("TextButton", ActionFrameC)
StartCraftBtn.Size = UDim2.new(0.65, 0, 1, 0); StartCraftBtn.Position = UDim2.new(0.35, 0, 0, 0)
StartCraftBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0); StartCraftBtn.BackgroundTransparency = 0.2; StartCraftBtn.Text = "START CRAFT"
StartCraftBtn.TextColor3 = Color3.new(1,1,1); StartCraftBtn.Font = UI_THEME.FontBtn; StartCraftBtn.TextSize = 10
Instance.new("UICorner", StartCraftBtn).CornerRadius = UDim.new(0, 6)

local IsCrafting = false
StartCraftBtn.MouseButton1Click:Connect(function()
    local net = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
    if IsCrafting then
        IsCrafting = false
        net:WaitForChild("RF/CancelCrafting"):InvokeServer()
        StartCraftBtn.Text = "START CRAFT"; StartCraftBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
        return
    end
    if not SelectedCraft then Notify("CRAFT", "Select Charm!", Color3.fromRGB(255, 50, 50)) return end
    
    local amount = math.max(1, tonumber(QtyInputC.Text) or 1)
    IsCrafting = true; StartCraftBtn.Text = "STOP CRAFTING"; StartCraftBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    Notify("CRAFT", "Crafting " .. amount .. " " .. SelectedCraft .. "...", Color3.fromRGB(255, 200, 0))
    
    task.spawn(function()
        for i = 1, amount do
            if not IsCrafting then break end
            pcall(function()
                net:WaitForChild("RF/StartCrafting"):InvokeServer(SelectedCraft)
                task.wait(0.2)
                net:WaitForChild("RF/ConfirmCrafting"):InvokeServer()
            end)
            task.wait(0.5)
        end
        IsCrafting = false; StartCraftBtn.Text = "START CRAFT"; StartCraftBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
        Notify("CRAFT", "Finished!", Color3.fromRGB(0, 255, 100))
    end)
end)

-- [TAB EVENT]
MakeSwitch(PageEvent, "Auto Hunt Event", States.AutoEvent, function(val)
    States.AutoEvent = val
    Notify("EVENT", "Auto Hunt: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    if not val and IsInEvent then
        local hrp = GetRoot()
        if EventStartCFrame and hrp then hrp.CFrame = EventStartCFrame; EventStartCFrame = nil end
        IsInEvent = false; SetWoW(false)
        Notify("AUTO HUNT", "Returning...", nil)
    end
end)

-- ====================================================
-- [REFACTORED] MINING ROUTINE & LOGIC
-- ====================================================
local function RunZone(zoneName, tpCFrame, folderIslands, delayStart, delayBetween, sortMode)
    local r = GetRoot()
    if not r then return end
    r.Velocity = Vector3.zero; r.Anchored = false; r.CFrame = tpCFrame
    Notify("MINING", "Arrived " .. zoneName, Color3.fromRGB(255, 150, 0))
    task.wait(delayStart)
    
    while States.IsMining do
        local crystals = {}
        if folderIslands then
             for _, v in ipairs(folderIslands:GetChildren()) do
                if v:FindFirstChildWhichIsA("ProximityPrompt", true) then table.insert(crystals, v) end
            end
        end
        
        if #crystals == 0 then
            Notify("MINING", zoneName .. " Clean. Done.", Color3.fromRGB(0, 255, 100))
            return -- Guard Clause: Zone Empty
        end
        
        local myPos = GetRoot().Position
        table.sort(crystals, function(a,b)
            local dA = (a:GetPivot().Position - myPos).Magnitude
            local dB = (b:GetPivot().Position - myPos).Magnitude
            return sortMode == "Far" and dA > dB or dA < dB
        end)
        
        for _, node in ipairs(crystals) do
            if not States.IsMining then return end
            local prompt = node:FindFirstChildWhichIsA("ProximityPrompt", true)
            local part = prompt and prompt.Parent
            local r2 = GetRoot()
            
            if not (r2 and part and prompt) then continue end
            
            r2.Anchored = false
            local tTime = math.max(0.5, (r2.Position - part.Position).Magnitude / 60)
            local tw = Services.TweenService:Create(r2, TweenInfo.new(tTime, Enum.EasingStyle.Linear), {CFrame = part.CFrame * CFrame.new(0,0,3)})
            tw:Play(); tw.Completed:Wait()
            
            r2.Velocity = Vector3.zero; r2.Anchored = true; r2.CFrame = CFrame.lookAt(r2.Position, part.Position)
            task.wait(3)
            if prompt.Parent then
                fireproximityprompt(prompt)
                Notify("MINING", "Extracting...", Color3.fromRGB(255, 0, 0))
            end
            task.wait(2 + delayBetween)
        end
        task.wait(1)
    end
end

local function MiningRoutine()
    local hrp = GetRoot()
    if not hrp then return end
    
    SavedMinePosition = hrp.CFrame
    Notify("MINING", "Start: Position Saved.", Color3.fromRGB(255, 200, 0))
    
    local tool = Player.Character and Player.Character:FindFirstChildWhichIsA("Tool")
    if tool then tool.Parent = Player.Backpack end
    task.wait(0.5)
    
    Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/EquipToolFromHotbar"]:FireServer(2)
    Notify("MINING", "Equipped Pickaxe.", nil)
    task.wait(1.5) 
    
    local Isls = Services.Workspace:WaitForChild("Islands")
    local LavaFolder = Isls:WaitForChild("Lava Basin"):WaitForChild("Crystals")
    local DeepFolder = Isls:WaitForChild("Crystal Depths"):WaitForChild("Crystals")
    
    RunZone("Lava Basin", CFrame.new(860.08, 85.86, -10094.87), LavaFolder, 5, 5, "Near")
    
    if States.IsMining then
        Notify("MINING", "Moving to Deeps...", Color3.fromRGB(200, 0, 255))
        task.wait(5)
        RunZone("Crystal Depths", CFrame.new(5820.14, -907.79, 15424.53), DeepFolder, 5, 9, "Far")
    end
    
    Notify("MINING", "Mining Done. Returning...", Color3.fromRGB(0, 255, 0))
    States.IsMining = false 
    
    local finalRoot = GetRoot()
    if finalRoot and SavedMinePosition then
        finalRoot.Anchored = false; finalRoot.Velocity = Vector3.zero; finalRoot.CFrame = SavedMinePosition
    end
    task.wait(1)
    Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/EquipToolFromHotbar"]:FireServer(1)
end

MakeSwitch(PageEvent, "Auto Mine Lava/Crystal", States.AutoMiningV20, function(val)
    States.AutoMiningV20 = val
    if not val then
        States.IsMining = false; States.AutoFishActive = false
        local hrp = GetRoot()
        if hrp then
            hrp.Anchored = false
            for _, part in ipairs(Player.Character:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = true end
            end
        end
        Notify("MINING", "Stopped Completely.", Color3.fromRGB(255, 50, 50))
        return
    end

    task.spawn(function()
        Notify("SYSTEM", "Auto Mine: Every 2.5 Hours", nil)
        local NextRun = 0 
        local Interval = 2.5 * 60 * 60 
        
        while States.AutoMiningV20 do
            if tick() >= NextRun and not States.IsMining then
                States.AutoFishActive = false 
                States.IsMining = true 
                MiningRoutine() 
                States.IsMining = false
                NextRun = tick() + Interval
                Notify("SCHEDULE", "Next Mine at: " .. os.date("%H:%M", os.time() + Interval), Color3.fromRGB(0, 255, 255))
            end
            task.wait(5) 
        end
    end)
end)

-- ====================================================
-- [REFACTORED] SMART LOOPS (CORAL, EVENTS, RELIC)
-- ====================================================
MakeSwitch(PageEvent, "Auto Take Coral", States.AutoCoral, function(val)
    States.AutoCoral = val
    Notify("EVENT", "Auto Coral: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    if val and not States.HasTank then
        pcall(function() Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/EquipOxygenTank"]:InvokeServer(105) end)
        States.HasTank = true; Notify("GEAR", "Oxygen Tank Equipped", Color3.fromRGB(0, 255, 255))
    end
end)

-- AUTO CORAL LOOP
task.spawn(function()
    while true do
        task.wait(1.5)
        if not States.AutoCoral then
            if IsLootingCoral then IsLootingCoral = false; SetWoW(false) end
            task.wait(1.5)
            continue
        end

        pcall(function()
            local spawnFolder = Services.Workspace:FindFirstChild("!!! SEARCH ITEM SPAWNS")
            local coralFolder = spawnFolder and spawnFolder:FindFirstChild("Coral")
            if not coralFolder then return end -- Guard Clause

            local validCorals = {}
            for _, v in ipairs(coralFolder:GetDescendants()) do
                if not (v:IsA("Model") or v:IsA("BasePart")) then continue end
                if v:FindFirstChildWhichIsA("ProximityPrompt", true) then table.insert(validCorals, v) end
            end
            
            if #validCorals == 0 then
                if IsLootingCoral then
                    IsLootingCoral = false
                    local hrp = GetRoot()
                    if CoralReturnCFrame and hrp then hrp.CFrame = CoralReturnCFrame end
                    SetWoW(false)
                end
                return -- Guard Clause
            end

            local hrp = GetRoot()
            if not hrp then return end

            if not IsLootingCoral and not States.AutoFarmRelic then
                CoralReturnCFrame = hrp.CFrame
                IsLootingCoral = true
                Notify("CORAL", "Found "..#validCorals.." Corals!", Color3.fromRGB(0, 255, 100))
                SetWoW(true)
            end
            
            if IsLootingCoral then
                local v = validCorals[1]
                local prompt = v and v:FindFirstChildWhichIsA("ProximityPrompt", true)
                if prompt then
                    hrp.CFrame = v:GetPivot() + Vector3.new(0, 3, 0)
                    task.wait(0.2); fireproximityprompt(prompt)
                end
            end
        end)
    end
end)

local function ScanEvent()
    local folders = {Services.Workspace:FindFirstChild("ActiveEvents"), Services.Workspace:FindFirstChild("Props")}
    for _, folder in ipairs(folders) do
        if not folder then continue end
        for _, v in ipairs(folder:GetChildren()) do
            if not (v:IsA("Model") or v:IsA("BasePart")) then continue end
            for _, name in ipairs(EventList) do
                if v.Name == name or v.Name:find(name) then return v end
            end
        end
    end
    return nil
end

-- AUTO EVENT LOOP
task.spawn(function()
    while true do
        task.wait(1)
        if not States.AutoEvent then 
            task.wait(2)
            continue 
        end

        pcall(function()
            local hrp = GetRoot()
            if not hrp then return end
            
            local FoundEvent = ScanEvent()
            if not FoundEvent then
                if IsInEvent then
                    IsInEvent = false
                    Notify("AUTO HUNT", "Event Finished ", Color3.fromRGB(0, 255, 100))
                    if EventStartCFrame then hrp.CFrame = EventStartCFrame; EventStartCFrame = nil end
                    SetWoW(false)
                end
                return -- Guard Clause
            end

            if not IsInEvent then
                EventStartCFrame = hrp.CFrame; IsInEvent = true
                Notify("AUTO HUNT", "Teleport To ( " .. FoundEvent.Name .. " )", Color3.fromRGB(0, 255, 255))
                SetWoW(true)
            end
            
            local destPos = Vector3.new(FoundEvent:GetPivot().Position.X, 4, FoundEvent:GetPivot().Position.Z)
            if (hrp.Position - destPos).Magnitude > 5 then hrp.CFrame = CFrame.new(destPos) end
        end)
    end
end)

local function ProcessRelicWithSpots(relicContainer)
    if not States.AutoFarmRelic then return end
    local validNames = {["Sunken Eye Relic"]=true, ["Burntflame Relic"]=true, ["Blacktide Relic"]=true}
    if not validNames[relicContainer.Name] then return end

    local hrp = GetRoot()
    if not hrp then return end

    if not States.HasTank then
        pcall(function() Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/EquipOxygenTank"]:InvokeServer(575) end)
        States.HasTank = true; Notify("GEAR", "Oxygen Tank Equipped", Color3.fromRGB(0, 255, 255))
    end
    
    SetWoW(true)
    for i, spotPart in ipairs(relicContainer:GetChildren()) do
        if not States.AutoFarmRelic or States.Busy then break end
        local target = spotPart:FindFirstChild("Part") or (spotPart:IsA("BasePart") and spotPart)
        if target then
            States.Busy = true
            hrp.CFrame = target.CFrame + Vector3.new(0, 3, 0)
            task.wait(0.6)
            Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/ClaimRelic"]:FireServer(relicContainer.Name)
            Notify("RELIC", "Checked Spot " .. i .. " (" .. relicContainer.Name .. ")", Color3.fromRGB(0, 255, 100), 1)
            task.wait(1.5)
            States.Busy = false
        end
    end
end

MakeSwitch(PageEvent, "Auto Take Relics", States.AutoFarmRelic, function(val)
    States.AutoFarmRelic = val
    Notify("EVENT", "Auto All Relic: "..(val and "ON" or "OFF"), val and nil or Color3.fromRGB(255,50,50))
    if val then
        task.spawn(function()
            for _, v in ipairs(Services.Workspace:WaitForChild("LeviathanEvent"):WaitForChild("Relics"):GetChildren()) do
                if not States.AutoFarmRelic then break end
                ProcessRelicWithSpots(v)
            end
        end)
    else
        SetWoW(false); States.Busy = false; States.HasTank = false
    end
end)

-- [TAB PLAYER & MISC - Setup Compressed]
local FollowContainer = Instance.new("Frame", PagePlayer)
FollowContainer.Size = UDim2.new(0.95, 0, 0, 26); FollowContainer.BackgroundTransparency = 1
local BtnFollowToggle = Instance.new("TextButton", FollowContainer)
BtnFollowToggle.Size = UDim2.new(0.5, -3, 1, 0); BtnFollowToggle.BackgroundColor3 = Color3.fromRGB(30, 30, 40); BtnFollowToggle.BackgroundTransparency = 0.3
BtnFollowToggle.Text = "Follow Player: OFF"; BtnFollowToggle.TextColor3 = UI_THEME.TextMain; BtnFollowToggle.Font = UI_THEME.FontBtn; BtnFollowToggle.TextScaled = true
Instance.new("UICorner", BtnFollowToggle).CornerRadius = UDim.new(0, 6)
local BoxFollowInput = Instance.new("TextBox", FollowContainer)
BoxFollowInput.Size = UDim2.new(0.5, 0, 1, 0); BoxFollowInput.Position = UDim2.new(0.5, 0, 0, 0); BoxFollowInput.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
BoxFollowInput.BackgroundTransparency = 0.3; BoxFollowInput.PlaceholderText = "Input Name"; BoxFollowInput.TextColor3 = UI_THEME.Accent; BoxFollowInput.Font = UI_THEME.FontUI; BoxFollowInput.TextSize = 10
Instance.new("UICorner", BoxFollowInput).CornerRadius = UDim.new(0, 6)

MakeSwitch(PagePlayer, "No Damage", States.NoDmg, function(val) States.NoDmg = val end)
MakeSwitch(PagePlayer, "Streamer Mode", States.StreamerMode, function(val) States.StreamerMode = val; EnableNameSpoof(val) end)

local BtnSave = MakeBtn(PageMisc, "Save Position")
local BtnLoad = MakeBtn(PageMisc, "Load Position")
local BtnRejoin = MakeBtn(PageMisc, "Rejoin Server")
MakeSwitch(PageMisc, "Panel Seraphin", States.Panel, function(val) States.Panel = val; FloatHUD.Visible = val end)

BtnSave.MouseButton1Click:Connect(function()
    local hrp = GetRoot()
    if hrp then SavedCFrame = hrp.CFrame; BtnSave.Text="SAVED"; Notify("POSITION", "Location Saved!", nil); task.delay(1, function() BtnSave.Text="Save Position" end) end
end)
BtnLoad.MouseButton1Click:Connect(function()
    local hrp = GetRoot()
    if SavedCFrame and hrp then hrp.CFrame = SavedCFrame; Notify("POSITION", "Location Loaded!", nil) end
end)
BtnRejoin.MouseButton1Click:Connect(function() Services.TeleportService:Teleport(game.PlaceId, Player) end)

-- ====================================================
-- [REFACTORED] BACKGROUND SYSTEM LOOPS
-- ====================================================
-- Monitor Loop
local fpsT = 0
Services.RunService.RenderStepped:Connect(function(dt)
    fpsT = fpsT + (1/dt - fpsT) * 0.1
    if MonLabel then
        MonLabel.Text = string.format("FPS: %d | CPU: %.2f ms | TIME: %s", math.floor(fpsT), Services.Stats.PerformanceStats.CPU:GetValue(), DateTime.now():FormatUniversalTime("HH:mm:ss", "en-us"))
    end
end)

-- Status Detector Loop
task.spawn(function()
    while true do
        task.wait(1)
        if not States.Panel then task.wait(2) continue end
        
        pcall(function()
            local ls = Player:FindFirstChild("leaderstats")
            local cStat = ls and ls:FindFirstChild("Caught")
            LblFishVal.Text = tostring(cStat and cStat.Value or 0):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
            
            local bagText = "0/?"
            local backpackGui = Player:FindFirstChild("PlayerGui") and Player.PlayerGui:FindFirstChild("Backpack")
            local bpItems = Player:FindFirstChild("Backpack")
            
            if backpackGui then
                local foundLabel = false
                for _, v in ipairs(backpackGui:GetDescendants()) do
                    if v:IsA("TextLabel") and string.find(v.Text, "/") then
                        bagText = v.Text; foundLabel = true; break
                    end
                end
                if not foundLabel and bpItems then bagText = tostring(#bpItems:GetChildren()) end
            elseif bpItems then
                bagText = tostring(#bpItems:GetChildren())
            end
            LblInvVal.Text = bagText
        end)
    end
end)

-- Auto Equip Loop
task.spawn(function()
    while true do
        task.wait(2)
        if States.AutoEquip and not States.IsMining then ForceEquipRod() end
    end
end)

-- Init
task.spawn(function() if setfpscap then setfpscap(9999) end end)
task.delay(1, function() Main.Visible = true; FloatHUD.Visible = States.Panel end)