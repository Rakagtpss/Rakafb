-- =========================================================================
-- [ SERAPHIN HELPER - ULTIMATE OPTIMIZED EDITION ]
-- =========================================================================

-- [1] SERVICES & SETUP UTAMA
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    Lighting = game:GetService("Lighting"),
    TeleportService = game:GetService("TeleportService"),
    UserInputService = game:GetService("UserInputService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace"),
    VirtualUser = game:GetService("VirtualUser"),
    TextChatService = game:GetService("TextChatService")
}

local Player = Services.Players.LocalPlayer
local Cam = Services.Workspace.CurrentCamera

-- Anti-AFK (Cegah Error 277 / Disconnect karena idle)
Player.Idled:Connect(function()
    Services.VirtualUser:CaptureController()
    Services.VirtualUser:ClickButton2(Vector2.new())
end)

-- Safe Character Getters
local function GetChar() return Player.Character or Player.CharacterAdded:Wait() end
local function GetRoot() local c = Player.Character; return c and c:FindFirstChild("HumanoidRootPart") end
local function GetHum() local c = Player.Character; return c and c:FindFirstChild("Humanoid") end

-- Cleanup UI Lama
if Services.CoreGui:FindFirstChild("SeraHelper") then Services.CoreGui.SeraHelper:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraHelper"
ScreenGui.Parent = Services.CoreGui
ScreenGui.ResetOnSpawn = false

-- ====================================================
-- [2] KONFIGURASI TEMA UI (SOLID & NEON STROKE)
-- ====================================================
local THEME = {
    BgMain = Color3.fromRGB(12, 12, 16),       -- Hitam Solid
    BgSide = Color3.fromRGB(8, 8, 11),         -- Hitam Pekat
    BgElement = Color3.fromRGB(20, 20, 25),    -- Abu Gelap
    Accent = Color3.fromRGB(0, 255, 200),      -- Neon Cyan
    AccentOff = Color3.fromRGB(50, 50, 60),    -- Abu mati
    Stroke = Color3.fromRGB(35, 35, 45),       -- Garis tepi elemen
    TextMain = Color3.fromRGB(245, 245, 245),
    TextSub = Color3.fromRGB(140, 140, 150),
    FontMain = Enum.Font.GothamMedium,
    FontBold = Enum.Font.GothamBold,
    Radius = UDim.new(0, 6),
    Width = 430,
    Height = 290
}

-- ====================================================
-- [3] UI BUILDER LIBRARY (CLEAN & MODULAR CODE)
-- ====================================================
local UI = {}

function UI.MakeCorner(parent, radius)
    local corner = Instance.new("UICorner", parent)
    corner.CornerRadius = radius or THEME.Radius
    return corner
end

function UI.MakeStroke(parent, color, thickness)
    local stroke = Instance.new("UIStroke", parent)
    stroke.Color = color or THEME.Stroke
    stroke.Thickness = thickness or 1
    return stroke
end

function UI.MakeDrag(gui)
    local dragToggle, dragStart, startPos
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true; dragStart = input.Position; startPos = gui.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
        end
    end)
    gui.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            local dragInput = input
            Services.UserInputService.InputChanged:Connect(function(inputCheck)
                if inputCheck == dragInput and dragToggle then
                    local delta = inputCheck.Position - dragStart
                    gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
                end
            end)
        end
    end)
end

function UI.Notify(title, text, color)
    color = color or THEME.Accent
    local container = ScreenGui:FindFirstChild("NotifyContainer")
    if not container then
        container = Instance.new("Frame", ScreenGui)
        container.Name = "NotifyContainer"
        container.Size = UDim2.new(0, 220, 0.5, 0)
        container.Position = UDim2.new(1, -20, 1, -20)
        container.AnchorPoint = Vector2.new(1, 1)
        container.BackgroundTransparency = 1
        local layout = Instance.new("UIListLayout", container)
        layout.FillDirection = Enum.FillDirection.Vertical
        layout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        layout.Padding = UDim.new(0, 8)
    end
    
    local f = Instance.new("Frame", container)
    f.Size = UDim2.new(1, 0, 0, 45)
    f.BackgroundColor3 = THEME.BgMain
    UI.MakeCorner(f)
    UI.MakeStroke(f)
    
    local bar = Instance.new("Frame", f)
    bar.Size = UDim2.new(0, 4, 1, -12)
    bar.Position = UDim2.new(0, 6, 0, 6)
    bar.BackgroundColor3 = color
    UI.MakeCorner(bar, UDim.new(1, 0))
    
    local lTitle = Instance.new("TextLabel", f)
    lTitle.Size = UDim2.new(1, -20, 0, 15)
    lTitle.Position = UDim2.new(0, 16, 0, 6)
    lTitle.BackgroundTransparency = 1
    lTitle.Text = title:upper()
    lTitle.TextColor3 = color
    lTitle.Font = THEME.FontBold
    lTitle.TextSize = 11
    lTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    local lMsg = Instance.new("TextLabel", f)
    lMsg.Size = UDim2.new(1, -20, 0, 15)
    lMsg.Position = UDim2.new(0, 16, 0, 22)
    lMsg.BackgroundTransparency = 1
    lMsg.Text = text
    lMsg.TextColor3 = THEME.TextMain
    lMsg.Font = THEME.FontMain
    lMsg.TextSize = 10
    lMsg.TextXAlignment = Enum.TextXAlignment.Left

    f.Position = UDim2.new(1.5, 0, 0, 0)
    Services.TweenService:Create(f, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Position = UDim2.new(0, 0, 0, 0)}):Play()
    
    task.delay(3.5, function()
        if not f then return end
        local tw = Services.TweenService:Create(f, TweenInfo.new(0.3), {BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 0)})
        for _, v in pairs(f:GetDescendants()) do
            if v:IsA("TextLabel") then Services.TweenService:Create(v, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
            elseif v:IsA("Frame") then Services.TweenService:Create(v, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
            elseif v:IsA("UIStroke") then Services.TweenService:Create(v, TweenInfo.new(0.2), {Transparency = 1}):Play() end
        end
        tw:Play()
        tw.Completed:Wait()
        f:Destroy()
    end)
end

function UI.CreateButton(parent, text, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0.95, 0, 0, 28)
    btn.BackgroundColor3 = THEME.BgElement
    btn.Text = text
    btn.TextColor3 = THEME.TextMain
    btn.Font = THEME.FontBold
    btn.TextSize = 10
    btn.AutoButtonColor = true
    UI.MakeCorner(btn)
    UI.MakeStroke(btn)
    
    btn.MouseButton1Click:Connect(function()
        Services.TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = THEME.Accent}):Play()
        task.wait(0.1)
        Services.TweenService:Create(btn, TweenInfo.new(0.3), {BackgroundColor3 = THEME.BgElement}):Play()
        if callback then pcall(callback) end
    end)
    return btn
end

function UI.CreateToggle(parent, text, default, callback)
    local f = Instance.new("Frame", parent)
    f.Size = UDim2.new(0.95, 0, 0, 28)
    f.BackgroundColor3 = THEME.BgElement
    UI.MakeCorner(f)
    UI.MakeStroke(f)
    
    local lbl = Instance.new("TextLabel", f)
    lbl.Size = UDim2.new(0.7, 0, 1, 0)
    lbl.Position = UDim2.new(0, 10, 0, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.TextColor3 = THEME.TextMain
    lbl.Font = THEME.FontMain
    lbl.TextSize = 10
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    
    local tBtn = Instance.new("TextButton", f)
    tBtn.Size = UDim2.new(0, 30, 0, 14)
    tBtn.Position = UDim2.new(1, -40, 0.5, -7)
    tBtn.BackgroundColor3 = default and THEME.Accent or THEME.AccentOff
    tBtn.Text = ""
    UI.MakeCorner(tBtn, UDim.new(1, 0))
    
    local circle = Instance.new("Frame", tBtn)
    circle.Size = UDim2.new(0, 10, 0, 10)
    circle.Position = default and UDim2.new(1, -12, 0.5, -5) or UDim2.new(0, 2, 0.5, -5)
    circle.BackgroundColor3 = Color3.new(1,1,1)
    UI.MakeCorner(circle, UDim.new(1, 0))
    
    local isOn = default
    local debounce = false
    tBtn.MouseButton1Click:Connect(function()
        if debounce then return end
        debounce = true
        isOn = not isOn
        
        local twInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        if isOn then
            Services.TweenService:Create(tBtn, twInfo, {BackgroundColor3 = THEME.Accent}):Play()
            Services.TweenService:Create(circle, twInfo, {Position = UDim2.new(1, -12, 0.5, -5)}):Play()
        else
            Services.TweenService:Create(tBtn, twInfo, {BackgroundColor3 = THEME.AccentOff}):Play()
            Services.TweenService:Create(circle, twInfo, {Position = UDim2.new(0, 2, 0.5, -5)}):Play()
        end
        if callback then pcall(callback, isOn) end
        task.wait(0.2)
        debounce = false
    end)
    return f
end

function UI.CreateDropdown(parent, titleText, options, callback)
    local container = Instance.new("Frame", parent)
    container.Size = UDim2.new(0.95, 0, 0, 28)
    container.BackgroundTransparency = 1
    container.ClipsDescendants = true
    
    local btn = UI.CreateButton(container, titleText .. " >")
    btn.Size = UDim2.new(1, 0, 0, 28)
    
    local listFrm = Instance.new("ScrollingFrame", container)
    listFrm.Size = UDim2.new(1, 0, 1, -32)
    listFrm.Position = UDim2.new(0, 0, 0, 32)
    listFrm.BackgroundColor3 = THEME.BgMain
    listFrm.ScrollBarThickness = 2
    listFrm.BorderSizePixel = 0
    UI.MakeCorner(listFrm)
    UI.MakeStroke(listFrm)
    
    local listLayout = Instance.new("UIListLayout", listFrm)
    listLayout.Padding = UDim.new(0, 4)
    listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    local isOpen = false
    local baseHeight = 28
    local itemHeight = 26
    local maxDisplay = math.min(#options, 4)
    local openHeight = baseHeight + 4 + (maxDisplay * itemHeight)
    
    btn.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        local targetSize = isOpen and UDim2.new(0.95, 0, 0, openHeight) or UDim2.new(0.95, 0, 0, baseHeight)
        Services.TweenService:Create(container, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = targetSize}):Play()
    end)
    
    for _, opt in ipairs(options) do
        local iBtn = Instance.new("TextButton", listFrm)
        iBtn.Size = UDim2.new(0.95, 0, 0, 24)
        iBtn.BackgroundColor3 = THEME.BgElement
        iBtn.Text = opt
        iBtn.TextColor3 = THEME.TextMain
        iBtn.Font = THEME.FontMain
        iBtn.TextSize = 10
        UI.MakeCorner(iBtn)
        
        iBtn.MouseButton1Click:Connect(function()
            isOpen = false
            btn.Text = titleText .. ": " .. opt
            Services.TweenService:Create(container, TweenInfo.new(0.2), {Size = UDim2.new(0.95, 0, 0, baseHeight)}):Play()
            if callback then pcall(callback, opt) end
        end)
    end
    listFrm.CanvasSize = UDim2.new(0, 0, 0, #options * itemHeight)
    
    return container
end

-- ====================================================
-- [4] MINI HUD & MONITOR (DIOPTIMALKAN)
-- ====================================================
local Monitor = Instance.new("Frame", ScreenGui)
Monitor.Size = UDim2.new(0, 180, 0, 24)
Monitor.Position = UDim2.new(0.5, -90, 0, 10)
Monitor.BackgroundColor3 = THEME.BgMain
UI.MakeCorner(Monitor)
UI.MakeStroke(Monitor)
UI.MakeDrag(Monitor)

local LblMon = Instance.new("TextLabel", Monitor)
LblMon.Size = UDim2.new(1, 0, 1, 0)
LblMon.BackgroundTransparency = 1
LblMon.Text = "FPS: -- | CPU: --"
LblMon.TextColor3 = THEME.Accent
LblMon.Font = THEME.FontBold
LblMon.TextSize = 10

local FloatHUD = Instance.new("Frame", ScreenGui)
FloatHUD.Size = UDim2.new(0, 150, 0, 75)
FloatHUD.Position = UDim2.new(0.5, 0, 0.35, 0)
FloatHUD.AnchorPoint = Vector2.new(0.5, 0)
FloatHUD.BackgroundColor3 = THEME.BgMain
FloatHUD.Visible = false
UI.MakeCorner(FloatHUD)
UI.MakeStroke(FloatHUD)
UI.MakeDrag(FloatHUD)

local LytHUD = Instance.new("UIListLayout", FloatHUD)
LytHUD.HorizontalAlignment = Enum.HorizontalAlignment.Center
LytHUD.Padding = UDim.new(0, 2)
Instance.new("UIPadding", FloatHUD).PaddingTop = UDim.new(0, 8)

local LblTitleHUD = Instance.new("TextLabel", FloatHUD)
LblTitleHUD.Size = UDim2.new(1, 0, 0, 15)
LblTitleHUD.BackgroundTransparency = 1
LblTitleHUD.Text = "SERAPHIN STATS"
LblTitleHUD.TextColor3 = THEME.Accent
LblTitleHUD.Font = THEME.FontBold
LblTitleHUD.TextSize = 11

local function AddStat(parent, title)
    local f = Instance.new("Frame", parent)
    f.Size = UDim2.new(1, 0, 0, 20)
    f.BackgroundTransparency = 1
    local l1 = Instance.new("TextLabel", f)
    l1.Size = UDim2.new(0.5, -5, 1, 0)
    l1.Position = UDim2.new(0, 5, 0, 0)
    l1.BackgroundTransparency = 1
    l1.Text = title
    l1.TextColor3 = THEME.TextSub
    l1.Font = THEME.FontMain
    l1.TextSize = 10
    l1.TextXAlignment = Enum.TextXAlignment.Left
    local l2 = Instance.new("TextLabel", f)
    l2.Size = UDim2.new(0.5, -5, 1, 0)
    l2.Position = UDim2.new(0.5, 0, 0, 0)
    l2.BackgroundTransparency = 1
    l2.Text = "-"
    l2.TextColor3 = THEME.TextMain
    l2.Font = THEME.FontBold
    l2.TextSize = 10
    l2.TextXAlignment = Enum.TextXAlignment.Right
    return l2
end
local StatFish = AddStat(FloatHUD, "FISH:")
local StatInv = AddStat(FloatHUD, "BAG:")

-- ====================================================
-- [5] MAIN UI DASHBOARD
-- ====================================================
local MainGui = Instance.new("Frame", ScreenGui)
MainGui.Size = UDim2.new(0, THEME.Width, 0, THEME.Height)
MainGui.Position = UDim2.new(0, 50, 0.5, -THEME.Height/2)
MainGui.BackgroundColor3 = THEME.BgMain
MainGui.ClipsDescendants = true
UI.MakeCorner(MainGui)
UI.MakeStroke(MainGui)
UI.MakeDrag(MainGui)

local Header = Instance.new("Frame", MainGui)
Header.Size = UDim2.new(1, 0, 0, 35)
Header.BackgroundColor3 = THEME.BgSide
UI.MakeCorner(Header)
local TitleLabel = Instance.new("TextLabel", Header)
TitleLabel.Size = UDim2.new(1, -20, 1, 0)
TitleLabel.Position = UDim2.new(0, 15, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "SERAPHIN <font color='#00ffc8'>ULTIMATE</font>"
TitleLabel.RichText = true
TitleLabel.TextColor3 = THEME.TextMain
TitleLabel.Font = THEME.FontBold
TitleLabel.TextSize = 14
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

local Sidebar = Instance.new("Frame", MainGui)
Sidebar.Size = UDim2.new(0, 100, 1, -35)
Sidebar.Position = UDim2.new(0, 0, 0, 35)
Sidebar.BackgroundColor3 = THEME.BgSide
local SideLyt = Instance.new("UIListLayout", Sidebar)
SideLyt.Padding = UDim.new(0, 5)
SideLyt.HorizontalAlignment = Enum.HorizontalAlignment.Center
Instance.new("UIPadding", Sidebar).PaddingTop = UDim.new(0, 10)

local PageArea = Instance.new("Frame", MainGui)
PageArea.Size = UDim2.new(1, -110, 1, -45)
PageArea.Position = UDim2.new(0, 105, 0, 40)
PageArea.BackgroundTransparency = 1

local Tabs = {}
local Pages = {}

local function CreateTab(name, iconText)
    local btn = Instance.new("TextButton", Sidebar)
    btn.Size = UDim2.new(0.85, 0, 0, 28)
    btn.BackgroundColor3 = THEME.BgMain
    btn.Text = iconText .. " " .. name
    btn.TextColor3 = THEME.TextSub
    btn.Font = THEME.FontBold
    btn.TextSize = 10
    UI.MakeCorner(btn)
    
    local page = Instance.new("ScrollingFrame", PageArea)
    page.Size = UDim2.new(1, 0, 1, 0)
    page.BackgroundTransparency = 1
    page.ScrollBarThickness = 2
    page.Visible = false
    page.BorderSizePixel = 0
    
    local layout = Instance.new("UIGridLayout", page)
    layout.CellSize = UDim2.new(0.48, 0, 0, 28)
    layout.CellPadding = UDim2.new(0, 8, 0, 8)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    
    Tabs[name] = btn
    Pages[name] = page
    
    btn.MouseButton1Click:Connect(function()
        for tName, tBtn in pairs(Tabs) do
            tBtn.TextColor3 = THEME.TextSub
            tBtn.BackgroundColor3 = THEME.BgMain
            Pages[tName].Visible = false
        end
        btn.TextColor3 = THEME.Accent
        btn.BackgroundColor3 = THEME.BgElement
        page.Visible = true
    end)
    return page
end

local PgMain   = CreateTab("Main", "âš¡")
local PgFarm   = CreateTab("Farm", "â›ï¸")
local PgShop   = CreateTab("Shop", "ðŸ›’")
local PgPlayer = CreateTab("Player", "ðŸ‘¤")

-- Initialize First Tab
Tabs["Main"].TextColor3 = THEME.Accent
Tabs["Main"].BackgroundColor3 = THEME.BgElement
Pages["Main"].Visible = true

-- ====================================================
-- [6] GLOBAL STATES & LOGIC
-- ====================================================
local States = {
    SuperBoost = false, Noclip = false, HideRod = false, WoW = false,
    AutoMine = false, IsMining = false,
    AutoCoral = false, IsLootingCoral = false, CoralReturn = nil,
    AutoRelic = false,
    AutoEvent = false, IsInEvent = false, EventStart = nil,
    Speed = false, NoDmg = false, AutoEquip = false,
    Streamer = false, AnimSkin = "Off",
    HasTank = false,
    MineReturn = nil
}
local Connections = {}
local EventList = {"Ghost Shark Hunt", "Worm Hunt", "Treasure Hunt", "Shark Hunt", "Megalodon Hunt"}

-- // LOGIC: GHOST ROD (HIDE ROD)
getgenv().RemoveRodEnabled = false
local function ApplyGhostRod(tool)
    task.wait()
    for _, obj in pairs(tool:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Beam") or obj:IsA("Light") or obj:IsA("Fire") or obj:IsA("Sparkles") then
            obj:Destroy()
        elseif obj:IsA("BasePart") or obj:IsA("MeshPart") then
            obj.Transparency = 1
            obj.CanCollide = false
            obj.CastShadow = false
        elseif obj:IsA("Texture") or obj:IsA("Decal") then
            obj:Destroy()
        end
    end
end

local function SetHideRod(val)
    States.HideRod = val
    getgenv().RemoveRodEnabled = val
    if val then
        local char = GetChar()
        if char then
            local t = char:FindFirstChild("!!!EQUIPPED_TOOL!!!") or char:FindFirstChildWhichIsA("Tool")
            if t then ApplyGhostRod(t) end
            if Connections.GhostRod then Connections.GhostRod:Disconnect() end
            Connections.GhostRod = char.ChildAdded:Connect(function(c)
                if getgenv().RemoveRodEnabled and (c:IsA("Tool") or c.Name == "!!!EQUIPPED_TOOL!!!") then
                    ApplyGhostRod(c)
                end
            end)
        end
        UI.Notify("MAIN", "Ghost Rod Active", THEME.Accent)
    else
        if Connections.GhostRod then Connections.GhostRod:Disconnect() end
    end
end

-- // LOGIC: SUPER CPU BOOSTER (MAXIMUM CULLING)
local BoostConn = nil
local function SuperOptimize(v)
    pcall(function()
        if v:IsA("BasePart") then
            v.Material = Enum.Material.SmoothPlastic
            v.Reflectance = 0
            v.CastShadow = false
            
            -- [SUPER CULLING] Matikan hitbox map agar CPU tidak perlu kalkulasi
            if not v:IsDescendantOf(Player.Character) and v.Name ~= "HumanoidRootPart" and v.Name ~= "Head" then
                v.CanTouch = false
                v.CanQuery = false
            end
            
            if v.Transparency > 0.5 then v.Transparency = 1 end
            if v.Name == "Water" then v.Transparency = 1 end
            if v:IsA("MeshPart") then v.TextureID = "" end
            
        elseif v:IsA("Decal") or v:IsA("Texture") or v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Light") or v:IsA("Sparkles") or v:IsA("Fire") or v:IsA("Smoke") then
            v:Destroy()
            
        elseif v:IsA("Accessory") or v:IsA("Shirt") or v:IsA("Pants") or v:IsA("ShirtGraphic") or v:IsA("CharacterMesh") then
            -- Hapus baju & aksesoris orang lain
            if v.Parent and v.Parent ~= Player.Character then
                v:Destroy()
            end
        end
    end)
end

local function SetSuperBoost(val)
    States.SuperBoost = val
    if val then
        if setfpscap then setfpscap(9999) end
        pcall(function()
            settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
            UserSettings():GetService("UserGameSettings").SavedQualityLevel = Enum.SavedQualityLevel.QualityLevel1
        end)
        
        pcall(function()
            local l = Services.Lighting
            l.GlobalShadows = false
            for _, v in pairs(l:GetChildren()) do
                if v:IsA("PostEffect") or v:IsA("Atmosphere") or v:IsA("Sky") then v:Destroy() end
            end
        end)
        
        pcall(function()
            local t = Services.Workspace.Terrain
            t.WaterWaveSize = 0; t.WaterWaveSpeed = 0; t.WaterReflectance = 0
            sethiddenproperty(t, "Decoration", false)
            Services.Workspace.GlobalWind = Vector3.zero
        end)
        
        for _, v in pairs(Services.Workspace:GetDescendants()) do SuperOptimize(v) end
        if BoostConn then BoostConn:Disconnect() end
        BoostConn = Services.Workspace.DescendantAdded:Connect(function(v) task.wait(); SuperOptimize(v) end)
        
        UI.Notify("BOOST", "SUPER OPTIMIZATION: ON", Color3.fromRGB(0, 255, 100))
    else
        if BoostConn then BoostConn:Disconnect() end
        UI.Notify("BOOST", "Disabled (Rejoin to reset map)", Color3.fromRGB(255, 100, 100))
    end
end

-- // LOGIC: STREAMER MODE
local NameSpoofConn, CharSpoofConn = nil, nil
local SPOOF_TEXT = '<font color="#00ffff" face="GothamBold"><b>discord.gg/getseraphin</b></font>'

local function ApplySpoof()
    if not States.Streamer then return end
    local char = Player.Character
    if char then
        local hrp = char:WaitForChild("HumanoidRootPart", 5)
        local oh = hrp and hrp:WaitForChild("Overhead", 5)
        local lbl = oh and oh:FindFirstChild("Header", true)
        if lbl then
            lbl.RichText = true
            lbl.Text = SPOOF_TEXT
            if NameSpoofConn then NameSpoofConn:Disconnect() end
            NameSpoofConn = lbl:GetPropertyChangedSignal("Text"):Connect(function()
                if lbl.Text ~= SPOOF_TEXT then lbl.Text = SPOOF_TEXT end
            end)
        end
    end
end

local function SetStreamer(val)
    States.Streamer = val
    if val then
        ApplySpoof()
        if CharSpoofConn then CharSpoofConn:Disconnect() end
        CharSpoofConn = Player.CharacterAdded:Connect(function() task.wait(1); ApplySpoof() end)
    else
        if CharSpoofConn then CharSpoofConn:Disconnect() end
        if NameSpoofConn then NameSpoofConn:Disconnect() end
    end
end

Services.TextChatService.OnIncomingMessage = function(msg)
    if not States.Streamer then return nil end
    local props = Instance.new("TextChatMessageProperties")
    local text = msg.Text
    if string.find(text, "caught") or string.find(text, "obtained") then
        local newText = string.gsub(text, "^%S+", SPOOF_TEXT)
        props.Text = newText
    end
    if msg.TextSource then props.PrefixText = SPOOF_TEXT .. ": " end
    return props
end

-- ====================================================
-- [7] MENGISI KONTEN TAB (UI POPULATION)
-- ====================================================

-- >> TAB: MAIN
UI.CreateToggle(PgMain, "Super CPU Boost", false, SetSuperBoost)
UI.CreateToggle(PgMain, "Hide Rod (Ghost)", false, SetHideRod)
UI.CreateToggle(PgMain, "Walk On Water", false, function(val)
    States.WoW = val
    if val then
        local hrp = GetRoot()
        if hrp then
            local bv = Instance.new("BodyVelocity", hrp)
            bv.Name = "WoW_BV"
            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            if Connections.WoW then Connections.WoW:Disconnect() end
            Connections.WoW = Services.RunService.RenderStepped:Connect(function()
                local h = GetHum()
                if h and hrp:FindFirstChild("WoW_BV") then
                    local dir = h.MoveDirection
                    hrp.WoW_BV.Velocity = Vector3.new(dir.X * h.WalkSpeed, 0, dir.Z * h.WalkSpeed)
                end
            end)
        end
    else
        if Connections.WoW then Connections.WoW:Disconnect() end
        local hrp = GetRoot()
        if hrp and hrp:FindFirstChild("WoW_BV") then hrp.WoW_BV:Destroy() end
    end
end)
UI.CreateToggle(PgMain, "No Clip V2", false, function(val)
    States.Noclip = val
    if val then
        Connections.Noclip = Services.RunService.Stepped:Connect(function()
            local c = GetChar()
            if c then for _,v in pairs(c:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end end
        end)
    else
        if Connections.Noclip then Connections.Noclip:Disconnect() end
    end
end)
UI.CreateToggle(PgMain, "3D No Render", false, function(val)
    Services.RunService:Set3dRenderingEnabled(not val)
end)
UI.CreateToggle(PgMain, "Auto Equip Rod", false, function(val) States.AutoEquip = val end)

-- >> TAB: FARM (MINING, CORAL, RELIC, EVENT)
-- Mengubah UIGridLayout khusus tab Farm agar listnya memanjang (Vertical) bukan Grid
PgFarm:FindFirstChildOfClass("UIGridLayout"):Destroy()
local LytFarm = Instance.new("UIListLayout", PgFarm)
LytFarm.Padding = UDim.new(0, 5)

UI.CreateToggle(PgFarm, "Auto Mine Lava & Depths", false, function(val) States.AutoMine = val end)
UI.CreateToggle(PgFarm, "Auto Take Coral", false, function(val) States.AutoCoral = val end)
UI.CreateToggle(PgFarm, "Auto Farm All Relics", false, function(val) States.AutoRelic = val end)
UI.CreateToggle(PgFarm, "Auto Hunt Event", false, function(val) States.AutoEvent = val end)
UI.CreateButton(PgFarm, "Teleport to NPC Quest", function()
    local npc = Services.Workspace:FindFirstChild("NPC") and Services.Workspace.NPC:FindFirstChild("Archaeologist")
    local hrp = GetRoot()
    if npc and hrp then hrp.CFrame = npc:GetPivot() + Vector3.new(0,0,4) end
end)

-- >> TAB: SHOP (CRAFTING & BUYING)
PgShop:FindFirstChildOfClass("UIGridLayout"):Destroy()
local LytShop = Instance.new("UIListLayout", PgShop)
LytShop.Padding = UDim.new(0, 5)

local Net = Services.ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net

-- Craft Charm Group
local selectedCraft = "Oculus Charm"
UI.CreateDropdown(PgShop, "Craft", {"Oculus Charm", "Anchor Charm", "Hook Charm", "Winged Charm"}, function(val) selectedCraft = val end)
UI.CreateButton(PgShop, "[ ACTION ] START CRAFT 1x", function()
    UI.Notify("CRAFT", "Crafting " .. selectedCraft, THEME.Accent)
    pcall(function()
        Net["RF/StartCrafting"]:InvokeServer(selectedCraft)
        task.wait(0.5)
        Net["RF/ConfirmCrafting"]:InvokeServer()
    end)
end)

-- Buy Charm Group
local selectedCharm = 1
local charmMap = {["Bone Charm"]=1, ["Algae Charm"]=2, ["Magma Charm"]=3, ["Clover Charm"]=4, ["Heart Charm"]=14}
UI.CreateDropdown(PgShop, "Buy", {"Bone Charm", "Magma Charm", "Algae Charm", "Clover Charm", "Heart Charm"}, function(val) selectedCharm = charmMap[val] end)
UI.CreateButton(PgShop, "[ ACTION ] PURCHASE 1x", function()
    pcall(function() Net["RF/PurchaseCharm"]:InvokeServer(selectedCharm) end)
    UI.Notify("SHOP", "Purchased Charm", THEME.Accent)
end)

-- >> TAB: PLAYER
UI.CreateToggle(PgPlayer, "No Damage", false, function(val) States.NoDmg = val end)
UI.CreateToggle(PgPlayer, "Streamer Mode", false, SetStreamer)
UI.CreateDropdown(PgPlayer, "Skin Anim", {"Off", "Corruption Edge", "Princess Parasol", "Soul Scythe"}, function(val)
    if val == "Off" then States.AnimSkin = "Off" else States.AnimSkin = val .. " - FishCaught" end
end)
UI.CreateToggle(PgPlayer, "Walk Speed (50)", false, function(val) States.Speed = val end)

-- ====================================================
-- [8] BACKGROUND FARMING LOOPS (SAFE & OPTIMIZED)
-- ====================================================

-- 8.1 Auto Mine Routine
local function ExecuteMining()
    local hrp = GetRoot()
    if not hrp then return end
    States.MineReturn = hrp.CFrame
    UI.Notify("MINING", "Starting Area Sweep...", THEME.Accent)
    
    pcall(function() Net["RE/EquipToolFromHotbar"]:FireServer(2) end)
    task.wait(1)
    
    local function SweepZone(zoneName, tpPos, fld)
        hrp.CFrame = tpPos; hrp.Velocity = Vector3.zero
        task.wait(3)
        while States.AutoMine and States.IsMining do
            local crystals = {}
            if fld then
                for _,v in pairs(fld:GetChildren()) do
                    if v:FindFirstChildWhichIsA("ProximityPrompt", true) then table.insert(crystals, v) end
                end
            end
            if #crystals == 0 then break end
            
            local myPos = GetRoot().Position
            table.sort(crystals, function(a,b) return (a:GetPivot().Position - myPos).Magnitude < (b:GetPivot().Position - myPos).Magnitude end)
            
            for _, node in ipairs(crystals) do
                if not States.IsMining then return end
                local prmpt = node:FindFirstChildWhichIsA("ProximityPrompt", true)
                if prmpt and prmpt.Parent then
                    GetRoot().CFrame = prmpt.Parent.CFrame * CFrame.new(0,0,3)
                    GetRoot().Velocity = Vector3.zero
                    task.wait(1.5) -- Safe wait for server sync
                    if prmpt.Parent then fireproximityprompt(prmpt) end
                    task.wait(2)
                end
            end
            task.wait(1)
        end
    end
    
    local wsIslands = Services.Workspace:WaitForChild("Islands")
    SweepZone("Lava Basin", CFrame.new(860, 85, -10094), wsIslands:WaitForChild("Lava Basin"):WaitForChild("Crystals"))
    if States.IsMining then
        task.wait(2)
        SweepZone("Crystal Depths", CFrame.new(5820, -907, 15424), wsIslands:WaitForChild("Crystal Depths"):WaitForChild("Crystals"))
    end
    
    States.IsMining = false
    if GetRoot() and States.MineReturn then GetRoot().CFrame = States.MineReturn end
    pcall(function() Net["RE/EquipToolFromHotbar"]:FireServer(1) end)
end

task.spawn(function()
    local nextMine = 0
    while task.wait(5) do
        if States.AutoMine and tick() >= nextMine and not States.IsMining then
            States.IsMining = true
            ExecuteMining()
            nextMine = tick() + (2.5 * 3600) -- 2.5 Jam
            UI.Notify("SCHEDULER", "Next mine in 2.5 Hours", THEME.Accent)
        elseif not States.AutoMine then
            States.IsMining = false
        end
    end
end)

-- 8.2 Auto Coral Routine
task.spawn(function()
    while task.wait(1.5) do
        if States.AutoCoral and not States.IsMining and not States.AutoRelic then
            pcall(function()
                local corals = {}
                local spawns = Services.Workspace:FindFirstChild("!!! SEARCH ITEM SPAWNS")
                if spawns and spawns:FindFirstChild("Coral") then
                    for _, v in pairs(spawns.Coral:GetDescendants()) do
                        if v:IsA("ProximityPrompt") and v.Enabled then table.insert(corals, v) end
                    end
                end
                
                local hrp = GetRoot()
                if #corals > 0 and hrp then
                    if not States.IsLootingCoral then
                        States.CoralReturn = hrp.CFrame
                        States.IsLootingCoral = true
                        if not States.HasTank then pcall(function() Net["RF/EquipOxygenTank"]:InvokeServer(105); States.HasTank=true end) end
                    end
                    
                    for _, prmpt in ipairs(corals) do
                        if not States.AutoCoral or States.IsMining then break end
                        if prmpt and prmpt.Parent and prmpt.Enabled then
                            hrp.CFrame = CFrame.new(prmpt.Parent:IsA("Model") and prmpt.Parent:GetPivot().Position or prmpt.Parent.Position) + Vector3.new(0,3,0)
                            hrp.Velocity = Vector3.zero
                            task.wait(0.6)
                            if prmpt.Parent then fireproximityprompt(prmpt) end
                            task.wait(1.5) -- Anti 277 spam limit
                        end
                    end
                else
                    if States.IsLootingCoral and hrp and States.CoralReturn then
                        hrp.CFrame = States.CoralReturn
                        States.IsLootingCoral = false
                    end
                end
            end)
        end
    end
end)

-- 8.3 Auto Relic Routine
task.spawn(function()
    while task.wait(3) do
        if States.AutoRelic and not States.IsMining then
            pcall(function()
                local relics = Services.Workspace:FindFirstChild("LeviathanEvent") and Services.Workspace.LeviathanEvent:FindFirstChild("Relics")
                if relics then
                    for _, r in pairs(relics:GetChildren()) do
                        if not States.AutoRelic then break end
                        if r.Name:match("Relic") then
                            if not States.HasTank then pcall(function() Net["RF/EquipOxygenTank"]:InvokeServer(575); States.HasTank=true end) end
                            local hrp = GetRoot()
                            for _, spot in ipairs(r:GetChildren()) do
                                local part = spot:FindFirstChild("Part") or (spot:IsA("BasePart") and spot)
                                if part and hrp then
                                    hrp.CFrame = part.CFrame + Vector3.new(0, 3, 0)
                                    task.wait(0.8)
                                    Net["RE/ClaimRelic"]:FireServer(r.Name)
                                    task.wait(1.5)
                                end
                            end
                        end
                    end
                end
            end)
        end
    end
end)

-- 8.4 Background Player Adjustments (Speed & God)
task.spawn(function()
    while task.wait() do
        local h = GetHum()
        if h then
            if States.Speed then
                if h.Sit and h.SeatPart then
                    if h.SeatPart.AssemblyLinearVelocity.Magnitude > 0 then
                        h.SeatPart.AssemblyLinearVelocity = h.SeatPart.CFrame.LookVector * 50
                    end
                else
                    h.WalkSpeed = 50
                end
            end
            if States.NoDmg and h.Health < h.MaxHealth then
                h.Health = h.MaxHealth
            end
        end
    end
end)

-- 8.5 Auto Equip
task.spawn(function()
    while task.wait(2) do
        if States.AutoEquip and not States.IsMining then
            pcall(function() Net["RE/EquipToolFromHotbar"]:FireServer(1) end)
        end
    end
end)

-- 8.6 System Monitor Update
local lastFpsTime = os.clock()
local frames = 0
Services.RunService.RenderStepped:Connect(function() frames = frames + 1 end)

task.spawn(function()
    while task.wait(0.5) do
        local fps = math.floor(frames / (os.clock() - lastFpsTime))
        lastFpsTime = os.clock(); frames = 0
        local cpu = Services.Stats.PerformanceStats.CPU:GetValue()
        LblMon.Text = string.format("FPS: %d | CPU: %.1f ms", fps, cpu)
        
        pcall(function()
            local ls = Player:FindFirstChild("leaderstats")
            local c = ls and ls:FindFirstChild("Caught") and ls.Caught.Value or 0
            StatFish.Text = tostring(c):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
            if Player:FindFirstChild("Backpack") then
                StatInv.Text = tostring(#Player.Backpack:GetChildren())
            end
        end)
    end
end)

-- ====================================================
-- [9] ANIMATION EVENT HOOK
-- ====================================================
local fishCaughtRemote = Net:FindFirstChild("RE/FishCaught")
if fishCaughtRemote then
    fishCaughtRemote.OnClientEvent:Connect(function()
        if States.AnimSkin ~= "Off" then
            pcall(function()
                local char = Player.Character
                local animator = char and char:FindFirstChild("Humanoid") and char.Humanoid:FindFirstChild("Animator")
                if animator then
                    for _, t in pairs(animator:GetPlayingAnimationTracks()) do t:Stop(0.1) end
                    local animObj = Services.ReplicatedStorage.Modules.Animations:FindFirstChild(States.AnimSkin)
                    if animObj then
                        local track = animator:LoadAnimation(animObj)
                        track.Priority = Enum.AnimationPriority.Action4
                        track:Play()
                    end
                end
            end)
        end
    end)
end

-- ====================================================
-- STARTUP
-- ====================================================
MainGui.Visible = true
FloatHUD.Visible = true