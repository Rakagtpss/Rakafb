-- [[ SERAPHIN MINI UI - ULTIMATE EDITION ]]
-- Version: V3.2 (Smart Chain Mining + Realtime Detector)

local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    TweenService = game:GetService("TweenService"),
    Workspace = game:GetService("Workspace"),
    StarterGui = game:GetService("StarterGui")
}

local Player = Services.Players.LocalPlayer
local Camera = Services.Workspace.CurrentCamera

-- // THEME CONFIG
local UI = {
    Color = Color3.fromRGB(15, 15, 20),
    Accent = Color3.fromRGB(0, 255, 150), -- Hijau (Active)
    Text = Color3.fromRGB(240, 240, 240),
    Size = UDim2.new(0, 240, 0, 320) -- Sedikit diperlebar untuk Jam
}

-- // CLEANUP OLD UI
if Services.CoreGui:FindFirstChild("SeraphinUltimate") then 
    Services.CoreGui.SeraphinUltimate:Destroy() 
end

-- // CREATE UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SeraphinUltimate"
ScreenGui.Parent = Services.CoreGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UI.Size
MainFrame.Position = UDim2.new(0, 20, 0.5, -150)
MainFrame.BackgroundColor3 = UI.Color
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 8)

-- Header
local Header = Instance.new("Frame", MainFrame)
Header.Size = UDim2.new(1, 0, 0, 30)
Header.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Header.BackgroundTransparency = 0.95
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(0.6, 0, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.Text = "SERAPHIN <font color='#00ff96'>V3.2</font>"
Title.RichText = true
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 12
Title.TextColor3 = UI.Text
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1

-- [NEW] REALTIME CLOCK IN UI
local TimeLabel = Instance.new("TextLabel", Header)
TimeLabel.Name = "ServerTime"
TimeLabel.Size = UDim2.new(0, 60, 1, 0)
TimeLabel.Position = UDim2.new(1, -95, 0, 0) 
TimeLabel.BackgroundTransparency = 1
TimeLabel.Text = "00:00:00"
TimeLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
TimeLabel.TextSize = 11
TimeLabel.Font = Enum.Font.Code
TimeLabel.TextXAlignment = Enum.TextXAlignment.Right

local MiniBtn = Instance.new("TextButton", Header)
MiniBtn.Size = UDim2.new(0, 30, 0, 30)
MiniBtn.Position = UDim2.new(1, -30, 0, 0)
MiniBtn.Text = "-"
MiniBtn.Font = Enum.Font.GothamBold
MiniBtn.TextSize = 14
MiniBtn.TextColor3 = UI.Text
MiniBtn.BackgroundTransparency = 1

-- Scroll Container
local Scroll = Instance.new("ScrollingFrame", MainFrame)
Scroll.Size = UDim2.new(1, -10, 1, -40)
Scroll.Position = UDim2.new(0, 5, 0, 35)
Scroll.BackgroundTransparency = 1
Scroll.ScrollBarThickness = 2
Scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
Scroll.CanvasSize = UDim2.new(0,0,0,0)

local UIList = Instance.new("UIListLayout", Scroll)
UIList.Padding = UDim.new(0, 6)
UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- // HELPER FUNCTIONS (DRAG)
local function Drag(frame)
    local dragToggle, dragStart, startPos
    local function updateInput(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true; dragStart = input.Position; startPos = frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragToggle then updateInput(input) end
        end
    end)
end
Drag(MainFrame)

-- // STATES
local States = {
    AutoCrystal = false,
    AutoLava = false,
    Noclip = false,
    IsMining = false
}

-- // TOGGLE CREATOR
local function CreateToggle(text, stateVar, callback)
    local Btn = Instance.new("TextButton", Scroll)
    Btn.Size = UDim2.new(0.95, 0, 0, 32)
    Btn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    Btn.Text = ""
    Btn.AutoButtonColor = false
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)

    local Lbl = Instance.new("TextLabel", Btn)
    Lbl.Size = UDim2.new(0.7, 0, 1, 0)
    Lbl.Position = UDim2.new(0, 10, 0, 0)
    Lbl.Text = text
    Lbl.Font = Enum.Font.GothamBold
    Lbl.TextSize = 10
    Lbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    Lbl.TextXAlignment = Enum.TextXAlignment.Left
    Lbl.BackgroundTransparency = 1

    local Indicator = Instance.new("Frame", Btn)
    Indicator.Size = UDim2.new(0, 8, 0, 8)
    Indicator.Position = UDim2.new(1, -20, 0.5, -4)
    Indicator.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    Instance.new("UICorner", Indicator).CornerRadius = UDim.new(1, 0)

    local IsOn = false
    Btn.MouseButton1Click:Connect(function()
        IsOn = not IsOn
        States[stateVar] = IsOn
        
        Services.TweenService:Create(Indicator, TweenInfo.new(0.2), {
            BackgroundColor3 = IsOn and UI.Accent or Color3.fromRGB(50, 50, 60)
        }):Play()
        
        Services.TweenService:Create(Lbl, TweenInfo.new(0.2), {
            TextColor3 = IsOn and Color3.new(1,1,1) or Color3.fromRGB(200, 200, 200)
        }):Play()

        if callback then callback(IsOn) end
    end)
    return Btn
end

-- // MINIMIZE LOGIC
local MiniBtnLogic = Instance.new("TextButton", ScreenGui)
MiniBtnLogic.Size = UDim2.new(0, 40, 0, 40)
MiniBtnLogic.Position = UDim2.new(0, 20, 0.5, -20)
MiniBtnLogic.BackgroundColor3 = UI.Color
MiniBtnLogic.Text = "S"
MiniBtnLogic.Font = Enum.Font.GothamBlack
MiniBtnLogic.TextColor3 = UI.Accent
MiniBtnLogic.Visible = false
Instance.new("UICorner", MiniBtnLogic).CornerRadius = UDim.new(0, 12)
Drag(MiniBtnLogic)

MiniBtn.MouseButton1Click:Connect(function() MainFrame.Visible = false; MiniBtnLogic.Visible = true end)
MiniBtnLogic.MouseButton1Click:Connect(function() MainFrame.Visible = true; MiniBtnLogic.Visible = false end)

-- ====================================================
-- [CORE LOGIC] SMART DETECTOR (CONSOLE & NOTIF)
-- ====================================================
local function WatchCrystalSpawns()
    local Zones = {
        {Name = "Crystal Depths", Path = {"Islands", "Crystal Depths", "Crystals"}},
        {Name = "Lava Basin", Path = {"Islands", "Lava Basin", "Crystals"}}
    }

    for _, zone in pairs(Zones) do
        task.spawn(function()
            local folder = Services.Workspace
            for _, p in ipairs(zone.Path) do
                folder = folder:WaitForChild(p, 10)
                if not folder then return end
            end

            print("[SERAPHIN] Monitoring " .. zone.Name .. " Active...")

            folder.ChildAdded:Connect(function(child)
                if child:IsA("Model") or child:IsA("BasePart") then
                    
                    -- TIME CALCULATION
                    local RealTime = os.date("%H:%M:%S")
                    local ServerUptime = math.floor(workspace.DistributedGameTime)
                    
                    local upHours = math.floor(ServerUptime / 3600)
                    local upMins = math.floor((ServerUptime % 3600) / 60)
                    local upSecs = ServerUptime % 60
                    local UptimeStr = string.format("%02d:%02d:%02d", upHours, upMins, upSecs)

                    -- CONSOLE LOG (F9)
                    warn("------------------------------------------------")
                    warn("[ðŸ’Ž SPAWN DETECTED] Lokasi: " .. zone.Name)
                    print("   âž¤ Real Time    : " .. RealTime)
                    print("   âž¤ Server Age   : " .. UptimeStr .. " (Uptime)")
                    warn("------------------------------------------------")

                    -- SCREEN NOTIFICATION
                    pcall(function()
                        Services.StarterGui:SetCore("SendNotification", {
                            Title = "ðŸ’Ž Crystal Spawned!",
                            Text = zone.Name .. " @ " .. RealTime,
                            Duration = 8,
                        })
                    end)
                end
            end)
        end)
    end
end
task.spawn(WatchCrystalSpawns)

-- ====================================================
-- [CORE LOGIC] MINING (CHAIN SYSTEM)
-- ====================================================

local function GetChar() return Player.Character or Player.CharacterAdded:Wait() end
local function GetRoot() local c = Player.Character; return c and c:FindFirstChild("HumanoidRootPart") end

local function SafeMove(targetCFrame)
    local hrp = GetRoot()
    if not hrp then return end
    
    local dist = (hrp.Position - targetCFrame.Position).Magnitude
    if dist < 5 then hrp.CFrame = targetCFrame; return end
    
    -- Speed 190 = Aman dari Kick
    local speed = 190 
    local time = dist / speed
    
    local tweenInfo = TweenInfo.new(time, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
    local tween = Services.TweenService:Create(hrp, tweenInfo, {CFrame = targetCFrame})
    
    States.Noclip = true 
    tween:Play()
    tween.Completed:Wait()
    States.Noclip = false
    
    hrp.AssemblyLinearVelocity = Vector3.zero 
end

local function EquipTool(keyword)
    local char = Player.Character
    local backpack = Player.Backpack
    if not char or not backpack then return end
    
    local equipped = char:FindFirstChildWhichIsA("Tool")
    if equipped and string.find(string.lower(equipped.Name), keyword) then return true end
    
    for _, t in pairs(backpack:GetChildren()) do
        if t:IsA("Tool") and string.find(string.lower(t.Name), keyword) then
            t.Parent = char
            return true
        end
    end
    
    local Remote = Services.ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/EquipToolFromHotbar")
    if Remote then pcall(function() Remote:FireServer(2) end) end
    return true
end

local function GetMiningNodes(folder)
    local nodes = {}
    if not folder then return nodes end
    for _, item in ipairs(folder:GetChildren()) do
        if item:IsA("Model") or item:IsA("BasePart") then
            local prompt = item:FindFirstChildWhichIsA("ProximityPrompt", true)
            local mainPart = item:IsA("Model") and item.PrimaryPart or item
            
            if prompt and prompt.Enabled and mainPart and mainPart.Transparency < 1 then
                table.insert(nodes, {Obj = item, Pos = mainPart.Position, Prompt = prompt})
            end
        end
    end
    return nodes
end

local function RunChainMining(folderName, toggleState)
    States.IsMining = true
    while States[toggleState] do
        local Islands = Services.Workspace:WaitForChild("Islands", 5)
        local Folder = nil
        
        if folderName == "Crystal" then
            Folder = Islands and Islands:FindFirstChild("Crystal Depths") and Islands["Crystal Depths"]:FindFirstChild("Crystals")
        elseif folderName == "Lava" then
            Folder = Islands and Islands:FindFirstChild("Lava Basin") and Islands["Lava Basin"]:FindFirstChild("Crystals")
        end
        
        if not Folder then task.wait(1); continue end
        
        local nodes = GetMiningNodes(Folder)
        if #nodes == 0 then task.wait(1); continue end
        
        local hrp = GetRoot()
        if not hrp then task.wait(1); continue end

        -- Nearest Neighbor Sort
        table.sort(nodes, function(a, b)
            return (hrp.Position - a.Pos).Magnitude < (hrp.Position - b.Pos).Magnitude
        end)
        
        local target = nodes[1]
        local approachPos = CFrame.new(target.Pos + Vector3.new(3, 2, 0), target.Pos)
        
        SafeMove(approachPos)
        hrp.AssemblyLinearVelocity = Vector3.zero
        
        EquipTool("pick")
        task.wait(0.1)
        
        if target.Prompt and target.Prompt.Parent then
            fireproximityprompt(target.Prompt)
            local t = 0
            while target.Prompt.Enabled and t < 2.5 do
                t = t + 0.1
                task.wait(0.1)
            end
        end
        task.wait(0.1) 
    end
    States.IsMining = false
    local char = Player.Character
    if char then
        for _, t in pairs(char:GetChildren()) do
            if t:IsA("Tool") then t.Parent = Player.Backpack end
        end
    end
end

-- ====================================================
-- [BUTTONS & LOOPS]
-- ====================================================

CreateToggle("Auto Crystal (Fast)", "AutoCrystal", function(val)
    if val then
        States.AutoLava = false
        task.spawn(function() RunChainMining("Crystal", "AutoCrystal") end)
    end
end)

CreateToggle("Auto Lava (Fast)", "AutoLava", function(val)
    if val then
        States.AutoCrystal = false
        task.spawn(function() RunChainMining("Lava", "AutoLava") end)
    end
end)

CreateToggle("Noclip (Safety)", "Noclip", nil)

-- Clock Update Loop
task.spawn(function()
    while true do
        TimeLabel.Text = os.date("%H:%M:%S")
        task.wait(1)
    end
end)

-- Noclip Loop
Services.RunService.Stepped:Connect(function()
    if States.Noclip then
        local c = GetChar()
        if c then
            for _, v in pairs(c:GetDescendants()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end
    end
end)
